(function(b){String.prototype.trim===b&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});Array.prototype.reduce===b&&(Array.prototype.reduce=function(a){if(void 0===this||null===this)throw new TypeError;var g=Object(this),c=g.length>>>0,d=0,f;if("function"!=typeof a)throw new TypeError;if(0==c&&1==arguments.length)throw new TypeError;if(2<=arguments.length)f=arguments[1];else{do{if(d in g){f=g[d++];break}if(++d>=c)throw new TypeError;}while(1)}for(;d<c;)d in g&&
(f=a.call(b,f,g[d],d,g)),d++;return f})})();
var Zepto=function(){function b(e){return"[object Function]"=={}.toString.call(e)}function a(e){return e instanceof Object}function g(e){return e instanceof Array}function c(e){return"number"==typeof e.length}function d(e){return e.filter(function(e){return e!==w&&null!==e})}function f(e){return e.replace(/-+(.)?/g,function(e,b){return b?b.toUpperCase():""})}function l(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}
function p(e){return e.filter(function(e,b,a){return a.indexOf(e)==b})}function n(e){return e in B?B[e]:B[e]=RegExp("(^|\\s)"+e+"(\\s|$)")}function t(b,a){a===w&&y.test(b)&&RegExp.$1;a in e||(a="*");var k=e[a];k.innerHTML=""+b;return h.call(k.childNodes)}function r(e,b){e=e||x;e.__proto__=r.prototype;e.selector=b||"";return e}function m(e,a){if(!e)return r();if(a!==w)return m(a).find(e);if(b(e))return m(s).ready(e);if(e instanceof r)return e;var k;g(e)?k=d(e):0<=E.indexOf(e.nodeType)||e===window?
(k=[e],e=null):y.test(e)?(k=t(e.trim(),RegExp.$1),e=null):k=e.nodeType&&3==e.nodeType?[e]:D(s,e);return r(k,e)}function u(e,b){return b===w?m(e):m(e).filter(b)}function v(e,a,k,c){return b(a)?a.call(e,k,c):a}function q(e,b,a){var k=e%2?b:b.parentNode;k&&k.insertBefore(a,!e?b.nextSibling:1==e?k.firstChild:2==e?b:null)}function z(e,b){b(e);for(var a in e.childNodes)z(e.childNodes[a],b)}var w,A,D,C,x=[],h=x.slice,s=window.document,F={},B={},G=s.defaultView.getComputedStyle,k={"column-count":1,columns:1,
"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},y=/^\s*<(\w+)[^>]*>/,E=[1,9,11],H=s.createElement("table"),J=s.createElement("tr"),e={tr:s.createElement("tbody"),tbody:H,thead:H,tfoot:H,td:J,th:J,"*":s.createElement("div")},I=/complete|loaded|interactive/,K=/^\.([\w-]+)$/,L=/^#([\w-]+)$/,M=/^[\w-]+$/;m.extend=function(e){h.call(arguments,1).forEach(function(b){for(A in b)e[A]=b[A]});return e};m.qsa=D=function(e,b){var a;return e===s&&L.test(b)?(a=e.getElementById(RegExp.$1))?[a]:x:h.call(K.test(b)?
e.getElementsByClassName(RegExp.$1):M.test(b)?e.getElementsByTagName(b):e.querySelectorAll(b))};m.isFunction=b;m.isObject=a;m.isArray=g;m.map=function(e,b){var a,k=[],d;if(c(e))for(d=0;d<e.length;d++)a=b(e[d],d),null!=a&&k.push(a);else for(d in e)a=b(e[d],d),null!=a&&k.push(a);return 0<k.length?[].concat.apply([],k):k};m.each=function(e,b){var a;if(c(e))for(a=0;a<e.length&&!1!==b(a,e[a]);a++);else for(a in e)if(!1===b(a,e[a]))break;return e};m.fn={forEach:x.forEach,reduce:x.reduce,push:x.push,indexOf:x.indexOf,
concat:x.concat,map:function(e){return m.map(this,function(b,a){return e.call(b,a,b)})},slice:function(){return m(h.apply(this,arguments))},ready:function(e){I.test(s.readyState)?e(m):s.addEventListener("DOMContentLoaded",function(){e(m)},!1);return this},get:function(e){return e===w?this:this[e]},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){this.forEach(function(b,a){e.call(b,a,b)});
return this},filter:function(e){return m([].filter.call(this,function(b){return b.parentNode&&0<=D(b.parentNode,e).indexOf(b)}))},end:function(){return this.prevObject||m()},andSelf:function(){return this.add(this.prevObject||m())},add:function(e,b){return m(p(this.concat(m(e,b))))},is:function(e){return 0<this.length&&0<m(this[0]).filter(e).length},not:function(e){var a=[];if(b(e)&&e.call!==w)this.each(function(b){e.call(this,b)||a.push(this)});else{var k="string"==typeof e?this.filter(e):c(e)&&
b(e.item)?h.call(e):m(e);this.forEach(function(e){0>k.indexOf(e)&&a.push(e)})}return m(a)},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!a(e)?e:m(e)},last:function(){var e=this[this.length-1];return e&&!a(e)?e:m(e)},find:function(e){var b;b=1==this.length?D(this[0],e):this.map(function(){return D(this,e)});return m(b)},closest:function(e,b){var a=this[0],k=D(b||s,e);for(k.length||(a=null);a&&0>k.indexOf(a);)a=a!==b&&a!==s&&a.parentNode;return m(a)},
parents:function(e){for(var b=[],a=this;0<a.length;)a=m.map(a,function(e){if((e=e.parentNode)&&e!==s&&0>b.indexOf(e))return b.push(e),e});return u(b,e)},parent:function(e){return u(p(this.pluck("parentNode")),e)},children:function(e){return u(this.map(function(){return h.call(this.children)}),e)},siblings:function(e){return u(this.map(function(e,b){return h.call(b.parentNode.children).filter(function(e){return e!==b})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return this.map(function(){return this[e]})},
show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=null);if("none"==G(this,"").getPropertyValue("display")){var e=this.style,b=this.nodeName,a,k;F[b]||(a=s.createElement(b),s.body.appendChild(a),k=G(a,"").getPropertyValue("display"),a.parentNode.removeChild(a),"none"==k&&(k="block"),F[b]=k);e.display=F[b]}})},replaceWith:function(e){return this.each(function(){m(this).before(e).remove()})},wrap:function(e){return this.each(function(){m(this).wrapAll(m(e)[0].cloneNode(!1))})},
wrapAll:function(e){this[0]&&(m(this[0]).before(e=m(e)),e.append(this));return this},unwrap:function(){this.parent().each(function(){m(this).replaceWith(m(this).children())});return this},hide:function(){return this.css("display","none")},toggle:function(e){return(e===w?"none"==this.css("display"):e)?this.show():this.hide()},prev:function(){return m(this.pluck("previousElementSibling"))},next:function(){return m(this.pluck("nextElementSibling"))},html:function(e){return e===w?0<this.length?this[0].innerHTML:
null:this.each(function(b){var a=this.innerHTML;m(this).empty().append(v(this,e,b,a))})},text:function(e){return e===w?0<this.length?this[0].textContent:null:this.each(function(){this.textContent=e})},attr:function(e,b){var k;return"string"==typeof e&&b===w?0==this.length?w:"value"==e&&"INPUT"==this[0].nodeName?this.val():!(k=this[0].getAttribute(e))&&e in this[0]?this[0][e]:k:this.each(function(k){if(a(e))for(A in e)this.setAttribute(A,e[A]);else this.setAttribute(e,v(this,b,k,this.getAttribute(e)))})},
removeAttr:function(e){return this.each(function(){this.removeAttribute(e)})},data:function(e,b){return this.attr("data-"+e,b)},val:function(e){return e===w?0<this.length?this[0].value:null:this.each(function(b){this.value=v(this,e,b,this.value)})},offset:function(){if(0==this.length)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:e.width,height:e.height}},css:function(e,b){if(b===w&&"string"==typeof e)return 0==this.length?
w:this[0].style[f(e)]||G(this[0],"").getPropertyValue(e);var a="";for(A in e)a+=l(A)+":"+("number"==typeof e[A]&&!k[l(A)]?e[A]+"px":e[A])+";";"string"==typeof e&&(a=l(e)+":"+("number"==typeof b&&!k[l(e)]?b+"px":b));return this.each(function(){this.style.cssText+=";"+a})},index:function(e){return e?this.indexOf(m(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return 1>this.length?!1:n(e).test(this[0].className)},addClass:function(e){return this.each(function(b){C=[];var a=this.className;
v(this,e,b,a).split(/\s+/g).forEach(function(e){m(this).hasClass(e)||C.push(e)},this);C.length&&(this.className+=(a?" ":"")+C.join(" "))})},removeClass:function(e){return this.each(function(b){if(e===w)return this.className="";C=this.className;v(this,e,b,C).split(/\s+/g).forEach(function(e){C=C.replace(n(e)," ")});this.className=C.trim()})},toggleClass:function(e,b){return this.each(function(a){a=v(this,e,a,this.className);(b===w?!m(this).hasClass(a):b)?m(this).addClass(a):m(this).removeClass(a)})}};
"filter add not eq first last find closest parents parent children siblings".split(" ").forEach(function(e){var b=m.fn[e];m.fn[e]=function(){var e=b.apply(this,arguments);e.prevObject=this;return e}});["width","height"].forEach(function(e){m.fn[e]=function(b){var a,k=e.replace(/./,function(e){return e[0].toUpperCase()});return b===w?this[0]==window?window["inner"+k]:this[0]==s?s.documentElement["offset"+k]:(a=this.offset())&&a[e]:this.each(function(a){var k=m(this);k.css(e,v(this,b,a,k[e]()))})}});
["after","prepend","before","append"].forEach(function(e,b){m.fn[e]=function(e){var k=a(e)?e:t(e);if(!("length"in k)||k.nodeType)k=[k];if(1>k.length)return this;var c=this.length,d=1<c,y=2>b;return this.each(function(e,a){for(var I=0;I<k.length;I++){var f=k[y?k.length-I-1:I];z(f,function(e){null!=e.nodeName&&("SCRIPT"===e.nodeName.toUpperCase()&&(!e.type||"text/javascript"===e.type))&&window.eval.call(window,e.innerHTML)});d&&e<c-1&&(f=f.cloneNode(!0));q(b,a,f)}})};m.fn[b%2?e+"To":"insert"+(b?"Before":
"After")]=function(b){m(b)[e](this);return this}});r.prototype=m.fn;return m}();window.Zepto=Zepto;"$"in window||(window.$=Zepto);
(function(b){function a(b,a,c,d){a=g(a);if(a.ns)var f=RegExp("(?:^| )"+a.ns.replace(" "," .* ?")+"(?: |$)");return(n[b._zid||(b._zid=t++)]||[]).filter(function(b){return b&&(!a.e||b.e==a.e)&&(!a.ns||f.test(b.ns))&&(!c||b.fn==c)&&(!d||b.sel==d)})}function g(b){b=(""+b).split(".");return{e:b[0],ns:b.slice(1).sort().join(" ")}}function c(a,c,d){b.isObject(a)?b.each(a,d):a.split(/\s/).forEach(function(b){d(b,c)})}function d(a,d,f,l,p){var m=a._zid||(a._zid=t++),x=n[m]||(n[m]=[]);c(d,f,function(c,d){var f=
p&&p(d,c),w=f||d,z=function(b){var c=w.apply(a,[b].concat(b.data));!1===c&&b.preventDefault();return c},f=b.extend(g(c),{fn:d,proxy:z,sel:l,del:f,i:x.length});x.push(f);a.addEventListener(f.e,z,!1)})}function f(b,d,f,g){var l=b._zid||(b._zid=t++);c(d||"",f,function(c,d){a(b,c,d,g).forEach(function(a){delete n[l][a.i];b.removeEventListener(a.e,a.proxy,!1)})})}function l(a){var c=b.extend({originalEvent:a},a);b.each(v,function(b,d){c[b]=function(){this[d]=m;return a[b].apply(a,arguments)};c[d]=u});
return c}function p(b){if(!("defaultPrevented"in b)){b.defaultPrevented=!1;var a=b.preventDefault;b.preventDefault=function(){this.defaultPrevented=!0;a.call(this)}}}var n={},t=1,r={};r.click=r.mousedown=r.mouseup=r.mousemove="MouseEvents";b.event={add:d,remove:f};b.fn.bind=function(b,a){return this.each(function(){d(this,b,a)})};b.fn.unbind=function(b,a){return this.each(function(){f(this,b,a)})};b.fn.one=function(b,a){return this.each(function(c,g){d(this,b,a,null,function(b,a){return function(){var c=
b.apply(g,arguments);f(g,a,b);return c}})})};var m=function(){return!0},u=function(){return!1},v={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};b.fn.delegate=function(a,c,f){return this.each(function(g,p){d(p,c,f,a,function(c){return function(d){var f,g=b(d.target).closest(a,p).get(0);if(g)return f=b.extend(l(d),{currentTarget:g,liveFired:p}),c.apply(g,[f].concat([].slice.call(arguments,1)))}})})};b.fn.undelegate=
function(b,a,c){return this.each(function(){f(this,a,c,b)})};b.fn.live=function(a,c){b(document.body).delegate(this.selector,a,c);return this};b.fn.die=function(a,c){b(document.body).undelegate(this.selector,a,c);return this};b.fn.on=function(a,c,d){return void 0===c||b.isFunction(c)?this.bind(a,c):this.delegate(c,a,d)};b.fn.off=function(a,c,d){return void 0===c||b.isFunction(c)?this.unbind(a,c):this.undelegate(c,a,d)};b.fn.trigger=function(a,c){"string"==typeof a&&(a=b.Event(a));p(a);a.data=c;return this.each(function(){this.dispatchEvent(a)})};
b.fn.triggerHandler=function(c,d){var f,g;this.each(function(p,m){f=l("string"==typeof c?b.Event(c):c);f.data=d;f.target=m;b.each(a(m,c.type||c),function(b,a){g=a.proxy(f);if(f.isImmediatePropagationStopped())return!1})});return g};"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(a){b.fn[a]=function(b){return this.bind(a,b)}});["focus","blur"].forEach(function(a){b.fn[a]=
function(b){if(b)this.bind(a,b);else if(this.length)try{this.get(0)[a]()}catch(c){}return this}});b.Event=function(b,a){var c=document.createEvent(r[b]||"Events"),d=!0;if(a)for(var f in a)"bubbles"==f?d=!!a[f]:c[f]=a[f];c.initEvent(b,d,!0,null,null,null,null,null,null,null,null,null,null,null,null);return c}})(Zepto);
(function(b){function a(b){var a=this.os={},d=this.browser={},f=b.match(/WebKit\/([\d.]+)/),l=b.match(/(Android)\s+([\d.]+)/),p=b.match(/(iPad).*OS\s([\d_]+)/),n=!p&&b.match(/(iPhone\sOS)\s([\d_]+)/),t=b.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),r=t&&b.match(/TouchPad/);b=b.match(/(BlackBerry).*Version\/([\d.]+)/);f&&(d.version=f[1]);d.webkit=!!f;l&&(a.android=!0,a.version=l[2]);n&&(a.ios=!0,a.version=n[2].replace(/_/g,"."),a.iphone=!0);p&&(a.ios=!0,a.version=p[2].replace(/_/g,"."),a.ipad=!0);t&&(a.webos=
!0,a.version=t[2]);r&&(a.touchpad=!0);b&&(a.blackberry=!0,a.version=b[2])}a.call(b,navigator.userAgent);b.__detect=a})(Zepto);
(function(b,a){var g="",c,d=window.document.createElement("div"),f=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;b.each({Webkit:"webkit",Moz:"",O:"o",ms:"MS"},function(b,f){if(d.style[b+"TransitionProperty"]!==a)return g="-"+b.toLowerCase()+"-",c=f,!1});b.fx={off:c===a&&d.style.transitionProperty===a,cssPrefix:g,transitionEnd:c?c+"TransitionEnd":"transitionend",animationEnd:c?c+"AnimationEnd":"animationend"};b.fn.animate=function(a,c,d,f){b.isObject(c)&&(d=c.easing,
f=c.complete,c=c.duration);c&&(c/=1E3);return this.anim(a,c,d,f)};b.fn.anim=function(c,d,n,t){var r,m={},u,v=this,q,z=b.fx.transitionEnd;d===a&&(d=0.4);b.fx.off&&(d=0);if("string"==typeof c)m[g+"animation-name"]=c,m[g+"animation-duration"]=d+"s",z=b.fx.animationEnd;else{for(u in c)f.test(u)?(r||(r=[]),r.push(u+"("+c[u]+")")):m[u]=c[u];r&&(m[g+"transform"]=r.join(" "));b.fx.off||(m[g+"transition"]="all "+d+"s "+(n||""))}q=function(){var a={};a[g+"transition"]=a[g+"animation-name"]="none";b(this).css(a);
t&&t.call(this)};if(0<d)this.one(z,q);setTimeout(function(){v.css(m);0>=d&&setTimeout(function(){v.each(function(){q.call(this)})},0)},0);return this};d=null})(Zepto);
(function(b){function a(a,c,d,f){if(a.global)return a=c||m,d=b.Event(d),b(a).trigger(d,f),!d.defaultPrevented}function g(c){c.global&&0===b.active++&&a(c,null,"ajaxStart")}function c(b,c){var d=c.context;if(!1===c.beforeSend.call(d,b,c)||!1===a(c,d,"ajaxBeforeSend",[b,c]))return!1;a(c,d,"ajaxSend",[b,c])}function d(b,c,d){var f=d.context;d.success.call(f,b,"success",c);a(d,f,"ajaxSuccess",[c,d,b]);l("success",c,d)}function f(b,c,d,f){var g=f.context;f.error.call(g,d,c,b);a(f,g,"ajaxError",[d,f,b]);
l(c,d,f)}function l(c,d,f){var g=f.context;f.complete.call(g,d,c);a(f,g,"ajaxComplete",[d,f]);f.global&&!--b.active&&a(f,null,"ajaxStop")}function p(){}function n(a,c,d,f){var g=b.isArray(c);b.each(c,function(c,h){f&&(c=d?f:f+"["+(g?"":c)+"]");!f&&g?a.add(h.name,h.value):(d?b.isArray(h):r(h))?n(a,h,d,c):a.add(c,h)})}var t=0,r=b.isObject,m=window.document,u,v;b.active=0;b.ajaxJSONP=function(a){var c="jsonp"+ ++t,f=m.createElement("script"),g={abort:function(){b(f).remove();c in window&&(window[c]=
p);l(g,a,"abort")}},n;window[c]=function(l){clearTimeout(n);b(f).remove();delete window[c];d(l,g,a)};f.src=a.url.replace(/=\?/,"="+c);b("head").append(f);0<a.timeout&&(n=setTimeout(function(){g.abort();l(g,a,"timeout")},a.timeout));return g};b.ajaxSettings={type:"GET",beforeSend:p,success:p,error:p,complete:p,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",
text:"text/plain"},crossDomain:!1,timeout:0};b.ajax=function(a){var l=b.extend({},a||{});for(u in b.ajaxSettings)void 0===l[u]&&(l[u]=b.ajaxSettings[u]);g(l);l.crossDomain||(l.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(l.url)&&RegExp.$2!=window.location.host);if(/=\?/.test(l.url))return b.ajaxJSONP(l);l.url||(l.url=window.location.toString());l.data&&!l.contentType&&(l.contentType="application/x-www-form-urlencoded");r(l.data)&&(l.data=b.param(l.data));l.type.match(/get/i)&&l.data&&(a=l.data,l.url.match(/\?.*=/)?
a="&"+a:"?"!=a[0]&&(a="?"+a),l.url+=a);var m=l.accepts[l.dataType];a={};var n=/^([\w-]+:)\/\//.test(l.url)?RegExp.$1:window.location.protocol,q=b.ajaxSettings.xhr(),x;l.crossDomain||(a["X-Requested-With"]="XMLHttpRequest");m&&(a.Accept=m);l.headers=b.extend(a,l.headers||{});q.onreadystatechange=function(){if(4==q.readyState){clearTimeout(x);var a,b=!1;if(200<=q.status&&300>q.status||0==q.status&&"file:"==n){if("application/json"==m&&!/^\s*$/.test(q.responseText))try{a=JSON.parse(q.responseText)}catch(c){b=
c}else a=q.responseText;b?f(b,"parsererror",q,l):d(a,q,l)}else f(null,"error",q,l)}};q.open(l.type,l.url,!0);l.contentType&&(l.headers["Content-Type"]=l.contentType);for(v in l.headers)q.setRequestHeader(v,l.headers[v]);if(!1===c(q,l))return q.abort(),!1;0<l.timeout&&(x=setTimeout(function(){q.onreadystatechange=p;q.abort();f(null,"timeout",q,l)},l.timeout));q.send(l.data);return q};b.get=function(a,c){return b.ajax({url:a,success:c})};b.post=function(a,c,d,f){b.isFunction(c)&&(f=f||d,d=c,c=null);
return b.ajax({type:"POST",url:a,data:c,success:d,dataType:f})};b.getJSON=function(a,c){return b.ajax({url:a,success:c,dataType:"json"})};b.fn.load=function(a,c){if(!this.length)return this;var d=this,f=a.split(/\s/),g;1<f.length&&(a=f[0],g=f[1]);b.get(a,function(a){d.html(g?b(m.createElement("div")).html(a).find(g).html():a);c&&c.call(d)});return this};var q=encodeURIComponent;b.param=function(a,b){var c=[];c.add=function(a,b){this.push(q(a)+"="+q(b))};n(c,a,b);return c.join("&").replace("%20","+")}})(Zepto);
(function(b){b.fn.serializeArray=function(){var a=[],g;b(Array.prototype.slice.call(this.get(0).elements)).each(function(){g=b(this);var c=g.attr("type");!this.disabled&&("submit"!=c&&"reset"!=c&&"button"!=c&&("radio"!=c&&"checkbox"!=c||this.checked))&&a.push({name:g.attr("name"),value:g.val()})});return a};b.fn.serialize=function(){var a=[];this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))});return a.join("&")};b.fn.submit=function(a){a?
this.bind("submit",a):this.length&&(a=b.Event("submit"),this.eq(0).trigger(a),a.defaultPrevented||this.get(0).submit());return this}})(Zepto);
(function(b){function a(a,b,c,d){var f=Math.abs(a-b),g=Math.abs(c-d);return f>=g?0<a-b?"Left":"Right":0<c-d?"Up":"Down"}function g(){c.last&&Date.now()-c.last>=f&&(b(c.target).trigger("longTap"),c={})}var c={},d,f=750;b(document).ready(function(){b(document.body).bind("touchstart",function(a){var b=Date.now(),n=b-(c.last||b);c.target="tagName"in a.touches[0].target?a.touches[0].target:a.touches[0].target.parentNode;d&&clearTimeout(d);c.x1=a.touches[0].pageX;c.y1=a.touches[0].pageY;0<n&&250>=n&&(c.isDoubleTap=
!0);c.last=b;setTimeout(g,f)}).bind("touchmove",function(a){c.x2=a.touches[0].pageX;c.y2=a.touches[0].pageY}).bind("touchend",function(f){c.isDoubleTap?(b(c.target).trigger("doubleTap"),c={}):0<c.x2||0<c.y2?((30<Math.abs(c.x1-c.x2)||30<Math.abs(c.y1-c.y2))&&b(c.target).trigger("swipe")&&b(c.target).trigger("swipe"+a(c.x1,c.x2,c.y1,c.y2)),c.x1=c.x2=c.y1=c.y2=c.last=0):"last"in c&&(d=setTimeout(function(){d=null;b(c.target).trigger("tap");c={}},250))}).bind("touchcancel",function(){c={}})});"swipe swipeLeft swipeRight swipeUp swipeDown doubleTap tap longTap".split(" ").forEach(function(a){b.fn[a]=
function(b){return this.bind(a,b)}})})(Zepto);
(function(){function b(e,a,c){if(e===a)return 0!==e||1/e==1/a;if(null==e||null==a)return e===a;e._chain&&(e=e._wrapped);a._chain&&(a=a._wrapped);if(e.isEqual&&h.isFunction(e.isEqual))return e.isEqual(a);if(a.isEqual&&h.isFunction(a.isEqual))return a.isEqual(e);var k=n.call(e);if(k!=n.call(a))return!1;switch(k){case "[object String]":return e==String(a);case "[object Number]":return e!=+e?a!=+a:0==e?1/e==1/a:e==+a;case "[object Date]":case "[object Boolean]":return+e==+a;case "[object RegExp]":return e.source==
a.source&&e.global==a.global&&e.multiline==a.multiline&&e.ignoreCase==a.ignoreCase}if("object"!=typeof e||"object"!=typeof a)return!1;for(var d=c.length;d--;)if(c[d]==e)return!0;c.push(e);var d=0,f=!0;if("[object Array]"==k){if(d=e.length,f=d==a.length)for(;d--&&(f=d in e==d in a&&b(e[d],a[d],c)););}else{if("constructor"in e!="constructor"in a||e.constructor!=a.constructor)return!1;for(var y in e)if(h.has(e,y)&&(d++,!(f=h.has(a,y)&&b(e[y],a[y],c))))break;if(f){for(y in a)if(h.has(a,y)&&!d--)break;
f=!d}}c.pop();return f}var a=this,g=a._,c={},d=Array.prototype,f=Object.prototype,l=d.slice,p=d.unshift,n=f.toString,t=f.hasOwnProperty,r=d.forEach,m=d.map,u=d.reduce,v=d.reduceRight,q=d.filter,z=d.every,w=d.some,A=d.indexOf,D=d.lastIndexOf,f=Array.isArray,C=Object.keys,x=Function.prototype.bind,h=function(e){return new E(e)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=h),exports._=h):a._=h;h.VERSION="1.3.1";var s=h.each=h.forEach=function(e,
a,b){if(null!=e)if(r&&e.forEach===r)e.forEach(a,b);else if(e.length===+e.length)for(var k=0,d=e.length;k<d&&!(k in e&&a.call(b,e[k],k,e)===c);k++);else for(k in e)if(h.has(e,k)&&a.call(b,e[k],k,e)===c)break};h.map=h.collect=function(e,a,b){var c=[];if(null==e)return c;if(m&&e.map===m)return e.map(a,b);s(e,function(e,k,d){c[c.length]=a.call(b,e,k,d)});e.length===+e.length&&(c.length=e.length);return c};h.reduce=h.foldl=h.inject=function(e,a,b,c){var k=2<arguments.length;null==e&&(e=[]);if(u&&e.reduce===
u)return c&&(a=h.bind(a,c)),k?e.reduce(a,b):e.reduce(a);s(e,function(e,d,f){k?b=a.call(c,b,e,d,f):(b=e,k=!0)});if(!k)throw new TypeError("Reduce of empty array with no initial value");return b};h.reduceRight=h.foldr=function(a,b,c,k){var d=2<arguments.length;null==a&&(a=[]);if(v&&a.reduceRight===v)return k&&(b=h.bind(b,k)),d?a.reduceRight(b,c):a.reduceRight(b);var f=h.toArray(a).reverse();k&&!d&&(b=h.bind(b,k));return d?h.reduce(f,b,c,k):h.reduce(f,b)};h.find=h.detect=function(a,b,c){var k;F(a,function(a,
e,d){if(b.call(c,a,e,d))return k=a,!0});return k};h.filter=h.select=function(a,b,c){var k=[];if(null==a)return k;if(q&&a.filter===q)return a.filter(b,c);s(a,function(a,e,d){b.call(c,a,e,d)&&(k[k.length]=a)});return k};h.reject=function(a,b,c){var k=[];if(null==a)return k;s(a,function(a,e,d){b.call(c,a,e,d)||(k[k.length]=a)});return k};h.every=h.all=function(a,b,k){var d=!0;if(null==a)return d;if(z&&a.every===z)return a.every(b,k);s(a,function(a,e,f){if(!(d=d&&b.call(k,a,e,f)))return c});return d};
var F=h.some=h.any=function(a,b,k){b||(b=h.identity);var d=!1;if(null==a)return d;if(w&&a.some===w)return a.some(b,k);s(a,function(a,e,f){if(d||(d=b.call(k,a,e,f)))return c});return!!d};h.include=h.contains=function(a,b){var c=!1;return null==a?c:A&&a.indexOf===A?-1!=a.indexOf(b):c=F(a,function(a){return a===b})};h.invoke=function(a,b){var c=l.call(arguments,2);return h.map(a,function(a){return(h.isFunction(b)?b||a:a[b]).apply(a,c)})};h.pluck=function(a,b){return h.map(a,function(a){return a[b]})};
h.max=function(a,b,c){if(!b&&h.isArray(a))return Math.max.apply(Math,a);if(!b&&h.isEmpty(a))return-Infinity;var k={computed:-Infinity};s(a,function(a,e,d){e=b?b.call(c,a,e,d):a;e>=k.computed&&(k={value:a,computed:e})});return k.value};h.min=function(a,b,c){if(!b&&h.isArray(a))return Math.min.apply(Math,a);if(!b&&h.isEmpty(a))return Infinity;var k={computed:Infinity};s(a,function(a,e,d){e=b?b.call(c,a,e,d):a;e<k.computed&&(k={value:a,computed:e})});return k.value};h.shuffle=function(a){var b=[],c;
s(a,function(a,e,k){0==e?b[0]=a:(c=Math.floor(Math.random()*(e+1)),b[e]=b[c],b[c]=a)});return b};h.sortBy=function(a,b,c){return h.pluck(h.map(a,function(a,e,k){return{value:a,criteria:b.call(c,a,e,k)}}).sort(function(a,b){var e=a.criteria,c=b.criteria;return e<c?-1:e>c?1:0}),"value")};h.groupBy=function(a,b){var c={},k=h.isFunction(b)?b:function(a){return a[b]};s(a,function(a,b){var e=k(a,b);(c[e]||(c[e]=[])).push(a)});return c};h.sortedIndex=function(a,b,c){c||(c=h.identity);for(var k=0,d=a.length;k<
d;){var f=k+d>>1;c(a[f])<c(b)?k=f+1:d=f}return k};h.toArray=function(a){return!a?[]:a.toArray?a.toArray():h.isArray(a)||h.isArguments(a)?l.call(a):h.values(a)};h.size=function(a){return h.toArray(a).length};h.first=h.head=function(a,b,c){return null!=b&&!c?l.call(a,0,b):a[0]};h.initial=function(a,b,c){return l.call(a,0,a.length-(null==b||c?1:b))};h.last=function(a,b,c){return null!=b&&!c?l.call(a,Math.max(a.length-b,0)):a[a.length-1]};h.rest=h.tail=function(a,b,c){return l.call(a,null==b||c?1:b)};
h.compact=function(a){return h.filter(a,function(a){return!!a})};h.flatten=function(a,b){return h.reduce(a,function(a,e){if(h.isArray(e))return a.concat(b?e:h.flatten(e));a[a.length]=e;return a},[])};h.without=function(a){return h.difference(a,l.call(arguments,1))};h.uniq=h.unique=function(a,b,c){c=c?h.map(a,c):a;var k=[];h.reduce(c,function(c,d,f){if(0==f||(!0===b?h.last(c)!=d:!h.include(c,d)))c[c.length]=d,k[k.length]=a[f];return c},[]);return k};h.union=function(){return h.uniq(h.flatten(arguments,
!0))};h.intersection=h.intersect=function(a){var b=l.call(arguments,1);return h.filter(h.uniq(a),function(a){return h.every(b,function(b){return 0<=h.indexOf(b,a)})})};h.difference=function(a){var b=h.flatten(l.call(arguments,1));return h.filter(a,function(a){return!h.include(b,a)})};h.zip=function(){for(var a=l.call(arguments),b=h.max(h.pluck(a,"length")),c=Array(b),k=0;k<b;k++)c[k]=h.pluck(a,""+k);return c};h.indexOf=function(a,b,c){if(null==a)return-1;var k;if(c)return c=h.sortedIndex(a,b),a[c]===
b?c:-1;if(A&&a.indexOf===A)return a.indexOf(b);c=0;for(k=a.length;c<k;c++)if(c in a&&a[c]===b)return c;return-1};h.lastIndexOf=function(a,b){if(null==a)return-1;if(D&&a.lastIndexOf===D)return a.lastIndexOf(b);for(var c=a.length;c--;)if(c in a&&a[c]===b)return c;return-1};h.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);c=arguments[2]||1;for(var k=Math.max(Math.ceil((b-a)/c),0),d=0,f=Array(k);d<k;)f[d++]=a,a+=c;return f};var B=function(){};h.bind=function(a,b){var c,k;if(a.bind===x&&x)return x.apply(a,
l.call(arguments,1));if(!h.isFunction(a))throw new TypeError;k=l.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,k.concat(l.call(arguments)));B.prototype=a.prototype;var d=new B,f=a.apply(d,k.concat(l.call(arguments)));return Object(f)===f?f:d}};h.bindAll=function(a){var b=l.call(arguments,1);0==b.length&&(b=h.functions(a));s(b,function(b){a[b]=h.bind(a[b],a)});return a};h.memoize=function(a,b){var c={};b||(b=h.identity);return function(){var k=b.apply(this,arguments);
return h.has(c,k)?c[k]:c[k]=a.apply(this,arguments)}};h.delay=function(a,b){var c=l.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)};h.defer=function(a){return h.delay.apply(h,[a,1].concat(l.call(arguments,1)))};h.throttle=function(a,b){var c,k,d,f,y,g=h.debounce(function(){y=f=!1},b);return function(){c=this;k=arguments;d||(d=setTimeout(function(){d=null;y&&a.apply(c,k);g()},b));f?y=!0:a.apply(c,k);g();f=!0}};h.debounce=function(a,b){var c;return function(){var k=this,d=arguments;
clearTimeout(c);c=setTimeout(function(){c=null;a.apply(k,d)},b)}};h.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}};h.wrap=function(a,b){return function(){var c=[a].concat(l.call(arguments,0));return b.apply(this,c)}};h.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};h.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};h.keys=
C||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)h.has(a,c)&&(b[b.length]=c);return b};h.values=function(a){return h.map(a,h.identity)};h.functions=h.methods=function(a){var b=[],c;for(c in a)h.isFunction(a[c])&&b.push(c);return b.sort()};h.extend=function(a){s(l.call(arguments,1),function(b){for(var c in b)a[c]=b[c]});return a};h.defaults=function(a){s(l.call(arguments,1),function(b){for(var c in b)null==a[c]&&(a[c]=b[c])});return a};h.clone=function(a){return!h.isObject(a)?
a:h.isArray(a)?a.slice():h.extend({},a)};h.tap=function(a,b){b(a);return a};h.isEqual=function(a,c){return b(a,c,[])};h.isEmpty=function(a){if(h.isArray(a)||h.isString(a))return 0===a.length;for(var b in a)if(h.has(a,b))return!1;return!0};h.isElement=function(a){return!!(a&&1==a.nodeType)};h.isArray=f||function(a){return"[object Array]"==n.call(a)};h.isObject=function(a){return a===Object(a)};h.isArguments=function(a){return"[object Arguments]"==n.call(a)};h.isArguments(arguments)||(h.isArguments=
function(a){return!(!a||!h.has(a,"callee"))});h.isFunction=function(a){return"[object Function]"==n.call(a)};h.isString=function(a){return"[object String]"==n.call(a)};h.isNumber=function(a){return"[object Number]"==n.call(a)};h.isNaN=function(a){return a!==a};h.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==n.call(a)};h.isDate=function(a){return"[object Date]"==n.call(a)};h.isRegExp=function(a){return"[object RegExp]"==n.call(a)};h.isNull=function(a){return null===a};h.isUndefined=
function(a){return void 0===a};h.has=function(a,b){return t.call(a,b)};h.noConflict=function(){a._=g;return this};h.identity=function(a){return a};h.times=function(a,b,c){for(var k=0;k<a;k++)b.call(c,k)};h.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};h.mixin=function(a){s(h.functions(a),function(b){J(b,h[b]=a[b])})};var G=0;h.uniqueId=function(a){var b=G++;return a?a+b:b};h.templateSettings=
{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var k=/.^/,y=function(a){return a.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};h.template=function(a,b){var c=h.templateSettings,c="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.escape||k,function(a,b){return"',_.escape("+y(b)+"),'"}).replace(c.interpolate||k,function(a,b){return"',"+y(b)+",'"}).replace(c.evaluate||k,function(a,
b){return"');"+y(b).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",d=new Function("obj","_",c);return b?d(b,h):function(a){return d.call(this,a,h)}};h.chain=function(a){return h(a).chain()};var E=function(a){this._wrapped=a};h.prototype=E.prototype;var H=function(a,b){return b?h(a).chain():a},J=function(a,b){E.prototype[a]=function(){var a=l.call(arguments);p.call(a,this._wrapped);return H(b.apply(h,a),this._chain)}};
h.mixin(h);s("pop push reverse shift sort splice unshift".split(" "),function(a){var b=d[a];E.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var k=c.length;("shift"==a||"splice"==a)&&0===k&&delete c[0];return H(c,this._chain)}});s(["concat","join","slice"],function(a){var b=d[a];E.prototype[a]=function(){return H(b.apply(this._wrapped,arguments),this._chain)}});E.prototype.chain=function(){this._chain=!0;return this};E.prototype.value=function(){return this._wrapped}}).call(this);
(function(){var b=this,a=b.Backbone,g=Array.prototype.slice,c=Array.prototype.splice,d;d="undefined"!==typeof exports?exports:b.Backbone={};d.VERSION="0.9.2";var f=b._;!f&&"undefined"!==typeof require&&(f=require("underscore"));var l=b.jQuery||b.Zepto||b.ender;d.setDomLibrary=function(a){l=a};d.noConflict=function(){b.Backbone=a;return this};d.emulateHTTP=!1;d.emulateJSON=!1;var p=/\s+/,n=d.Events={on:function(a,b,c){var d,f,e,h,g;if(!b)return this;a=a.split(p);for(d=this._callbacks||(this._callbacks=
{});f=a.shift();)e=(g=d[f])?g.tail:{},e.next=h={},e.context=c,e.callback=b,d[f]={tail:h,next:g?g.next:e};return this},off:function(a,b,c){var d,h,e,g,l,m;if(h=this._callbacks){if(!a&&!b&&!c)return delete this._callbacks,this;for(a=a?a.split(p):f.keys(h);d=a.shift();)if(e=h[d],delete h[d],e&&(b||c))for(g=e.tail;(e=e.next)!==g;)if(l=e.callback,m=e.context,b&&l!==b||c&&m!==c)this.on(d,l,m);return this}},trigger:function(a){var b,c,d,f,e,h;if(!(d=this._callbacks))return this;e=d.all;a=a.split(p);for(h=
g.call(arguments,1);b=a.shift();){if(c=d[b])for(f=c.tail;(c=c.next)!==f;)c.callback.apply(c.context||this,h);if(c=e){f=c.tail;for(b=[b].concat(h);(c=c.next)!==f;)c.callback.apply(c.context||this,b)}}return this}};n.bind=n.on;n.unbind=n.off;var t=d.Model=function(a,b){var c;a||(a={});b&&b.parse&&(a=this.parse(a));if(c=B(this,"defaults"))a=f.extend({},c,a);b&&b.collection&&(this.collection=b.collection);this.attributes={};this._escapedAttributes={};this.cid=f.uniqueId("c");this.changed={};this._silent=
{};this._pending={};this.set(a,{silent:!0});this.changed={};this._silent={};this._pending={};this._previousAttributes=f.clone(this.attributes);this.initialize.apply(this,arguments)};f.extend(t.prototype,n,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return f.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;b=this.get(a);return this._escapedAttributes[a]=f.escape(null==
b?"":""+b)},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,h;f.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b);c||(c={});if(!d)return this;d instanceof t&&(d=d.attributes);if(c.unset)for(h in d)d[h]=void 0;if(!this._validate(d,c))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);b=c.changes={};var e=this.attributes,g=this._escapedAttributes,l=this._previousAttributes||{};for(h in d){a=d[h];if(!f.isEqual(e[h],a)||c.unset&&f.has(e,h))delete g[h],(c.silent?this._silent:
b)[h]=!0;c.unset?delete e[h]:e[h]=a;!f.isEqual(l[h],a)||f.has(e,h)!=f.has(l,h)?(this.changed[h]=a,c.silent||(this._pending[h]=!0)):(delete this.changed[h],delete this._pending[h])}c.silent||this.change(c);return this},unset:function(a,b){(b||(b={})).unset=!0;return this.set(a,null,b)},clear:function(a){(a||(a={})).unset=!0;return this.set(f.clone(this.attributes),a)},fetch:function(a){a=a?f.clone(a):{};var b=this,c=a.success;a.success=function(d,f,e){if(!b.set(b.parse(d,e),a))return!1;c&&c(b,d)};
a.error=d.wrapError(a.error,b,a);return(this.sync||d.sync).call(this,"read",this,a)},save:function(a,b,c){var h,g;f.isObject(a)||null==a?(h=a,c=b):(h={},h[a]=b);c=c?f.clone(c):{};if(c.wait){if(!this._validate(h,c))return!1;g=f.clone(this.attributes)}a=f.extend({},c,{silent:!0});if(h&&!this.set(h,c.wait?a:c))return!1;var e=this,l=c.success;c.success=function(a,b,d){b=e.parse(a,d);c.wait&&(delete c.wait,b=f.extend(h||{},b));if(!e.set(b,c))return!1;l?l(e,a):e.trigger("sync",e,a,c)};c.error=d.wrapError(c.error,
e,c);b=this.isNew()?"create":"update";b=(this.sync||d.sync).call(this,b,this,c);c.wait&&this.set(g,a);return b},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,h=function(){b.trigger("destroy",b,b.collection,a)};if(this.isNew())return h(),!1;a.success=function(d){a.wait&&h();c?c(b,d):b.trigger("sync",b,d,a)};a.error=d.wrapError(a.error,b,a);var g=(this.sync||d.sync).call(this,"delete",this,a);a.wait||h();return g},url:function(){var a=B(this,"urlRoot")||B(this.collection,"url")||G();
return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var c in this._silent)this._pending[c]=!0;var d=f.extend({},a.changes,this._silent);this._silent={};for(c in d)this.trigger("change:"+c,this,this.get(c),a);if(b)return this;for(;!f.isEmpty(this._pending);){this._pending=
{};this.trigger("change",this,a);for(c in this.changed)!this._pending[c]&&!this._silent[c]&&delete this.changed[c];this._previousAttributes=f.clone(this.attributes)}this._changing=!1;return this},hasChanged:function(a){return!arguments.length?!f.isEmpty(this.changed):f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._previousAttributes,h;for(h in a)if(!f.isEqual(d[h],b=a[h]))(c||(c={}))[h]=b;return c},previous:function(a){return!arguments.length||
!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return f.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validate(a,b);if(!c)return!0;b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b);return!1}});var r=d.Collection=function(a,b){b||(b={});b.model&&(this.model=b.model);b.comparator&&(this.comparator=b.comparator);
this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,{silent:!0,parse:b.parse})};f.extend(r.prototype,n,{model:t,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){var d,h,g,e,l,m={},q={},p=[];b||(b={});a=f.isArray(a)?a.slice():[a];d=0;for(h=a.length;d<h;d++){if(!(g=a[d]=this._prepareModel(a[d],b)))throw Error("Can't add an invalid model to a collection");e=g.cid;l=g.id;m[e]||this._byCid[e]||null!=l&&(q[l]||this._byId[l])?
p.push(d):m[e]=q[l]=g}for(d=p.length;d--;)a.splice(p[d],1);d=0;for(h=a.length;d<h;d++)(g=a[d]).on("all",this._onModelEvent,this),this._byCid[g.cid]=g,null!=g.id&&(this._byId[g.id]=g);this.length+=h;c.apply(this.models,[null!=b.at?b.at:this.models.length,0].concat(a));this.comparator&&this.sort({silent:!0});if(b.silent)return this;d=0;for(h=this.models.length;d<h;d++)if(m[(g=this.models[d]).cid])b.index=d,g.trigger("add",g,this,b);return this},remove:function(a,b){var c,d,h,e;b||(b={});a=f.isArray(a)?
a.slice():[a];c=0;for(d=a.length;c<d;c++)if(e=this.getByCid(a[c])||this.get(a[c]))delete this._byId[e.id],delete this._byCid[e.cid],h=this.indexOf(e),this.models.splice(h,1),this.length--,b.silent||(b.index=h,e.trigger("remove",e,this,b)),this._removeReference(e);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,b);return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,f.extend({at:0},b));return a},
shift:function(a){var b=this.at(0);this.remove(b,a);return b},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return f.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var b=f.bind(this.comparator,this);1==this.comparator.length?
this.models=this.sortBy(b):this.models.sort(b);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return f.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);this._reset();this.add(a,f.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a=a?f.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(d,
f,e){b[a.add?"add":"reset"](b.parse(d,e),a);c&&c(b,d)};a.error=d.wrapError(a.error,b,a);return(this.sync||d.sync).call(this,"read",this,a)},create:function(a,b){var c=this;b=b?f.clone(b):{};a=this._prepareModel(a,b);if(!a)return!1;b.wait||c.add(a,b);var d=b.success;b.success=function(f,e,h){b.wait&&c.add(f,b);d?d(f,e):f.trigger("sync",a,e,b)};a.save(null,b);return a},parse:function(a,b){return a},chain:function(){return f(this.models).chain()},_reset:function(a){this.length=0;this.models=[];this._byId=
{};this._byCid={}},_prepareModel:function(a,b){b||(b={});a instanceof t?a.collection||(a.collection=this):(b.collection=this,a=new this.model(a,b),a._validate(a.attributes,b)||(a=!1));return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,
arguments))}});f.each("forEach each map reduce reduceRight find detect filter select reject every all some any include contains invoke max min sortBy sortedIndex toArray size first initial rest last without indexOf shuffle lastIndexOf isEmpty groupBy".split(" "),function(a){r.prototype[a]=function(){return f[a].apply(f,[this.models].concat(f.toArray(arguments)))}});var m=d.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},u=/:\w+/g,
v=/\*\w+/g,q=/[-[\]{}()+?.,\\^$|#\s]/g;f.extend(m.prototype,n,{initialize:function(){},route:function(a,b,c){d.history||(d.history=new z);f.isRegExp(a)||(a=this._routeToRegExp(a));c||(c=this[b]);d.history.route(a,f.bind(function(f){f=this._extractParameters(a,f);c&&c.apply(this,f);this.trigger.apply(this,["route:"+b].concat(f));d.history.trigger("route",this,b,f)},this));return this},navigate:function(a,b){d.history.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,
this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(q,"\\$&").replace(u,"([^/]+)").replace(v,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var z=d.History=function(){this.handlers=[];f.bindAll(this,"checkUrl")},w=/^[#\/]/,A=/msie [\w.]+/;z.started=!1;f.extend(z.prototype,n,{interval:50,getHash:function(a){return(a=(a?a.location:window.location).href.match(/#(.*)$/))?a[1]:
""},getFragment:function(a,b){if(null==a)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c)}else a=this.getHash();a.indexOf(this.options.root)||(a=a.substr(this.options.root.length));return a.replace(w,"")},start:function(a){if(z.started)throw Error("Backbone.history has already been started");z.started=!0;this.options=f.extend({},{root:"/"},this.options,a);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=
!(!this.options.pushState||!window.history||!window.history.pushState);a=this.getFragment();var b=document.documentMode;if(b=A.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b))this.iframe=l('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?l(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!b?l(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,
this.interval));this.fragment=a;a=window.location;b=a.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&(this._hasPushState&&b&&a.hash)&&(this.fragment=this.getHash().replace(w,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},
stop:function(){l(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);z.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a==this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return f.any(this.handlers,
function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!z.started)return!1;if(!b||!0===b)b={trigger:b};var c=(a||"").replace(w,"");this.fragment!=c&&(this._hasPushState?(0!=c.indexOf(this.options.root)&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||
this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a))},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var D=d.View=function(a){this.cid=f.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},C=/^(\S+)\s*(.*)$/,x="model collection el id attributes className tagName".split(" ");
f.extend(D.prototype,n,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(a,b,c){a=document.createElement(a);b&&l(a).attr(b);c&&l(a).html(c);return a},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof l?a:l(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=B(this,"events"))){this.undelegateEvents();
for(var b in a){var c=a[b];f.isFunction(c)||(c=this[a[b]]);if(!c)throw Error('Method "'+a[b]+'" does not exist');var d=b.match(C),h=d[1],d=d[2],c=f.bind(c,this),h=h+(".delegateEvents"+this.cid);""===d?this.$el.bind(h,c):this.$el.delegate(d,h,c)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=f.extend({},this.options,a));for(var b=0,c=x.length;b<c;b++){var d=x[b];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,
!1);else{var a=B(this,"attributes")||{};this.id&&(a.id=this.id);this.className&&(a["class"]=this.className);this.setElement(this.make(this.tagName,a),!1)}}});t.extend=r.extend=m.extend=D.extend=function(a,b){var c=F(this,a,b);c.extend=this.extend;return c};var h={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};d.sync=function(a,b,c){var g=h[a];c||(c={});var m={type:g,dataType:"json"};c.url||(m.url=B(b,"url")||G());if(!c.data&&b&&("create"==a||"update"==a))m.contentType="application/json",
m.data=JSON.stringify(b.toJSON());d.emulateJSON&&(m.contentType="application/x-www-form-urlencoded",m.data=m.data?{model:m.data}:{});if(d.emulateHTTP&&("PUT"===g||"DELETE"===g))d.emulateJSON&&(m.data._method=g),m.type="POST",m.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g)};"GET"!==m.type&&!d.emulateJSON&&(m.processData=!1);return l.ajax(f.extend(m,c))};d.wrapError=function(a,b,c){return function(d,f){f=d===b?f:d;a?a(b,f,c):b.trigger("error",b,f,c)}};var s=function(){},F=function(a,
b,c){var d;d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)};f.extend(d,a);s.prototype=a.prototype;d.prototype=new s;b&&f.extend(d.prototype,b);c&&f.extend(d,c);d.prototype.constructor=d;d.__super__=a.prototype;return d},B=function(a,b){return!a||!a[b]?null:f.isFunction(a[b])?a[b]():a[b]},G=function(){throw Error('A "url" property or function must be specified');}}).call(this);$.fn.clone=function(){var b=[];this.each(function(){b.push(this.cloneNode(!0))});return $(b)};
$.scrollTop=function(b){if(b||0===b)document.body.scrollTop=b;else return document.body.scrollTop};
(function(){(function(b){return b.fn.hoover=function(a){var g,c,d,f,l,p,n;g=this;n=null;d=!1;p={"in":250,out:150};a&&b.extend(p,a);c=function(){g.trigger("hooverIn");l();return d=!0};f=function(){g.trigger("hooverOut");l();return d=!1};l=function(){n&&clearTimeout(n);return n=null};g.bind("mouseover",function(){if(d)return l();if(!n)return n=setTimeout(c,p["in"])});g.bind("mouseout",function(){return d?(n&&l(),n=setTimeout(f,p.out)):l()});return this}})(window.Zepto||window.jQuery)}).call(this);
var Routes={routes:{decline:"decline",complete:"complete",place:"place",schedule:"schedule","*actions":"invitation"}},Views={},Behaviors={},App={params:{os_offset:0},reply:{timeslots:{},location:{}},initialize:function(){"iPhone"==Env.device.device&&7>Env.device.version&&(this.params.os_offset=60);var b=window.location.hash.replace("#","");b in Routes.routes&&(window.localStorage&&window.localStorage.getItem("current_meeting"))&&(b=window.localStorage.getItem("current_meeting"));window.localStorage&&
window.localStorage.getItem("meeting_"+b)?(App.meeting=JSON.parse(window.localStorage.getItem("meeting_"+b)),window.localStorage.getItem("reply_"+b)&&(App.reply=JSON.parse(window.localStorage.getItem("reply_"+b))),App.launch()):0<b.length?(App.loader(),App.api.request("get@meetings/"+b,{success:function(){App.save_meeting(this)}})):$("#wrapper").append($(Templates.error).html())},save_meeting:function(b){200==b.code?(App.meeting=b.data,window.localStorage&&(window.localStorage.setItem("meeting_"+
App.meeting.id,JSON.stringify(b.data)),window.localStorage.setItem("current_meeting",App.meeting.id)),App.launch()):$("#wrapper").append($(Templates.error).html());App.end_loading()},save_reply:function(){window.localStorage.setItem("reply_"+App.meeting.id,JSON.stringify(App.reply))},launch:function(){Nav.initialize({remove_views:!1,no_access_animation:"slide",ui_delay:500})},before_transition:function(){Nav.view.requests=[];App.resize();$.fn.placeholder&&Nav.view.$el.find("input[type=text], input[type=date], input[type=password], textarea").placeholder()},
after_transition:function(){Nav.elmt.css({height:Nav.view.$el.height()})},before_unload:function(){Nav.view.requests&&App.cancel_requests()},send_reply:function(b){App.api.request("put@meetings/"+App.meeting.id,{data:App.reply,success:function(){204==this.code&&b()}})},cancel_requests:function(){for(var b=0;b<Nav.view.requests.length;b++)Nav.view.requests[b].abort();Nav.view.refreshing=!1;Nav.view.requests=[]},resize:function(){0<App.params.os_offset&&(Ui.min_height=$(window).height()+App.params.os_offset,
App.params.os_offset=0);var b=Nav.elmt.is("#wrapper")?$("header").height():0,a=App.get_auto_height(Nav.view.$el),g=App.get_auto_height(Nav.elmt);a+b+App.params.os_offset<Ui.min_height?Nav.view.$el.css({height:Ui.min_height-b+App.params.os_offset}):Nav.view.$el.css({height:a});b=[a,g,$(window).height()];Nav.current_transition&&b.push(Nav.current_transition.prev_view.$el.height());b=_.max(b);Nav.elmt.css({height:b})},reset_and_resize:function(){Nav.elmt.css({height:"auto"});Nav.view.$el.css({height:"auto"});
Nav.run("resize")},get_auto_height:function(b){var a=b.clone();a.css({visibility:"hidden",height:"auto"});b.after(a);b=a.height();a.remove();return b},loader:function(){App.loader_elmt=$('<div class="loader"><span></span></div>');(Nav.view?Nav.view.$el:$("#wrapper")).append(App.loader_elmt.css({opacity:0}));App.loader_elmt.animate({opacity:1})},end_loading:function(b){App.loader_elmt&&App.loader_elmt.animate({opacity:0},{complete:function(){App.loader_elmt.remove();App.loader_elmt=null;b&&b()}})},
get_dates:function(b,a){for(var g=[],c=b;c<=a;)g.push(new Date(c)),c=c.addDays(1);return g},parse_date:function(b){return"function"==typeof Date.iso_date_parser?Date.iso_date_parser(b):Date.parse(b)},date:function(b,a){"string"==typeof b&&(b=App.parse_date(b));var g=new Date(b);return"January February March April May June July August September October November December".split(" ")[g.getMonth()]+" "+App.ordinal_number(g.getDate())+" "+g.getFullYear()},ordinal_number:function(b){var a=["th","st","nd",
"rd"],g=b%100;return b+(a[(g-20)%10]||a[g]||a[0])},date_number:function(b){return 1==b.toString().length?"0"+b:b},get_position:function(b){b({latitude:52.495971,longitude:13.453954});return!1}};Date.prototype.addDays=function(b){var a=new Date(this.valueOf());a.setDate(a.getDate()+b);return a};$.fn.prop=$.fn.prop||$.fn.attr;String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};$(document).ready(function(){App.initialize()});
App.api={request:function(b,a){var g={};g.url="/"+b.split("@")[1];g.method=b.split("@")[0];a.data||(a.data={});a.vars&&_.each(a.vars,function(a,b){g.url=g.url.replace("{"+b+"}",a)});a.data&&("post"==g.method||"put"==g.method?g.data=a.data:-1==g.url.indexOf("?")?g.url+="?"+$.param(a.data):g.url+="&"+$.param(a.data));return $.ajax({type:"post",data:g,url:"/api",dataType:"json",timeout:2E4,success:function(b){a.success.apply(b,[b])},error:a.error})}};
(function(b,a,g){a.support=a.support||{};a.support.touch="ontouchend"in document;a.support.mouse=!0==a.os.blackberry||!a.support.touch;a.support.webkit=(document.body||document.documentElement).style.WebkitTransition!==g;a.support.webkit3d="WebKitCSSMatrix"in b&&"m11"in new WebKitCSSMatrix;b=a.support;g=document.createElement("input");g.setAttribute("type","file");b.upload=!g.disabled;a.browser=a.browser||{};a.browser.chrome=!!navigator.userAgent.match(/chrome/i)})(window,$);
(function(b,a,g){function c(c){function l(c){a(document.body).on("mousemove",function(){v=!1});c.on("mouseover mousedown",function(a){!1==v&&t(a)});c.on("mouseout mouseup",function(a){!1==v&&r(a)});c.on("click",function(a){!(b.isFakeEvent!==g&&!0===b.isFakeEvent(a))&&!1==v&&m(a)})}function p(b){b.on("click",function(a){a.preventDefault()});b.each(function(){var b=0,g=0,l=null,p=!1,q=this;a(q).on("touchstart",function(c){a.support.mouse&&(v=!0);b=c.targetTouches[0].clientX;g=c.targetTouches[0].clientY;
n();0>d.indexOf(q)&&(d.push(q),l=setTimeout(function(){l=null;t(c)},150))},!1);a(q).on("touchmove",function(a){if(!p&&(Math.abs(a.targetTouches[0].clientX-b)>c.distance||Math.abs(a.targetTouches[0].clientY-g)>c.distance))p=!0,l?(clearTimeout(l),l=null):r(a)},!1);a(q).on("touchend",function(a){!p&&0<=d.indexOf(q)&&(null!==l?(clearTimeout(l),l=null,t(a),setTimeout(function(){m(a);setTimeout(function(){r(a)},100)},100)):(m(a),r(a)));p=!1},!1)})}function n(){for(var a=0;a<d.length;a++)r({target:d[a],
preventDefault:function(){},stopPropagation:function(){}})}function t(b){var d=a(b.target).is("a")?a(b.target):a(b.target).parents("a");d.addClass(c.hover_class);c.enter.apply(d,[b])}function r(b){var g=a(b.target).is("a")?a(b.target):a(b.target).parents("a");g.removeClass(c.hover_class);c.leave.apply(g,[b]);b=[];for(var l=0;l<d.length;l++)d[l]!==g.get(0)&&b.push(d[l]);d=b}function m(b){b.preventDefault();var d=a(b.target).is("a")?a(b.target):a(b.target).parents("a");c.run.apply(d,[b,d.attr("data-href")])}
c=a.extend({hover_class:"hover",time:500,distance:15,leave:function(){},enter:function(){},run:function(){}},c);var u=a(this),v=a.support.mouse;(function(b){b.each(function(){var b=a(this);null==b.attr("data-href")&&b.attr("data-href",b.attr("href"))})})(u);a.support.touch&&(p(u),u.attr("href",""));a.support.mouse&&l(u);u.on("run",function(a){m(a)});return a(this)}var d=[];a.fn.link=a.fn.link||c})(window,$);
(function(b,a,g){b.Nav={moves:[],views:[],options:{},initialize:function(c){Nav.options=_.extend({elmt:"#wrapper",append_to:"#wrapper",ui_delay:0,access_filter:function(){return!0},remove_views:!0},c);Nav.set_browser_prefs();Nav.elmt=a(Nav.options.elmt);Nav.append_to=a(Nav.options.append_to);c=Backbone.Router.extend(Routes);Nav.router=new c;Backbone.history.start();var d=Backbone.history.getFragment(b.location.hash),f=this.get_view_for(d);Nav.view=Nav.new_view(f,d);Nav.params=Nav.router._extractParameters(this.get_route_for(d).route,
Backbone.history.getFragment(d));c=Nav.check_access_filter(Nav.view);!0!==c?(f=Nav.get_view_for(c),Nav.view=Nav.new_view(f),Nav.url_before_access_filter=d,b.localStorage&&b.localStorage.setItem("url_before_access_filter",d),b.location.replace("#"+c),d=Backbone.history.getFragment(c),Nav.params=Nav.router._extractParameters(this.get_route_for(d).route,Backbone.history.getFragment(d))):b.localStorage&&(Nav.url_before_access_filter=b.localStorage.getItem("url_before_access_filter"));this.history();Nav.controller=
f;""==b.location.hash?b.location.href="#":a.os.ios&&7>a.os.version.split(".")[0]&&b.scrollTo(0,1);this.load_page(Nav.view,{complete:function(){Nav.insert(Nav.view);Nav.moves.push({path:"/"+d,view:f,instance:Nav.view});Nav.views.push({path:"/"+d,view:f,instance:Nav.view});Nav.moves.current=Nav.moves[0];Nav.run("after_transition",[Nav.view]);Nav.run("after_initialize",[Nav.view])}});a.os.ios&&7>a.os.version.split(".")[0]&&Nav.hide_ios_bar();Nav.init_resizing()},history:function(){_.extend(Backbone.history,
BackboneHistoryExt);Backbone.history.on("route",function(a,b,f){Nav.controller=b;Nav.params=f;Nav.view.path=Backbone.history.getFragment(Backbone.history.get_current_path());Nav.view.params=f;Nav.run("url_changed",[Nav.view]);"object"!==typeof Nav.current_transition&&Nav.go(Backbone.history.get_current_path(),null,{back:!0})})},init_resizing:function(){var c=function(){b.setTimeout(function(){a.os.ios&&(7>a.os.version.split(".")[0]&&0==a.scrollTop())&&b.scrollTo(0,1);Nav.run("resize",[Nav.view])},
Nav.options.ui_delay)};if(b.orientationchange!==g)a(b).on("orientationchange",function(){c()});else a(b).on("resize",function(){c()})},go:function(b,d,f){if(Nav.moves.current&&b==Nav.moves.current.path||"object"==typeof Nav.current_transition)return!1;Nav.current_transition=f||{};Nav.current_transition.url=b;Nav.current_transition.prev_view=this.view;var l=Nav.get_view_for(b),p=this.view,n=Nav.current_transition.view!==g?Nav.current_transition.view:this.get_freshest_view_for(b,l);if(!0===Nav.current_transition.back&&
(null==d||0==d.length)&&p.animation){var t=p.animation;d=Nav.opposite_animation(p.animation)}f&&f.data&&!n.data&&(n.data=f.data);var r=Nav.get_method(d,n);Nav.run("before_unload",[Nav.view]);var m=Nav.check_access_filter(n);if(!0!==m)return l=Nav.get_view_for(m),Nav.new_view(l,m),d=Nav.options.no_access_animation||d,Nav.current_transition=!1,Nav.go(m,d,f),!1;Nav.view=n;!0!==Nav.current_transition.back?(Nav.view.animation=d,Nav.view.history_index=Nav.moves.length):(Nav.view.animation=t,Nav.view.history_index=
Nav.moves.length-1);Nav.auto_links();!0!==Nav.current_transition.back&&Nav.router.navigate(b,{trigger:!0});n.$el.attr("style","");a.scrollTop(0);r.apply(Nav,[p,n,function(){!0==Nav.options.remove_views?(p.$el.remove(),p.inserted=!1):p.$el.hide();!0!==Nav.current_transition.back?(Nav.moves.push({path:b,view:l,animation:d,instance:n}),Nav.views.push({path:b,view:l,animation:d,instance:n})):Nav.cut_moves_at(Nav.view.history_index);Nav.moves.current=Nav.moves[Nav.moves.length-1];Nav.run("after_unload",
[Nav.current_transition.prev_view]);Nav.run("after_transition",[Nav.view]);(Nav.current_transition.after_transition||function(){}).apply(Nav.view,[Nav.view.first_time]);Nav.current_transition=g}])},check_access_filter:function(a){a=("function"==typeof a.access_filter?a.access_filter:Nav.options.access_filter).apply(a);return!0!==a&&"string"==typeof a?a:!0},get_method:function(b,d){var f=Animation[b]!==g?Animation[b]:Animation.standard;if(a.os.blackberry)if(7<=parseInt(a.os.version)){if("slide"==b||
"slide_back"==b)f=Animation.direct}else f=Animation.direct;d&&(d.use_transition&&Animation[d.use_transition])&&(f=Animation[d.use_transition]);return f},run:function(a,b,f){b=b||[];(Ui[a]||function(){}).apply(Ui,f);(App[a]||function(){}).apply(App,f);"object"==typeof Nav.current_transition&&(Nav.current_transition[a]||function(){}).apply(Nav,f);_.each(b,function(b){"function"==typeof b.run?b.run(a,f):(b[a]||function(){}).apply(b,f)})},load_page:function(b,d){b.remote==g?d.complete():"function"==typeof b.remote?
((d.loading||Nav.loading||function(){}).apply(b,[b]),b.remote.apply(b,[d])):((d.loading||Nav.loading||function(){})(),b.get_params!==g&&(b.remote.data=b.get_params()),a.ajax(a.extend({type:"get",success:function(b){a("#loader").remove();Nav.view.data=b;d.complete()}},b.remote)))},insert:function(b,d){Nav.run("before_insert",[b],[b.first_time]);d=a.extend({callbacks:!0},d||{});!0!==b.inserted?(b.render(),(d.before_append||function(){})(),(d.before_append_or_display||function(){})(),Nav.append_to.append(b.$el),
Nav.auto_links(b.$el),b.inserted=!0,b.first_time=!0):((d.before_display||function(){})(),(d.before_append_or_display||function(){})(),b.$el.show(),b.first_time=!1);!0==d.callbacks&&Nav.run("before_transition",[b],[b.first_time])},loading:function(){Nav.run("loading");if(0==a("#loader").length){var b=a('<div id="loader" class="live"><p>'+App.loading_text[App.locale]+"...</p><span></span></div>");a(document.body).append(b)}},set_browser_prefs:function(){a.os.android&&(Nav.options.ui_delay=300)},opposite_animation:function(a){switch(a){case "fall":return"sky";
case "sky":return"fall";case "from_the_ground":return"to_the_ground";case "to_the_ground":return"from_the_ground";case "slide":return"slide_back";case "slide_back":return"slide";case "cover":return"uncover";case "fadein":return"fadeout"}},hide_ios_bar:function(){b.setTimeout(function(){0==a.scrollTop()&&(b.scrollTo(0,1),Nav.hide_ios_bar())},3E3)},auto_links:function(a){a=a||Nav.view.$el;a.find("a[data-auto]").link({run:function(a,c){a.preventDefault();this.hasClass("back")?b.history.back():Nav.go(c,
this.attr("data-auto"))}})},new_view:function(a,d){var f=new b.Views[a];f.name=a;f.path=d;return f},get_view_for:function(a){a=Backbone.history.getFragment(a);var d=!1,f=0;matched=_.any(b.Routes.routes,function(b,g){if(Backbone.history.handlers[f].route.test(a))return d=b,!0;f++});return d},get_route_for:function(a){a=Backbone.history.getFragment(a);var b=!1,f=0;matched=_.any(Backbone.history.handlers,function(g){if(g.route.test(a))return b=g,!0;f++});return b},get_freshest_view_for:function(a,b){for(var f=
Nav.views.length-1;0<=f;f--)if(Nav.views[f].path==a&&!0==Nav.views[f].instance.inserted)return Nav.views[f].instance;return Nav.new_view(b,a)},get_last_view_for:function(a){for(var b=Nav.moves.length-1;0<=b;b--)if(Nav.views[b].path==a)return Nav.moves[b].instance;return!1},get_prev_view_for:function(a){for(var b=0,f=Nav.moves.length-1;0<=f;f--)if(Nav.views[f].path==a)if(0==b)b++;else return Nav.moves[f].instance;return!1},cut_moves_at:function(a){for(var b=[],f=0;f<Nav.moves.length;f++)if(f<a)b.push(Nav.moves[f]);
else break;Nav.moves=b;0==Nav.moves.length&&(Nav.moves.push({path:Nav.view.path,instance:Nav.view,view:Nav.view.name}),Nav.views.push({path:Nav.view.path,instance:Nav.view,view:Nav.view.name}))}}})(window,$);
(function(b,a,g){b.Ui={min_height:0,remove_before_transition:[],clones_to_show:[],before_transition:function(){Ui.set_nav();Ui.remove_fixed_elements();Ui.set_min_size()},after_transition:function(){Ui.fix_element_complete()},resize:function(){Nav.view.$el.css({width:a(b).width()});Ui.min_height=0;Ui.set_min_size()},fix_element:function(c){if(300>a(b).height())return c;var d=c.clone();c.css({position:"absolute",top:a(b).height()-c.height()-a("header").height()+2,left:0,right:0});d.css({visibility:"hidden"}).addClass("fixed").css({position:"fixed",
bottom:0,top:"auto"});Ui.clones_to_show.push({clone:d,elmt:c});Nav.auto_links(d);a(document.body).append(d);Ui.remove_before_transition.push({show:c,clone:d});return d},fix_element_complete:function(){for(var a=0;a<Ui.clones_to_show.length;a++)Ui.clones_to_show[a].clone.css({visibility:"visible"}),Ui.clones_to_show[a].elmt.css({visibility:"hidden"}).css({position:"static"});Ui.clones_to_show=[]},remove_fixed_elements:function(){_.each(Ui.remove_before_transition,function(c){var d=0==a.scrollTop()?
2:a.scrollTop()+4;c.show.css({position:"absolute",top:a(b).height()-c.show.height()-a("header").height()+d,left:0,right:0});c.show.css({visibility:"visible"});c.clone.remove()});Ui.remove_before_transition=[]},set_min_size:function(){a(b).height()>Ui.min_height&&(Ui.min_height=a(b).height())},set_nav:function(){if(Nav.current_transition&&!0!==Nav.current_transition.back)var a=Nav.moves&&Nav.moves.current?Nav.moves.current.instance:Nav.view,b=Nav.moves?Nav.moves.current.path:"/",a=a.next_prev_label==
g?"Back":a.next_prev_label(),f=Nav.view.prev_link==g?Nav.view.$el.find("nav.bar a.back"):Nav.view.prev_link();else if(Nav.moves.current){var l=Nav.get_prev_view_for(Nav.moves.current.path)||Nav.get_last_view_for(Nav.moves.current.path);Nav.moves[l.history_index-2]!==g&&(a=Nav.moves[l.history_index-2].instance,b=Nav.moves[l.history_index-2].path,a=a.next_prev_label==g?"Back":a.next_prev_label(),f=Nav.view.prev_link==g?Nav.view.$el.find("nav.bar a.back"):Nav.view.prev_link())}f&&(b&&a)&&(Ui.truncate_button(f,
a),f.attr("href",b).attr("data-href",b));b=Nav.view.$el.find("a.next");l=b.find("span").html();null!=b&&(0<b.length&&l)&&Ui.truncate_button(b,l)},truncate_button:function(c,d){c.attr("title",d);var f={small:12,medium:20,large:40}[c.attr("data-size")||"small"],g=a('<span style="display:inline; visibility:hidden">m</span>');c.after(g);var p=g.width();g.remove();g=a(b).width()-320;0<g&&(f+=Math.floor(g/p));d&&d.length>f&&(d=d.substr(0,f)+"...");c.find("span").html(d)},form_fixes_after_transition:function(b,
d){d=d||{};a.os.android&&!a.browser.chrome&&(b.find("select").each(function(b){var c=a(this),g=Ui.insert_cloned_input(c);g.addClass(d.select_class||"cloned").on("change",function(){c.val(g.val());c.trigger("change")});(d.after_append||function(){}).apply(g,[g])}),b.find("input[type=radio]").each(function(b){var c=a(this),g=Ui.insert_cloned_input(c);g.attr("name",c.attr("name")).addClass(d.select_class||"cloned").addClass("radio");g.on("change",function(){c[0].checked=g[0].checked;c.trigger("change")});
(d.after_append||function(){}).apply(g,[g])}),b.find("input[type=checkbox]").each(function(b){var c=a(this),g=Ui.insert_cloned_input(c);g.addClass(d.select_class||"cloned").addClass("checkbox").on("change",function(){c[0].checked=g[0].checked;c.trigger("change")});(d.after_append||function(){}).apply(g,[g])}))},form_fixes_before_unload:function(b,d){d=d||{};a.os.android&&!a.browser.chrome&&(b.find("select").css({visibility:"visible"}),b.find("input[type=radio]").css({visibility:"visible"}),b.find("input[type=checkbox]").css({visibility:"visible"}),
a(document.body).find("select."+(d.select_class||"cloned")).remove(),a(document.body).find("input.radio."+(d.select_class||"cloned")).remove(),a(document.body).find("input.checkbox."+(d.select_class||"cloned")).remove())},form_fixes_resize:function(b,d){a.os.android&&!a.browser.chrome&&(b.find("select").each(function(b){b=a(this);var c=a(b.attr("data-clone"));Ui.size_cloned_input(b,c)}),b.find("input[type=radio]").each(function(b){b=a(this);var c=a(b.attr("data-clone"));Ui.size_cloned_input(b,c)}),
b.find("input[type=checkbox]").each(function(b){b=a(this);var c=a(b.attr("data-clone"));Ui.size_cloned_input(b,c)}))},form_fixes_on_resize:function(c,d){d=d||{};a.os.android&&!a.browser.chrome&&b.setTimeout(function(){Ui.form_fixes_resize(c,d)},0)},insert_cloned_input:function(b){var d=b.clone();b.css({visibility:"hidden"});d.val(b.val());Ui.size_cloned_input(b,d);Ui.tag_cloned_input(b,d);a(document.body).append(d);return d},size_cloned_input:function(a,b){var f=a.offset();b.css({position:"absolute",
zIndex:20,top:f.top,left:f.left,width:a.width(),height:a.height()})},tag_cloned_input:function(a,b){var f="cloned_input_"+Math.floor(11*Math.random());a.attr("data-clone",f);b.attr("id",f)},protect_form:function(b){var d=a('<div style="position:absolute; top:0; left:0; right:0; bottom:0; background:transparent; padding:0; margin:0;" />');d.css({height:b.height()});b.append(d);return d}}})(window,$);var BackboneHistoryExt={get_current_path:function(){return"/"+window.location.href.split("#").reverse()[0]}};
Backbone.View.prototype.attach_behavior=function(b){this.behaviors=this.behaviors||{};this.behaviors[b]="function"==typeof Behaviors[b]?new Behaviors[b](this):$.extend({},Behaviors[b]);"function"==typeof this.behaviors[b].initialize&&this.behaviors[b].initialize.apply(this)};Backbone.View.prototype.run=function(b,a){a=a||[];(this[b]||function(){}).apply(this,a);for(var g in this.behaviors)(this.behaviors[g][b]||function(){}).apply(this,a)};
var Animation={fall:function(b,a,g){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({visibility:"hidden"})}});Animation.reset_slider();var c=Animation.get_offset(Nav.elmt),d=parseInt(a.$el.css("z-index"))||0,f=d+1;b.$el.css({"z-index":d});a.$el.css({position:"absolute",zIndex:f,top:-a.$el.height(),right:0,left:c.x,width:$(window).width()}).css({visibility:"visible"});Animation.move_element(a.$el,{y:a.$el.height(),duration:600,transition:"ease-out",
end:function(){b.$el.hide();g()}})}})},sky:function(b,a,g){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({visibility:"hidden"})}});Animation.reset_slider();var c=Animation.get_offset(b.$el),d=parseInt(b.$el.css("z-index"))||0,f=d+1;b.$el.css({"z-index":d});a.$el.css({"z-index":f});a.$el.show().css({visibility:"visible"});Animation.move_element(b.$el,{y:-b.$el.height()+c.y,x:-c.x,duration:1E3,transition:"ease-out",end:function(a){b.$el.hide();Animation.reset_slider();
g()}})}})},fall:function(b,a,g){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({visibility:"hidden"})}});Animation.reset_slider();var c=Animation.get_offset(Nav.elmt),d=parseInt(a.$el.css("z-index"))||0,f=d+1;b.$el.css({"z-index":d});a.$el.css({position:"absolute",zIndex:f,top:-a.$el.height(),right:0,left:c.x,width:$(window).width()}).css({visibility:"visible"});Animation.move_element(a.$el,{y:a.$el.height(),duration:600,transition:"ease-out",end:function(){b.$el.hide();
g()}})}})},from_the_ground:function(b,a,g){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({visibility:"hidden"})}});var c=(parseInt(a.$el.css("z-index"))||0)+1,d=Animation.get_offset(Nav.elmt);a.$el.css({position:"absolute",zIndex:c,top:$(window).height(),right:0,left:d.x,width:$(window).width()}).css({visibility:"visible"});Animation.move_element(a.$el,{y:-$(window).height(),duration:600,transition:"ease-out",end:function(){b.$el.hide();g()}})}})},
to_the_ground:function(b,a,g){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({visibility:"hidden"})}});var c=(parseInt(a.$el.css("z-index"))||0)-1,d=Animation.get_offset(Nav.elmt);a.$el.css({position:"absolute",zIndex:c,top:0,right:0,left:d.x,width:$(window).width()}).css({visibility:"visible"});Animation.move_element(b.$el,{y:$(window).height(),duration:600,transition:"ease-in",end:function(){b.$el.hide();g()}})}})},fadein:function(b,a,g){Nav.load_page(a,
{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({opacity:0})}});Animation.reset_slider();var c=Animation.get_offset(Nav.elmt),d=parseInt(a.$el.css("z-index"))||0,f=d+1;b.$el.css({"z-index":d});a.$el.css({position:"absolute",zIndex:f,top:0,right:0,left:c.x,width:$(window).width()});a.$el.animate({opacity:1},{complete:function(){g()}})}})},fadeout:function(b,a,g){Nav.load_page(a,{complete:function(){Nav.insert(a);Animation.reset_slider();var c=Animation.get_offset(Nav.elmt),
d=parseInt(a.$el.css("z-index"))||1,f=d-1;b.$el.css({"z-index":d});a.$el.css({position:"absolute",zIndex:f,top:0,right:0,left:c.x,width:$(window).width()});b.$el.animate({opacity:0},{complete:function(){g()}})}})},slide:function(b,a,g){Nav.load_page(a,{complete:function(){var c=$(window).width(),d=Animation.get_offset(Nav.elmt);b.$el.css({position:"absolute",top:0,left:d.x,width:c});Nav.insert(a,{before_append_or_display:function(){a.$el.css({position:"absolute",top:0,left:d.x+c,width:c})}});Nav.elmt.css({position:"relative"});
Animation.move_element(Nav.elmt,{x:-(d.x+c),duration:300,end:function(a){Animation.reset_slider();Nav.view.$el.css({left:0});g()}})}})},slide_back:function(b,a,g){Nav.load_page(a,{complete:function(){var c=$(window).width(),d=Animation.get_offset(Nav.elmt);b.$el.css({position:"absolute",top:0,left:d.x,width:c});Nav.insert(a,{before_append_or_display:function(){a.$el.css({position:"absolute",top:0,left:d.x-c,width:c})}});Nav.elmt.css({position:"relative"});Animation.move_element(Nav.elmt,{x:-(d.x-
c),duration:300,end:function(a){Animation.reset_slider();Nav.view.$el.css({left:0});g()}})}})},cover:function(b,a,g){Nav.load_page(a,{complete:function(){var c=$(window).width(),d=Animation.get_offset(Nav.elmt),f=parseInt(a.$el.css("z-index"))||0,l=f+1;b.$el.css({"z-index":f});Nav.insert(a,{before_append_or_display:function(){a.$el.css({position:"absolute",top:0,left:d.x+c,width:c,"z-index":l})}});Animation.move_element(a.$el,{x:-c,duration:350,transition:"ease-in",end:function(a){g()}})}})},uncover:function(b,
a,g){Nav.load_page(a,{complete:function(){var c=$(window).width(),d=Animation.get_offset(Nav.elmt),f=parseInt(a.$el.css("z-index"))||1,l=f-1;b.$el.css({"z-index":f});a.$el.css("z-index")||a.$el.css({"z-index":f});Nav.insert(a,{before_append_or_display:function(){a.$el.css({position:"absolute",top:0,left:d.x,width:c,"z-index":l})}});Animation.move_element(b.$el,{x:c,duration:450,transition:"ease-in",end:function(a){g()}})}})},direct:function(b,a,g){Nav.load_page(a,{complete:function(){b.$el.hide();
Animation.reset_slider();Nav.insert(a);a.$el.show();g()}})},standard:function(b,a,g){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({opacity:0})}});b.$el.animate({opacity:0},{duration:300,complete:function(c){b.$el.hide();Animation.reset_slider();a.$el.animate({opacity:1},{complete:function(){g()}})}})}})},move_element:function(b,a){a=a||{};var g={"-webkit-transition":(a.duration||"400")+"ms "+(a.transition||"ease-in-out"),"-webkit-transform":Animation.get_webkit_translation(a.x,
a.y)};a["background-color"]&&(g["background-color"]=a["background-color"]);window.setTimeout(function(){b.css(g);if("function"==typeof a.end)b.on("webkitTransitionEnd",function(){b.off("webkitTransitionEnd");a.end()})},0)},unfold_element:function(b,a){a=a||{};var g=b.clone();g.css({visibility:"hidden",position:"absolute",height:"auto"}).show();b.after(g);var c=g.height();g.remove();b.css({height:0}).show();var d=(a.duration||"400")+"ms";window.setTimeout(function(){b.css({"-webkit-transition-timing-function":a.transition||
"ease-in-out","-webkit-transition":"height "+d});b.css({height:c});if("function"==typeof a.end)b.on("webkitTransitionEnd",function(){a.end();b.css({"-webkit-transition-timing-function":"","-webkit-transition":""});b.unbind("webkitTransitionEnd")})},0)},fold_element:function(b,a){a=a||{};var g=(a.duration||"400")+"ms";window.setTimeout(function(){b.css({"-webkit-transition-timing-function":a.transition||"ease-in-out","-webkit-transition":"height "+g});b.css({height:0});if("function"==typeof a.end)b.on("webkitTransitionEnd",
function(){a.end();b.hide().css({"-webkit-transition-timing-function":"","-webkit-transition":""});b.unbind("webkitTransitionEnd")})},0)},get_offset:function(b){var a=b.css("-webkit-transform");b={y:0,x:0};a&&0<a.length&&(a=a.split("(").reverse()[0].split(")")[0].split(","),1<a.length&&(b.x=-parseInt(a[0].replace(" ","").replace("px","")),b.y=-parseInt(a[1].replace(" ","").replace("px",""))));return b},get_webkit_translation:function(b,a){b=Math.ceil(b)||0;a=Math.ceil(a)||0;return $.support.webkit3d?
"translate3d("+b+"px, "+a+"px, 0)":"translate("+b+"px, "+a+"px)"},reset_slider:function(){Nav.elmt.css({"-webkit-transition-timing-function":"ease-in","-webkit-transition-duration":"0ms","-webkit-transform":"none"})}};
Views.invitation=Backbone.View.extend({className:"invitation",render:function(){this.$el.html($(Templates.invitation).html());this.$el.find("p.title strong").html(App.meeting.trip.name);this.$el.find("p.location").html(App.meeting.trip.location);var b=App.date(App.meeting.trip.from),a=App.date(App.meeting.trip.to);this.$el.find("p.time").append("<span>"+b+"</span>");b!=a&&this.$el.find("p.time").append("<br/> to <span>"+App.date(App.meeting.trip.to)+"</span>");return this},before_transition:function(){this.$el.find("p.start a").link({run:function(b,
a){b.preventDefault();Nav.go(a,"slide")}})}});
Views.schedule=Backbone.View.extend({className:"schedule",render:function(){this.$el.html($(Templates.schedule).html());for(var b=App.get_dates(new Date(App.parse_date(App.meeting.trip.from)),new Date(App.parse_date(App.meeting.trip.to))),a=0;a<b.length;a++){var g=this.build_day(b[a]);this.$el.find("div.days").append(g)}return this},before_transition:function(){var b=this;this.refresh_slots();this.$el.find("div.days a").link({run:function(a){a.preventDefault();this.toggleClass("on");b.toggle(this.attr("data-day"),
this.attr("data-slot"))}});this.$el.find("p.start a").link({run:function(a,g){a.preventDefault();b.validate(g)}})},validate:function(b){0<_.keys(App.reply.timeslots).length?Nav.go(b,"slide"):window.confirm("Don't you really haven't time for your friend? Come on...")&&App.send_reply(function(){Nav.go("/decline","slide")})},refresh_slots:function(){this.$el.find("div.days a").removeClass("on");"object"==typeof App.reply.timeslots&&this.$el.find("div.days a").each(function(){var b=$(this);App.reply.timeslots[b.attr("data-day")]&&
-1<_.indexOf(App.reply.timeslots[b.attr("data-day")],parseInt(b.attr("data-slot")))&&b.addClass("on")})},build_day:function(b){var a=$('<div class="day" />');a.append("<h3>"+App.date(b)+"</h3>");a.append('<ul class="availabilities" />');for(var g=0;24>g;g+=2)a.find("ul.availabilities").append('<li><a href="#" data-slot="'+g+'" data-day="'+b+'">'+g+"-"+(g+2)+"h</a></li>");return a},toggle:function(b,a){b=new Date(b);a=parseInt(a);b.getFullYear();App.date_number(b.getMonth());App.date_number(b.getDate());
App.reply.timeslots=App.reply.timeslots||{};App.reply.timeslots[b]=App.reply.timeslots[b]||[];-1==_.indexOf(App.reply.timeslots[b],a)?App.reply.timeslots[b].push(a):(App.reply.timeslots[b]=_(App.reply.timeslots[b]).without(a),0==App.reply.timeslots[b].length&&delete App.reply.timeslots[b]);App.save_reply()}});
Views.place=Backbone.View.extend({className:"schedule",initialize:function(){this.attach_behavior("place_selector")},render:function(){this.$el.html($(Templates.place).html());return this},before_transition:function(){var b=this;this.$el.find("p.start a").link({run:function(a,g){a.preventDefault();b.complete_meeting()}});this.$el.find("div.current_location a").link({run:function(a){a.preventDefault();b.current_location()}})},after_transition:function(){var b=this.$el.find(".foursquare input"),a=this;
b.on("keypress",function(g){13==g.keyCode&&a.run("refresh_places",[b.val()])})},unselect_all:function(){this.$el.find("div.current_location").removeClass("on").find("div.map").hide();this.$el.find("ul.places li").removeClass("selected")},current_location:function(){var b=this;App.get_position(function(a){a&&(a=new google.maps.LatLng(a.latitude,a.longitude),(new google.maps.Geocoder).geocode({latLng:a},function(g,c){c==google.maps.GeocoderStatus.OK&&0<g.length&&b.use_current_location(g[1],a)}))})},
use_current_location:function(b,a){this.unselect_all();this.$el.find("div.current_location a").text(b.formatted_address);var g=this.$el.find("div.map");if(0==g.length){g=$('<div class="map" />');this.$el.find("div.current_location").append(g);var c=new google.maps.Map(g.get(0),{zoom:14,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP}),d=new google.maps.Marker({position:a,map:c});google.maps.event.addListener(c,"center_changed",function(){d.setPosition(c.getCenter())})}else g.show();this.$el.find("div.current_location").addClass("on");
Nav.run("resize")},use_place:function(b,a){this.unselect_all();a.addClass("selected")},complete_meeting:function(){App.loader();window.setTimeout(function(){Nav.go("/complete","slide",{after_transition:function(){App.loader_elmt&&(App.loader_elmt.remove(),App.loader_elmt=null)}})},2E3)}});Views.complete=Backbone.View.extend({className:"complete",render:function(){this.$el.html($(Templates.complete).html());return this},before_transition:function(){}});
Views.decline=Backbone.View.extend({className:"complete",render:function(){this.$el.html($(Templates.decline).html());this.$el.find("strong").html(App.meeting.trip.name);return this}});
Behaviors.place_selector={initialize:function(){this.places={}},refresh_places:function(b){var a=this,g=$('<span class="bjr_loader"><span></span></span>');g.css({position:"absolute",top:160,left:"50%","margin-left":-14});this.$el.find("ul.places").empty().before(g);App.get_position(function(c){c={client_id:"ZNUYQTMM3XBUIERAHHVVDYAO3FR4C22C05RMYCHC3DHBMPK3",client_secret:"FI5GYAZ0S2XZOJLYZISOW5QPPW3RAMZHLKWEQMDQHY1BQNC0",ll:c.latitude+","+c.longitude,v:"20130823"};b&&0<b.length&&(c.query=b);a.requests.push($.ajax({url:"https://api.foursquare.com/v2/venues/search",
data:c,dataType:"json",success:function(b){b.response.venues&&0<b.response.venues.length&&a.run("display_places",[b.response.venues])}}))})},close_selector:function(b){var a=this.$el.find("form.status");a.css({position:"absolute",left:0,top:0,right:0}).show();b.css({position:"absolute"});Animation.move_element(b,{y:$(window).height(),end:function(){b.remove();a.css({position:"static"});Nav.run("resize");var g=$("#above p.foursquare_powered");g.animate({opacity:0},{complete:function(){g.remove()}})}})},
display_places:function(b){for(var a=this.$el.find("ul.places"),g=this,c=0;c<b.length;c++){var d=$('<li><a href="#" data-id="'+b[c].id+'"></a></li>');d.find("a").append("<strong>"+b[c].name+"</strong>").append("<span>"+this.behaviors.place_selector.foursquare_location(b[c])+"</span>");a.append(d);d.find("a").link({run:function(a){a.preventDefault();g.run("use_place",[b[c],d])}});this.places[b[c].id]=b[c]}Nav.run("resize")},foursquare_location:function(b){var a="";b.location.address&&(a+=b.location.address+
", ");b.location.postalCode&&(a+=b.location.postalCode+" ");b.location.city&&(a+=b.location.city);return a}};
var Templates={complete:'<div class="complete"><div class="message"><p><strong>Mourad De Cleck </strong>thanks you!</p><p>You\'re gonna receive news from him soon.</p></div></div>',decline:'<div class="complete"><div class="message"><p><strong>{name}</strong> will be missing you.</p><p>Too bad.</p></div></div>',error:'<div><div class="complete"><div class="message"><p><strong>There was a problem</strong></p><p>This meeting doesn\'t exist or a problem occured.</p></div></div></div>',invitation:'<div class="invitation"><p class="title">Your friend <strong>{name}</strong> is visiting town and wants to meet you!</p><div class="info"><p class="location">{location}</p><p class="time"></p><p class="start"><a href="/schedule">Let\'s meet him</a></p></div></div>',
place:'<div class="schedule"><div class="title"><p>Suggest a nice place to meet</p><nav class="steps"><span class="done"></span><span class="done"></span><span class="on"></span></nav></div><div class="place"><div class="current_location"><p><a href="#">At my current location</a></p></div><div class="foursquare"><p class="search"><input name="q" placeholder="In a public location" type="search"/></p><ul class="places"></ul><p class="powered">Powered by Foursquare</p></div></div><div class="info"><p class="start"><a href="/place">Finish</a></p></div></div>',
place_selector:'<div class="place_selector"><h2>Select a place to meet</h2><form action="#" class="search" method="post"><p class="search"><input class="font-bold" name="q" placeholder="Search for a place" type="search"/></p><p class="submit"><input type="submit" value="Ok"/></p></form><ul class="places"></ul></div>',schedule:'<div class="schedule"><div class="title"><p>When would you like to meet?</p><nav class="steps"><span class="done"></span><span class="on"></span><span></span></nav></div><div class="info"><div class="days"></div><p class="start"><a href="/place">Continue</a></p></div></div>'};
