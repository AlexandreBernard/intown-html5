var Zepto=function(){function a(a){return null==a?String(a):K[R.call(a)]||"object"}function b(b){return"function"==a(b)}function c(a){return null!=a&&a==a.window}function d(a){return null!=a&&a.nodeType==a.DOCUMENT_NODE}function e(b){return"object"==a(b)}function g(a){return e(a)&&!c(a)&&Object.getPrototypeOf(a)==Object.prototype}function h(a){return a instanceof Array}function l(a){return"number"==typeof a.length}function r(a){return t.call(a,function(a){return null!=a})}function u(a){return a.replace(/::/g,
"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function B(a){return a in G?G[a]:G[a]=RegExp("(^|\\s)"+a+"(\\s|$)")}function v(a){return"children"in a?D.call(a.children):f.map(a.childNodes,function(a){if(1==a.nodeType)return a})}function w(a,b,d){for(k in b)d&&(g(b[k])||h(b[k]))?(g(b[k])&&!g(a[k])&&(a[k]={}),h(b[k])&&!h(a[k])&&(a[k]=[]),w(a[k],b[k],d)):b[k]!==n&&(a[k]=b[k])}function y(a,b){return null==b?f(a):f(a).filter(b)}function q(a,
d,c,e){return b(d)?d.call(a,c,e):d}function p(a,b){var d=a.className,c=d&&d.baseVal!==n;if(b===n)return c?d.baseVal:d;c?d.baseVal=b:a.className=b}function C(a){var b;try{return a?"true"==a||("false"==a?!1:"null"==a?null:!/^0/.test(a)&&!isNaN(b=Number(a))?b:/^[\[\{]/.test(a)?f.parseJSON(a):a):a}catch(d){return a}}function E(a,b){b(a);for(var d in a.childNodes)E(a.childNodes[d],b)}var n,k,f,A,x=[],D=x.slice,t=x.filter,m=window.document,F={},G={},H={"column-count":1,columns:1,"font-weight":1,"line-height":1,
opacity:1,"z-index":1,zoom:1},L=/^\s*<(\w+|!)[^>]*>/,S=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,s=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,N=/^(?:body|html)$/i,T=/([A-Z])/g,U="val css html text data width height offset".split(" "),M=m.createElement("table"),O=m.createElement("tr"),P={tr:m.createElement("tbody"),tbody:M,thead:M,tfoot:M,td:O,th:O,"*":m.createElement("div")},V=/complete|loaded|interactive/,W=/^[\w-]*$/,K={},R=K.toString,z={},I,J,Q=m.createElement("div"),X={tabindex:"tabIndex",
readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"};z.matches=function(a,b){if(!b||!a||1!==a.nodeType)return!1;var d=a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.matchesSelector;if(d)return d.call(a,b);var c;c=a.parentNode;(d=!c)&&(c=Q).appendChild(a);c=~z.qsa(c,b).indexOf(a);d&&Q.removeChild(a);
return c};I=function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})};J=function(a){return t.call(a,function(b,d){return a.indexOf(b)==d})};z.fragment=function(a,b,d){var c,e,t;S.test(a)&&(c=f(m.createElement(RegExp.$1)));c||(a.replace&&(a=a.replace(s,"<$1></$2>")),b===n&&(b=L.test(a)&&RegExp.$1),b in P||(b="*"),t=P[b],t.innerHTML=""+a,c=f.each(D.call(t.childNodes),function(){t.removeChild(this)}));g(d)&&(e=f(c),f.each(d,function(a,b){if(-1<U.indexOf(a))e[a](b);else e.attr(a,
b)}));return c};z.Z=function(a,b){a=a||[];a.__proto__=f.fn;a.selector=b||"";return a};z.isZ=function(a){return a instanceof z.Z};z.init=function(a,d){var c;if(a)if("string"==typeof a)if(a=a.trim(),"<"==a[0]&&L.test(a))c=z.fragment(a,RegExp.$1,d),a=null;else{if(d!==n)return f(d).find(a);c=z.qsa(m,a)}else{if(b(a))return f(m).ready(a);if(z.isZ(a))return a;if(h(a))c=r(a);else if(e(a))c=[a],a=null;else if(L.test(a))c=z.fragment(a.trim(),RegExp.$1,d),a=null;else{if(d!==n)return f(d).find(a);c=z.qsa(m,a)}}else return z.Z();
return z.Z(c,a)};f=function(a,b){return z.init(a,b)};f.extend=function(a){var b,d=D.call(arguments,1);"boolean"==typeof a&&(b=a,a=d.shift());d.forEach(function(d){w(a,d,b)});return a};z.qsa=function(a,b){var c,e="#"==b[0],t=!e&&"."==b[0],m=e||t?b.slice(1):b,g=W.test(m);return d(a)&&g&&e?(c=a.getElementById(m))?[c]:[]:1!==a.nodeType&&9!==a.nodeType?[]:D.call(g&&!e?t?a.getElementsByClassName(m):a.getElementsByTagName(b):a.querySelectorAll(b))};f.contains=function(a,b){return a!==b&&a.contains(b)};f.type=
a;f.isFunction=b;f.isWindow=c;f.isArray=h;f.isPlainObject=g;f.isEmptyObject=function(a){for(var b in a)return!1;return!0};f.inArray=function(a,b,d){return x.indexOf.call(b,a,d)};f.camelCase=I;f.trim=function(a){return null==a?"":String.prototype.trim.call(a)};f.uuid=0;f.support={};f.expr={};f.map=function(a,b){var d,c=[],e;if(l(a))for(e=0;e<a.length;e++)d=b(a[e],e),null!=d&&c.push(d);else for(e in a)d=b(a[e],e),null!=d&&c.push(d);return 0<c.length?f.fn.concat.apply([],c):c};f.each=function(a,b){var d;
if(l(a))for(d=0;d<a.length&&!1!==b.call(a[d],d,a[d]);d++);else for(d in a)if(!1===b.call(a[d],d,a[d]))break;return a};f.grep=function(a,b){return t.call(a,b)};window.JSON&&(f.parseJSON=JSON.parse);f.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){K["[object "+b+"]"]=b.toLowerCase()});f.fn={forEach:x.forEach,reduce:x.reduce,push:x.push,sort:x.sort,indexOf:x.indexOf,concat:x.concat,map:function(a){return f(f.map(this,function(b,d){return a.call(b,d,b)}))},
slice:function(){return f(D.apply(this,arguments))},ready:function(a){V.test(m.readyState)&&m.body?a(f):m.addEventListener("DOMContentLoaded",function(){a(f)},!1);return this},get:function(a){return a===n?D.call(this):this[0<=a?a:a+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(a){x.every.call(this,function(b,d){return!1!==a.call(b,d,b)});
return this},filter:function(a){return b(a)?this.not(this.not(a)):f(t.call(this,function(b){return z.matches(b,a)}))},add:function(a,b){return f(J(this.concat(f(a,b))))},is:function(a){return 0<this.length&&z.matches(this[0],a)},not:function(a){var d=[];if(b(a)&&a.call!==n)this.each(function(b){a.call(this,b)||d.push(this)});else{var c="string"==typeof a?this.filter(a):l(a)&&b(a.item)?D.call(a):f(a);this.forEach(function(a){0>c.indexOf(a)&&d.push(a)})}return f(d)},has:function(a){return this.filter(function(){return e(a)?
f.contains(this,a):f(this).find(a).size()})},eq:function(a){return-1===a?this.slice(a):this.slice(a,+a+1)},first:function(){var a=this[0];return a&&!e(a)?a:f(a)},last:function(){var a=this[this.length-1];return a&&!e(a)?a:f(a)},find:function(a){var b=this;return"object"==typeof a?f(a).filter(function(){var a=this;return x.some.call(b,function(b){return f.contains(b,a)})}):1==this.length?f(z.qsa(this[0],a)):this.map(function(){return z.qsa(this,a)})},closest:function(a,b){var c=this[0],e=!1;for("object"==
typeof a&&(e=f(a));c&&!(e?0<=e.indexOf(c):z.matches(c,a));)c=c!==b&&!d(c)&&c.parentNode;return f(c)},parents:function(a){for(var b=[],c=this;0<c.length;)c=f.map(c,function(a){if((a=a.parentNode)&&!d(a)&&0>b.indexOf(a))return b.push(a),a});return y(b,a)},parent:function(a){return y(J(this.pluck("parentNode")),a)},children:function(a){return y(this.map(function(){return v(this)}),a)},contents:function(){return this.map(function(){return D.call(this.childNodes)})},siblings:function(a){return y(this.map(function(a,
b){return t.call(v(b.parentNode),function(a){return a!==b})}),a)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(a){return f.map(this,function(b){return b[a]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display="");if("none"==getComputedStyle(this,"").getPropertyValue("display")){var a=this.style,b=this.nodeName,d,c;F[b]||(d=m.createElement(b),m.body.appendChild(d),c=getComputedStyle(d,"").getPropertyValue("display"),d.parentNode.removeChild(d),
"none"==c&&(c="block"),F[b]=c);a.display=F[b]}})},replaceWith:function(a){return this.before(a).remove()},wrap:function(a){var d=b(a);if(this[0]&&!d)var c=f(a).get(0),e=c.parentNode||1<this.length;return this.each(function(b){f(this).wrapAll(d?a.call(this,b):e?c.cloneNode(!0):c)})},wrapAll:function(a){if(this[0]){f(this[0]).before(a=f(a));for(var b;(b=a.children()).length;)a=b.first();f(a).append(this)}return this},wrapInner:function(a){var d=b(a);return this.each(function(b){var c=f(this),e=c.contents();
b=d?a.call(this,b):a;e.length?e.wrapAll(b):c.append(b)})},unwrap:function(){this.parent().each(function(){f(this).replaceWith(f(this).children())});return this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(a){return this.each(function(){var b=f(this);(a===n?"none"==b.css("display"):a)?b.show():b.hide()})},prev:function(a){return f(this.pluck("previousElementSibling")).filter(a||"*")},next:function(a){return f(this.pluck("nextElementSibling")).filter(a||
"*")},html:function(a){return 0===arguments.length?0<this.length?this[0].innerHTML:null:this.each(function(b){var d=this.innerHTML;f(this).empty().append(q(this,a,b,d))})},text:function(a){return 0===arguments.length?0<this.length?this[0].textContent:null:this.each(function(){this.textContent=a===n?"":""+a})},attr:function(a,b){var d;return"string"==typeof a&&b===n?0==this.length||1!==this[0].nodeType?n:"value"==a&&"INPUT"==this[0].nodeName?this.val():!(d=this[0].getAttribute(a))&&a in this[0]?this[0][a]:
d:this.each(function(d){if(1===this.nodeType)if(e(a))for(k in a){d=k;var c=a[k];null==c?this.removeAttribute(d):this.setAttribute(d,c)}else d=q(this,b,d,this.getAttribute(a)),null==d?this.removeAttribute(a):this.setAttribute(a,d)})},removeAttr:function(a){return this.each(function(){1===this.nodeType&&this.removeAttribute(a)})},prop:function(a,b){a=X[a]||a;return b===n?this[0]&&this[0][a]:this.each(function(d){this[a]=q(this,b,d,this[a])})},data:function(a,b){var d=this.attr("data-"+a.replace(T,"-$1").toLowerCase(),
b);return null!==d?C(d):n},val:function(a){return 0===arguments.length?this[0]&&(this[0].multiple?f(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(b){this.value=q(this,a,b,this.value)})},offset:function(a){if(a)return this.each(function(b){var d=f(this);b=q(this,a,b,d.offset());var c=d.offsetParent().offset();b={top:b.top-c.top,left:b.left-c.left};"static"==d.css("position")&&(b.position="relative");d.css(b)});if(0==this.length)return null;
var b=this[0].getBoundingClientRect();return{left:b.left+window.pageXOffset,top:b.top+window.pageYOffset,width:Math.round(b.width),height:Math.round(b.height)}},css:function(b,d){if(2>arguments.length){var c=this[0],e=getComputedStyle(c,"");if(!c)return;if("string"==typeof b)return c.style[I(b)]||e.getPropertyValue(b);if(h(b)){var t={};f.each(h(b)?b:[b],function(a,b){t[b]=c.style[I(b)]||e.getPropertyValue(b)});return t}}var m="";if("string"==a(b))!d&&0!==d?this.each(function(){this.style.removeProperty(u(b))}):
m=u(b)+":"+("number"==typeof d&&!H[u(b)]?d+"px":d);else for(k in b)!b[k]&&0!==b[k]?this.each(function(){this.style.removeProperty(u(k))}):m+=u(k)+":"+("number"==typeof b[k]&&!H[u(k)]?b[k]+"px":b[k])+";";return this.each(function(){this.style.cssText+=";"+m})},index:function(a){return a?this.indexOf(f(a)[0]):this.parent().children().indexOf(this[0])},hasClass:function(a){return!a?!1:x.some.call(this,function(a){return this.test(p(a))},B(a))},addClass:function(a){return!a?this:this.each(function(b){A=
[];var d=p(this);q(this,a,b,d).split(/\s+/g).forEach(function(a){f(this).hasClass(a)||A.push(a)},this);A.length&&p(this,d+(d?" ":"")+A.join(" "))})},removeClass:function(a){return this.each(function(b){if(a===n)return p(this,"");A=p(this);q(this,a,b,A).split(/\s+/g).forEach(function(a){A=A.replace(B(a)," ")});p(this,A.trim())})},toggleClass:function(a,b){return!a?this:this.each(function(d){var c=f(this);q(this,a,d,p(this)).split(/\s+/g).forEach(function(a){(b===n?!c.hasClass(a):b)?c.addClass(a):c.removeClass(a)})})},
scrollTop:function(a){if(this.length){var b="scrollTop"in this[0];return a===n?b?this[0].scrollTop:this[0].pageYOffset:this.each(b?function(){this.scrollTop=a}:function(){this.scrollTo(this.scrollX,a)})}},scrollLeft:function(a){if(this.length){var b="scrollLeft"in this[0];return a===n?b?this[0].scrollLeft:this[0].pageXOffset:this.each(b?function(){this.scrollLeft=a}:function(){this.scrollTo(a,this.scrollY)})}},position:function(){if(this.length){var a=this[0],b=this.offsetParent(),d=this.offset(),
c=N.test(b[0].nodeName)?{top:0,left:0}:b.offset();d.top-=parseFloat(f(a).css("margin-top"))||0;d.left-=parseFloat(f(a).css("margin-left"))||0;c.top+=parseFloat(f(b[0]).css("border-top-width"))||0;c.left+=parseFloat(f(b[0]).css("border-left-width"))||0;return{top:d.top-c.top,left:d.left-c.left}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||m.body;a&&!N.test(a.nodeName)&&"static"==f(a).css("position");)a=a.offsetParent;return a})}};f.fn.detach=f.fn.remove;["width",
"height"].forEach(function(a){var b=a.replace(/./,function(a){return a[0].toUpperCase()});f.fn[a]=function(e){var t,m=this[0];return e===n?c(m)?m["inner"+b]:d(m)?m.documentElement["scroll"+b]:(t=this.offset())&&t[a]:this.each(function(b){m=f(this);m.css(a,q(this,e,b,m[a]()))})}});["after","prepend","before","append"].forEach(function(b,d){var c=d%2;f.fn[b]=function(){var b,e=f.map(arguments,function(d){b=a(d);return"object"==b||"array"==b||null==d?d:z.fragment(d)}),m,t=1<this.length;return 1>e.length?
this:this.each(function(a,b){m=c?b:b.parentNode;b=0==d?b.nextSibling:1==d?b.firstChild:2==d?b:null;e.forEach(function(a){if(t)a=a.cloneNode(!0);else if(!m)return f(a).remove();E(m.insertBefore(a,b),function(a){null!=a.nodeName&&("SCRIPT"===a.nodeName.toUpperCase()&&(!a.type||"text/javascript"===a.type)&&!a.src)&&window.eval.call(window,a.innerHTML)})})})};f.fn[c?b+"To":"insert"+(d?"Before":"After")]=function(a){f(a)[b](this);return this}});z.Z.prototype=f.fn;z.uniq=J;z.deserializeValue=C;f.zepto=
z;return f}();window.Zepto=Zepto;void 0===window.$&&(window.$=Zepto);
(function(a){function b(a){return a._zid||(a._zid=r++)}function c(a,c,e,m){c=d(c);if(c.ns)var g=RegExp("(?:^| )"+c.ns.replace(" "," .* ?")+"(?: |$)");return(y[b(a)]||[]).filter(function(a){return a&&(!c.e||a.e==c.e)&&(!c.ns||g.test(a.ns))&&(!e||b(a.fn)===b(e))&&(!m||a.sel==m)})}function d(a){a=(""+a).split(".");return{e:a[0],ns:a.slice(1).sort().join(" ")}}function e(c,e,t,m,g,f,l){var q=b(c),k=y[q]||(y[q]=[]);e.split(/\s/).forEach(function(b){if("ready"==b)return a(document).ready(t);var e=d(b);
e.fn=t;e.sel=g;e.e in E&&(t=function(b){var d=b.relatedTarget;if(!d||d!==this&&!a.contains(this,d))return e.fn.apply(this,arguments)});var D=(e.del=f)||t;e.proxy=function(a){a=h(a);if(!a.isImmediatePropagationStopped()){a.data=m;var b=D.apply(c,a._args==u?[a]:[a].concat(a._args));!1===b&&(a.preventDefault(),a.stopPropagation());return b}};e.i=k.length;k.push(e);"addEventListener"in c&&c.addEventListener(E[e.e]||p&&C[e.e]||e.e,e.proxy,e.del&&!p&&e.e in C||!!l)})}function g(a,d,e,m,g){var f=b(a);(d||
"").split(/\s/).forEach(function(b){c(a,b,e,m).forEach(function(b){delete y[f][b.i];"removeEventListener"in a&&a.removeEventListener(E[b.e]||p&&C[b.e]||b.e,b.proxy,b.del&&!p&&b.e in C||!!g)})})}function h(b,d){if(d||!b.isDefaultPrevented)if(d||(d=b),a.each(A,function(a,c){var e=d[a];b[a]=function(){this[c]=n;return e&&e.apply(d,arguments)};b[c]=k}),d.defaultPrevented!==u?d.defaultPrevented:"returnValue"in d?!1===d.returnValue:d.getPreventDefault&&d.getPreventDefault())b.isDefaultPrevented=n;return b}
function l(a){var b,d={originalEvent:a};for(b in a)!f.test(b)&&a[b]!==u&&(d[b]=a[b]);return h(d,a)}var r=1,u,B=Array.prototype.slice,v=a.isFunction,w=function(a){return"string"==typeof a},y={},q={},p="onfocusin"in window,C={focus:"focusin",blur:"focusout"},E={mouseenter:"mouseover",mouseleave:"mouseout"};q.click=q.mousedown=q.mouseup=q.mousemove="MouseEvents";a.event={add:e,remove:g};a.proxy=function(d,c){if(v(d)){var e=function(){return d.apply(c,arguments)};e._zid=b(d);return e}if(w(c))return a.proxy(d[c],
d);throw new TypeError("expected function");};a.fn.bind=function(a,b,d){return this.on(a,b,d)};a.fn.unbind=function(a,b){return this.off(a,b)};a.fn.one=function(a,b,d,c){return this.on(a,b,d,c,1)};var n=function(){return!0},k=function(){return!1},f=/^([A-Z]|returnValue$|layer[XY]$)/,A={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};a.fn.delegate=function(a,b,d){return this.on(b,a,d)};a.fn.undelegate=function(a,b,
d){return this.off(b,a,d)};a.fn.live=function(b,d){a(document.body).delegate(this.selector,b,d);return this};a.fn.die=function(b,d){a(document.body).undelegate(this.selector,b,d);return this};a.fn.on=function(b,d,c,m,f){var h,q,p=this;if(b&&!w(b))return a.each(b,function(a,b){p.on(a,d,c,b,f)}),p;!w(d)&&(!v(m)&&!1!==m)&&(m=c,c=d,d=u);if(v(c)||!1===c)m=c,c=u;!1===m&&(m=k);return p.each(function(p,k){f&&(h=function(a){g(k,a.type,m);return m.apply(this,arguments)});d&&(q=function(b){var c,e=a(b.target).closest(d,
k).get(0);if(e&&e!==k)return c=a.extend(l(b),{currentTarget:e,liveFired:k}),(h||m).apply(e,[c].concat(B.call(arguments,1)))});e(k,b,m,c,d,q||h)})};a.fn.off=function(b,d,c){var e=this;if(b&&!w(b))return a.each(b,function(a,b){e.off(a,d,b)}),e;!w(d)&&(!v(c)&&!1!==c)&&(c=d,d=u);!1===c&&(c=k);return e.each(function(){g(this,b,c,d)})};a.fn.trigger=function(b,d){b=w(b)||a.isPlainObject(b)?a.Event(b):h(b);b._args=d;return this.each(function(){"dispatchEvent"in this?this.dispatchEvent(b):a(this).triggerHandler(b,
d)})};a.fn.triggerHandler=function(b,d){var e,m;this.each(function(g,f){e=l(w(b)?a.Event(b):b);e._args=d;e.target=f;a.each(c(f,b.type||b),function(a,b){m=b.proxy(e);if(e.isImmediatePropagationStopped())return!1})});return m};"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(b){a.fn[b]=function(a){return a?this.bind(b,a):this.trigger(b)}});["focus","blur"].forEach(function(b){a.fn[b]=
function(a){a?this.bind(b,a):this.each(function(){try{this[b]()}catch(a){}});return this}});a.Event=function(a,b){w(a)||(b=a,a=b.type);var d=document.createEvent(q[a]||"Events"),c=!0;if(b)for(var e in b)"bubbles"==e?c=!!b[e]:d[e]=b[e];d.initEvent(a,c,!0);return h(d)}})(Zepto);
(function(a){function b(b,d,c,e){if(b.global)return b=d||q,c=a.Event(c),a(b).trigger(c,e),!c.isDefaultPrevented()}function c(d){d.global&&0===a.active++&&b(d,null,"ajaxStart")}function d(a,d){var c=d.context;if(!1===d.beforeSend.call(c,a,d)||!1===b(d,c,"ajaxBeforeSend",[a,d]))return!1;b(d,c,"ajaxSend",[a,d])}function e(a,d,c,e){var g=c.context;c.success.call(g,a,"success",d);e&&e.resolveWith(g,[a,"success",d]);b(c,g,"ajaxSuccess",[d,c,a]);h("success",d,c)}function g(a,d,c,e,g){var f=e.context;e.error.call(f,
c,d,a);g&&g.rejectWith(f,[c,d,a]);b(e,f,"ajaxError",[c,e,a||d]);h(d,c,e)}function h(d,c,e){var g=e.context;e.complete.call(g,c,d);b(e,g,"ajaxComplete",[c,e]);e.global&&!--a.active&&b(e,null,"ajaxStop")}function l(){}function r(a){a&&(a=a.split(";",2)[0]);return a&&(a==A?"html":a==f?"json":n.test(a)?"script":k.test(a)&&"xml")||"text"}function u(a,b){return""==b?a:(a+"&"+b).replace(/[&?]{1,2}/,"?")}function B(b){b.processData&&(b.data&&"string"!=a.type(b.data))&&(b.data=a.param(b.data,b.traditional));
if(b.data&&(!b.type||"GET"==b.type.toUpperCase()))b.url=u(b.url,b.data),b.data=void 0}function v(b,d,c,e){var g=!a.isFunction(d);return{url:b,data:g?d:void 0,success:!g?d:a.isFunction(c)?c:void 0,dataType:g?e||c:c}}function w(b,d,c,e){var g,f=a.isArray(d),h=a.isPlainObject(d);a.each(d,function(d,m){g=a.type(m);e&&(d=c?e:e+"["+(h||"object"==g||"array"==g?d:"")+"]");!e&&f?b.add(m.name,m.value):"array"==g||!c&&"object"==g?w(b,m,c,d):b.add(d,m)})}var y=0,q=window.document,p,C,E=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
n=/^(?:text|application)\/javascript/i,k=/^(?:text|application)\/xml/i,f="application/json",A="text/html",x=/^\s*$/;a.active=0;a.ajaxJSONP=function(b,c){if(!("type"in b))return a.ajax(b);var f=b.jsonpCallback,h=(a.isFunction(f)?f():f)||"jsonp"+ ++y,l=q.createElement("script"),p=window[h],k,E=function(b){a(l).triggerHandler("error",b||"abort")},n={abort:E},C;c&&c.promise(n);a(l).on("load error",function(d,f){clearTimeout(C);a(l).off().remove();"error"==d.type||!k?g(null,f||"error",n,b,c):e(k[0],n,
b,c);window[h]=p;k&&a.isFunction(p)&&p(k[0]);p=k=void 0});if(!1===d(n,b))return E("abort"),n;window[h]=function(){k=arguments};l.src=b.url.replace(/=\?/,"="+h);q.head.appendChild(l);0<b.timeout&&(C=setTimeout(function(){E("timeout")},b.timeout));return n};a.ajaxSettings={type:"GET",beforeSend:l,success:l,error:l,complete:l,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:f,xml:"application/xml, text/xml",
html:A,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0};a.ajax=function(b){var f=a.extend({},b||{}),h=a.Deferred&&a.Deferred();for(p in a.ajaxSettings)void 0===f[p]&&(f[p]=a.ajaxSettings[p]);c(f);f.crossDomain||(f.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(f.url)&&RegExp.$2!=window.location.host);f.url||(f.url=window.location.toString());B(f);!1===f.cache&&(f.url=u(f.url,"_="+Date.now()));var k=f.dataType;b=/=\?/.test(f.url);if("jsonp"==k||b)return b||(f.url=u(f.url,f.jsonp?f.jsonp+
"=?":!1===f.jsonp?"":"callback=?")),a.ajaxJSONP(f,h);b=f.accepts[k];var q={},n=function(a,b){q[a.toLowerCase()]=[a,b]},E=/^([\w-]+:)\/\//.test(f.url)?RegExp.$1:window.location.protocol,s=f.xhr(),v=s.setRequestHeader,w;h&&h.promise(s);f.crossDomain||n("X-Requested-With","XMLHttpRequest");n("Accept",b||"*/*");if(b=f.mimeType||b)-1<b.indexOf(",")&&(b=b.split(",",2)[0]),s.overrideMimeType&&s.overrideMimeType(b);if(f.contentType||!1!==f.contentType&&f.data&&"GET"!=f.type.toUpperCase())n("Content-Type",
f.contentType||"application/x-www-form-urlencoded");if(f.headers)for(C in f.headers)n(C,f.headers[C]);s.setRequestHeader=n;s.onreadystatechange=function(){if(4==s.readyState){s.onreadystatechange=l;clearTimeout(w);var b,d=!1;if(200<=s.status&&300>s.status||304==s.status||0==s.status&&"file:"==E){k=k||r(f.mimeType||s.getResponseHeader("content-type"));b=s.responseText;try{"script"==k?(0,eval)(b):"xml"==k?b=s.responseXML:"json"==k&&(b=x.test(b)?null:a.parseJSON(b))}catch(c){d=c}d?g(d,"parsererror",
s,f,h):e(b,s,f,h)}else g(s.statusText||null,s.status?"error":"abort",s,f,h)}};if(!1===d(s,f))return s.abort(),g(null,"abort",s,f,h),s;if(f.xhrFields)for(C in f.xhrFields)s[C]=f.xhrFields[C];s.open(f.type,f.url,"async"in f?f.async:!0,f.username,f.password);for(C in q)v.apply(s,q[C]);0<f.timeout&&(w=setTimeout(function(){s.onreadystatechange=l;s.abort();g(null,"timeout",s,f,h)},f.timeout));s.send(f.data?f.data:null);return s};a.get=function(b,d,c,e){return a.ajax(v.apply(null,arguments))};a.post=function(b,
d,c,e){var f=v.apply(null,arguments);f.type="POST";return a.ajax(f)};a.getJSON=function(b,d,c){var e=v.apply(null,arguments);e.dataType="json";return a.ajax(e)};a.fn.load=function(b,d,c){if(!this.length)return this;var e=this,f=b.split(/\s/),g;b=v(b,d,c);var h=b.success;1<f.length&&(b.url=f[0],g=f[1]);b.success=function(b){e.html(g?a("<div>").html(b.replace(E,"")).find(g):b);h&&h.apply(e,arguments)};a.ajax(b);return this};var D=encodeURIComponent;a.param=function(a,b){var d=[];d.add=function(a,b){this.push(D(a)+
"="+D(b))};w(d,a,b);return d.join("&").replace(/%20/g,"+")}})(Zepto);
(function(a){a.fn.serializeArray=function(){var b=[],c;a([].slice.call(this.get(0).elements)).each(function(){c=a(this);var d=c.attr("type");"fieldset"!=this.nodeName.toLowerCase()&&(!this.disabled&&"submit"!=d&&"reset"!=d&&"button"!=d&&("radio"!=d&&"checkbox"!=d||this.checked))&&b.push({name:c.attr("name"),value:c.val()})});return b};a.fn.serialize=function(){var a=[];this.serializeArray().forEach(function(c){a.push(encodeURIComponent(c.name)+"="+encodeURIComponent(c.value))});return a.join("&")};
a.fn.submit=function(b){b?this.bind("submit",b):this.length&&(b=a.Event("submit"),this.eq(0).trigger(b),b.isDefaultPrevented()||this.get(0).submit());return this}})(Zepto);(function(a){"__proto__"in{}||a.extend(a.zepto,{Z:function(b,c){b=b||[];a.extend(b,a.fn);b.selector=c||"";b.__Z=!0;return b},isZ:function(b){return"array"===a.type(b)&&"__Z"in b}});try{getComputedStyle(void 0)}catch(b){var c=getComputedStyle;window.getComputedStyle=function(a){try{return c(a)}catch(b){return null}}}})(Zepto);
(function(a){function b(a){var b=this.os={},e=this.browser={},g=a.match(/Web[kK]it[\/]{0,1}([\d.]+)/),h=a.match(/(Android);?[\s\/]+([\d.]+)?/),l=a.match(/(iPad).*OS\s([\d_]+)/),r=a.match(/(iPod)(.*OS\s([\d_]+))?/),u=!l&&a.match(/(iPhone\sOS)\s([\d_]+)/),B=a.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),v=B&&a.match(/TouchPad/),w=a.match(/Kindle\/([\d.]+)/),y=a.match(/Silk\/([\d._]+)/),q=a.match(/(BlackBerry).*Version\/([\d.]+)/),p=a.match(/(BB10).*Version\/([\d.]+)/),C=a.match(/(RIM\sTablet\sOS)\s([\d.]+)/),
E=a.match(/PlayBook/),n=a.match(/Chrome\/([\d.]+)/)||a.match(/CriOS\/([\d.]+)/),k=a.match(/Firefox\/([\d.]+)/),f=a.match(/MSIE ([\d.]+)/),A=g&&a.match(/Mobile\//)&&!n,x=a.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/)&&!n,f=a.match(/MSIE\s([\d.]+)/);if(e.webkit=!!g)e.version=g[1];h&&(b.android=!0,b.version=h[2]);u&&!r&&(b.ios=b.iphone=!0,b.version=u[2].replace(/_/g,"."));l&&(b.ios=b.ipad=!0,b.version=l[2].replace(/_/g,"."));r&&(b.ios=b.ipod=!0,b.version=r[3]?r[3].replace(/_/g,"."):null);B&&
(b.webos=!0,b.version=B[2]);v&&(b.touchpad=!0);q&&(b.blackberry=!0,b.version=q[2]);p&&(b.bb10=!0,b.version=p[2]);C&&(b.rimtabletos=!0,b.version=C[2]);E&&(e.playbook=!0);w&&(b.kindle=!0,b.version=w[1]);y&&(e.silk=!0,e.version=y[1]);!y&&(b.android&&a.match(/Kindle Fire/))&&(e.silk=!0);n&&(e.chrome=!0,e.version=n[1]);k&&(e.firefox=!0,e.version=k[1]);f&&(e.ie=!0,e.version=f[1]);if(A&&(a.match(/Safari/)||b.ios))e.safari=!0;x&&(e.webview=!0);f&&(e.ie=!0,e.version=f[1]);b.tablet=!(!l&&!E&&!(h&&!a.match(/Mobile/)||
k&&a.match(/Tablet/)||f&&!a.match(/Phone/)&&a.match(/Touch/)));b.phone=!(b.tablet||b.ipod||!h&&!u&&!B&&!q&&!p&&!(n&&a.match(/Android/)||n&&a.match(/CriOS\/([\d.]+)/)||k&&a.match(/Mobile/)||f&&a.match(/Touch/)))}b.call(a,navigator.userAgent);a.__detect=b})(Zepto);
(function(a,b){var c="",d,e=window.document.createElement("div"),g=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,h,l,r,u,B,v,w,y,q,p={};a.each({Webkit:"webkit",Moz:"",O:"o"},function(a,g){if(e.style[a+"TransitionProperty"]!==b)return c="-"+a.toLowerCase()+"-",d=g,!1});h=c+"transform";p[l=c+"transition-property"]=p[r=c+"transition-duration"]=p[B=c+"transition-delay"]=p[u=c+"transition-timing-function"]=p[v=c+"animation-name"]=p[w=c+"animation-duration"]=p[q=c+"animation-delay"]=
p[y=c+"animation-timing-function"]="";a.fx={off:d===b&&e.style.transitionProperty===b,speeds:{_default:400,fast:200,slow:600},cssPrefix:c,transitionEnd:d?d+"TransitionEnd":"transitionend",animationEnd:d?d+"AnimationEnd":"animationend"};a.fn.animate=function(d,c,e,g,f){a.isFunction(c)&&(g=c,c=e=b);a.isFunction(e)&&(g=e,e=b);a.isPlainObject(c)&&(e=c.easing,g=c.complete,f=c.delay,c=c.duration);c&&(c=("number"==typeof c?c:a.fx.speeds[c]||a.fx.speeds._default)/1E3);f&&(f=parseFloat(f)/1E3);return this.anim(d,
c,e,g,f)};a.fn.anim=function(d,c,e,k,f){var A,x={},D,t="",m=this,F,G=a.fx.transitionEnd,H=!1;c===b&&(c=a.fx.speeds._default/1E3);f===b&&(f=0);a.fx.off&&(c=0);if("string"==typeof d)x[v]=d,x[w]=c+"s",x[q]=f+"s",x[y]=e||"linear",G=a.fx.animationEnd;else{D=[];for(A in d)g.test(A)?t+=A+"("+d[A]+") ":(x[A]=d[A],D.push(A.replace(/([a-z])([A-Z])/,"$1-$2").toLowerCase()));t&&(x[h]=t,D.push(h));0<c&&"object"===typeof d&&(x[l]=D.join(", "),x[r]=c+"s",x[B]=f+"s",x[u]=e||"linear")}F=function(b){if("undefined"!==
typeof b){if(b.target!==b.currentTarget)return;a(b.target).unbind(G,F)}else a(this).unbind(G,F);H=!0;a(this).css(p);k&&k.call(this)};0<c&&(this.bind(G,F),setTimeout(function(){H||F.call(m)},1E3*c+25));this.size()&&this.get(0).clientLeft;this.css(x);0>=c&&setTimeout(function(){m.each(function(){F.call(this)})},0);return this};e=null})(Zepto);$.scrollTop=function(a){if(a||0===a)document.body.scrollTop=a;else return document.body.scrollTop};
(function(){(function(a){return a.fn.hoover=function(b){var c,d,e,g,h,l,r;c=this;r=null;e=!1;l={"in":250,out:150};b&&a.extend(l,b);d=function(){c.trigger("hooverIn");h();return e=!0};g=function(){c.trigger("hooverOut");h();return e=!1};h=function(){r&&clearTimeout(r);return r=null};c.bind("mouseover",function(){if(e)return h();if(!r)return r=setTimeout(d,l["in"])});c.bind("mouseout",function(){return e?(r&&h(),r=setTimeout(g,l.out)):h()});return this}})(window.Zepto||window.jQuery)}).call(this);
var Routes={recommend:"recommend",thanks:"thanks",decline:"decline",complete:"complete",place:"place",schedule:"schedule",":id":"invitation",_root:"invitation"},Views={},Behaviors={},App={params:{os_offset:0,foursquare:{client_id:"4SIMQ4JDF4JFUKV1XY52C1UB4ZBOJNX5XSXT3YUF2UNBP10N"}},reply:{timeslots:{},location:{}},initialize:function(){"iPhone"==Env.device.device&&7>Env.device.version&&(this.params.os_offset=60);this.intercept_foursquare_token();var a=window.location.hash.replace("#!","");a in Routes&&
(window.localStorage&&window.localStorage.getItem("current_meeting"))&&(a=window.localStorage.getItem("current_meeting"));window.localStorage&&window.localStorage.getItem("meeting_"+a)?(App.meeting=JSON.parse(window.localStorage.getItem("meeting_"+a)),window.localStorage.getItem("reply_"+a)&&(App.reply=JSON.parse(window.localStorage.getItem("reply_"+a))),App.launch()):0<a.length?(App.loader(),App.api.request("get@meetings/"+a,{success:function(){console.log(this);null==this.data.user&&(this.data.user=
{name:"Alex"});App.save_meeting(this)}})):$("#wrapper").append($(Templates.error).html())},save_meeting:function(a){200==a.code?(App.meeting=a.data,window.localStorage&&(window.localStorage.setItem("meeting_"+App.meeting.id,JSON.stringify(a.data)),window.localStorage.setItem("current_meeting",App.meeting.id)),App.launch()):$("#wrapper").append($(Templates.error).html());App.end_loading()},save_reply:function(){window.localStorage.setItem("reply_"+App.meeting.id,JSON.stringify(App.reply))},launch:function(){Nav.initialize({remove_views:!1,
no_access_animation:"slide",ui_delay:500})},before_transition:function(){Nav.view.requests=[];App.resize();$.fn.placeholder&&Nav.view.$el.find("input[type=text], input[type=date], input[type=password], textarea").placeholder()},after_transition:function(){Nav.elmt.css({height:Nav.view.$el.height()})},before_unload:function(){Nav.view.requests&&App.cancel_requests()},send_reply:function(a){App.loader();App.api.request("put@meetings/"+App.meeting.id,{data:App.reply,success:function(){204==this.code&&
a()}})},cancel_requests:function(){for(var a=0;a<Nav.view.requests.length;a++)Nav.view.requests[a].abort();Nav.view.refreshing=!1;Nav.view.requests=[]},resize:function(){0<App.params.os_offset&&(Ui.min_height=$(window).height()+App.params.os_offset,App.params.os_offset=0);var a=Nav.elmt.is("#wrapper")?$("header").height():0,b=App.get_auto_height(Nav.view.$el),c=App.get_auto_height(Nav.elmt);b+a+App.params.os_offset<Ui.min_height?Nav.view.$el.css({height:Ui.min_height-a+App.params.os_offset}):Nav.view.$el.css({height:b});
a=[b,c,$(window).height()];Nav.current_transition&&a.push(Nav.current_transition.prev_view.$el.height());Nav.elmt.css({height:a.max()})},reset_and_resize:function(){Nav.elmt.css({height:"auto"});Nav.view.$el.css({height:"auto"});Nav.run("resize")},get_auto_height:function(a){var b=a.clone();b.css({visibility:"hidden",height:"auto"});a.after(b);a=b.height();b.remove();return a},loader:function(){$.scrollTop(0);App.loader_elmt=$('<div class="loader"><span></span></div>');(Nav.view?Nav.view.$el:$("#wrapper")).append(App.loader_elmt.css({opacity:0}));
App.loader_elmt.animate({opacity:1})},end_loading:function(a){App.loader_elmt&&App.loader_elmt.animate({opacity:0},{complete:function(){App.loader_elmt.remove();App.loader_elmt=null;a&&a()}})},get_dates:function(a,b){for(var c=[],d=a;d<=b;)c.push(new Date(d)),d=d.addDays(1);return c},parse_date:function(a){return"function"==typeof Date.iso_date_parser?Date.iso_date_parser(a):Date.parse(a)},date:function(a,b){"string"==typeof a&&(a=App.parse_date(a));var c=new Date(a);return"January February March April May June July August September October November December".split(" ")[c.getMonth()]+
" "+App.ordinal_number(c.getDate())+" "+c.getFullYear()},ordinal_number:function(a){var b=["th","st","nd","rd"],c=a%100;return a+(b[(c-20)%10]||b[c]||b[0])},date_number:function(a){return 1==a.toString().length?"0"+a:a},get_position:function(a){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){a({latitude:b.coords.latitude,longitude:b.coords.longitude})},function(b){a({latitude:null,longitude:null})}):a(!1)},authenticate_foursquare:function(){var a={client_id:App.params.foursquare.client_id,
response_type:"token",redirect_uri:window.location.href.split("#")[0]};window.location.href="https://foursquare.com/oauth2/authenticate?"+$.param(a)},intercept_foursquare_token:function(){window.localStorage&&window.localStorage.getItem("foursquare_token")&&(App.foursquare_token=window.localStorage.getItem("foursquare_token"));if(-1<window.location.hash.indexOf("access_token")){if(!App.foursquare_token){var a=window.location.hash.split("#").reverse()[0].split("=").reverse()[0];window.localStorage&&
window.localStorage.setItem("foursquare_token",a)}window.location.replace("#!recommend")}},distance:function(a,b){var c=(b.lat-a.lat)*(Math.PI/180),d=(b.lng-a.lng)*(Math.PI/180),c=Math.sin(c/2)*Math.sin(c/2)+Math.cos(a.lat*(Math.PI/180))*Math.cos(b.lat*(Math.PI/180))*Math.sin(d/2)*Math.sin(d/2);return 6371*2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))}};Date.prototype.addDays=function(a){var b=new Date(this.valueOf());b.setDate(b.getDate()+a);return b};
Array.prototype.without=function(a){for(var b=[],c=0;c<this.length;c++)this[c]!=a&&b.push(this[c]);return b};Array.prototype.max=function(){return Math.max.apply(null,this)};Array.prototype.min=function(){return Math.min.apply(null,this)};Array.prototype.first=function(){return this[0]};Array.prototype.last=function(){return this[this.length-1]};$.keys=function(a){return $.map(a,function(a,c){return c})};String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};$(document).ready(function(){App.initialize()});
App.api={request:function(a,b){var c={};c.url="/"+a.split("@")[1];c.method=a.split("@")[0];b.data||(b.data={});b.vars&&$.each(b.vars,function(a,b){c.url=c.url.replace("{"+a+"}",b)});b.data&&("post"==c.method||"put"==c.method?c.data=b.data:-1==c.url.indexOf("?")?c.url+="?"+$.param(b.data):c.url+="&"+$.param(b.data));return $.ajax({type:"post",data:c,url:"/api",dataType:"json",timeout:2E4,success:function(a){b.success.apply(a,[a])},error:b.error})}};
(function(a,b,c){b.support=b.support||{};b.support.touch="ontouchend"in document;b.support.mouse=!0==b.os.blackberry||!b.support.touch;b.support.webkit=(document.body||document.documentElement).style.WebkitTransition!==c;b.support.webkit3d="WebKitCSSMatrix"in a&&"m11"in new WebKitCSSMatrix;a=b.support;c=document.createElement("input");c.setAttribute("type","file");a.upload=!c.disabled;b.browser=b.browser||{};b.browser.chrome=!!navigator.userAgent.match(/chrome/i)})(window,$);
(function(a,b,c){function d(d){function h(d){b(document.body).on("mousemove",function(){y=!1});d.on("mouseover mousedown",function(a){!0==y&&b.support.mouse&&(y=!1);!1==y&&u(a)});d.on("mouseout mouseup",function(a){!1==y&&B(a)});d.on("click",function(b){!(a.isFakeEvent!==c&&!0===a.isFakeEvent(b))&&!1==y&&v(b)})}function l(a){a.on("click",function(a){a.preventDefault()});a.each(function(){var a=0,c=0,h=null,l=!1,k=this;b(k).on("touchstart",function(d){b.support.mouse&&(y=!0);a=d.targetTouches[0].clientX;
c=d.targetTouches[0].clientY;r();0>e.indexOf(k)&&(e.push(k),h=setTimeout(function(){h=null;u(d)},150))},!1);b(k).on("touchmove",function(b){if(!l&&(Math.abs(b.targetTouches[0].clientX-a)>d.distance||Math.abs(b.targetTouches[0].clientY-c)>d.distance))l=!0,h?(clearTimeout(h),h=null):B(b)},!1);b(k).on("touchend",function(a){!l&&0<=e.indexOf(k)&&(null!==h?(clearTimeout(h),h=null,u(a),setTimeout(function(){v(a);setTimeout(function(){B(a)},100)},100)):(v(a),B(a)));l=!1},!1)})}function r(){for(var a=0;a<
e.length;a++)B({target:e[a],preventDefault:function(){},stopPropagation:function(){}})}function u(a){var c=b(a.target).is("a")?b(a.target):b(a.target).parents("a");c.addClass(d.hover_class);d.enter.apply(c,[a])}function B(a){var c=b(a.target).is("a")?b(a.target):b(a.target).parents("a");c.removeClass(d.hover_class);d.leave.apply(c,[a]);a=[];for(var h=0;h<e.length;h++)e[h]!==c.get(0)&&a.push(e[h]);e=a}function v(a){d.prevent&&a.preventDefault();var c=b(a.target).is("a")?b(a.target):b(a.target).parents("a");
d.run.apply(c,[a,c.attr("data-href")])}d=b.extend({hover_class:"hover",time:500,distance:15,leave:function(){},enter:function(){},run:function(){},prevent:!0},d);var w=b(this),y=b.support.mouse;(function(a){a.each(function(){var a=b(this);null==a.attr("data-href")&&a.attr("data-href",a.attr("href"))})})(w);b.support.touch&&(l(w),w.attr("href",""));b.support.mouse&&h(w);w.on("run",function(a){v(a)});return b(this)}var e=[];b.fn.link=b.fn.link||d})(window,$);
(function(a,b,c){a.Nav={moves:[],views:[],options:{},initialize:function(d){this.options=b.extend({elmt:"#wrapper",append_to:"#wrapper",ui_delay:0,access_filter:function(){return!0},remove_views:!0},d);this.set_browser_prefs();this.elmt=b(Nav.options.elmt);this.append_to=b(Nav.options.append_to);Router.initialize();var c=Router.parse_hash().url,g=Nav.new_view(Router.view_for(c),c);this.view=g;d=this.check_access_filter(this.view);!0!==d?(this.view=this.new_view(Router.view_for(d),d),this.url_before_access_filter=
c,a.localStorage&&a.localStorage.setItem("url_before_access_filter",c),c=Router.parse_hash().url,a.location.replace("#!"+d)):a.localStorage&&(this.url_before_access_filter=a.localStorage.getItem("url_before_access_filter"));""==a.location.hash?Router.replace_url(""):b.os.ios&&7>b.os.version.split(".")[0]&&a.scrollTo(0,1);this.load_page(this.view,{complete:function(){Nav.insert(Nav.view);Nav.moves.push({path:c,view:g,instance:Nav.view});Nav.views.push({path:c,view:g,instance:Nav.view});Nav.moves.current=
Nav.moves[0];Nav.run("after_transition",[Nav.view]);Nav.run("after_initialize",[Nav.view]);Router.listen()}});b.os.ios&&7>b.os.version.split(".")[0]&&this.hide_ios_bar();navigator.standalone&&b(document.body).addClass("webapp");this.init_resizing()},init_resizing:function(){var d=function(){a.setTimeout(function(){b.os.ios&&(7>b.os.version.split(".")[0]&&0==b.scrollTop())&&a.scrollTo(0,1);Nav.run("resize",[Nav.view])},Nav.options.ui_delay)};if(a.orientationchange!==c)b(a).on("orientationchange",function(){d()});
else b(a).on("resize",function(){d()})},go:function(a,e,g){if(this.moves.current&&Router.parse(a).url==this.moves.current.path||"object"==typeof this.current_transition)return!1;Router.pause();this.current_transition=g||{};this.current_transition.url=a;this.current_transition.prev_view=this.view;a=Router.parse(a).url;var h=Router.view_for(a),l=this.view,r=this.current_transition.view!==c?this.current_transition.view:this.get_freshest_view_for(a,h);if(!0===this.current_transition.back&&(null==e||0==
e.length)&&l.animation){var u=l.animation;e=this.opposite_animation(l.animation)}g&&g.data&&!r.data&&(r.data=g.data);var B=this.get_method(e,r);this.run("before_unload",[this.view]);var v=this.check_access_filter(r);if(!0!==v)return h=Router.view_for(v),this.new_view(h,v),e=Nav.options.no_access_animation||e,Nav.current_transition=!1,Nav.go(v,e,g),!1;Nav.view=r;!0!==Nav.current_transition.back?(Nav.view.animation=e,Nav.view.history_index=Nav.moves.length):(Nav.view.animation=u,Nav.view.history_index=
Nav.moves.length-1);Nav.auto_links();!0!==Nav.current_transition.back&&Router.replace_url(a);r.$el.attr("style","");b.scrollTop(0);B.apply(Nav,[l,r,function(){!0==Nav.options.remove_views?(l.$el.remove(),l.inserted=!1):l.$el.hide();!0!==Nav.current_transition.back?(Nav.moves.push({path:a,view:h,animation:e,instance:r}),Nav.views.push({path:a,view:h,animation:e,instance:r})):Nav.cut_moves_at(Nav.view.history_index);Nav.moves.current=Nav.moves[Nav.moves.length-1];Nav.run("after_unload",[Nav.current_transition.prev_view]);
Nav.run("after_transition",[Nav.view]);(Nav.current_transition.after_transition||function(){}).apply(Nav.view,[Nav.view.first_time]);Nav.current_transition=c;Router.listen()}])},check_access_filter:function(a){a=("function"==typeof a.access_filter?a.access_filter:Nav.options.access_filter).apply(a);return!0!==a&&"string"==typeof a?a:!0},get_method:function(a,b){var g=Animation[a]!==c?Animation[a]:Animation.direct;b&&(b.use_transition&&Animation[b.use_transition])&&(g=Animation[b.use_transition]);
return g},run:function(a,c,g){c=c||[Nav.view];(Ui[a]||function(){}).apply(Ui,g);(App[a]||function(){}).apply(App,g);"object"==typeof Nav.current_transition&&(Nav.current_transition[a]||function(){}).apply(Nav,g);b.each(c,function(b,c){"function"==typeof c.run?c.run(a,g):(c[a]||function(){}).apply(c,g)})},load_page:function(a,e){a.remote==c?e.complete():"function"==typeof a.remote?((e.loading||Nav.loading||function(){}).apply(a,[a]),a.remote.apply(a,[e])):((e.loading||Nav.loading||function(){})(),
a.get_params!==c&&(a.remote.data=a.get_params()),b.ajax(b.extend({type:"get",success:function(a){b("#loader").remove();Nav.view.data=a;e.complete()}},a.remote)))},insert:function(a,c){Nav.run("before_insert",[a],[a.first_time]);c=b.extend({callbacks:!0},c||{});!0!==a.inserted?(a.render(),(c.before_append||function(){})(),(c.before_append_or_display||function(){})(),Nav.append_to.append(a.$el),Nav.auto_links(a.$el),a.inserted=!0,a.first_time=!0):((c.before_display||function(){})(),(c.before_append_or_display||
function(){})(),a.$el.show(),a.first_time=!1);!0==c.callbacks&&Nav.run("before_transition",[a],[a.first_time])},loading:function(){Nav.run("loading");if(0==b("#loader").length){var a=b('<div id="loader" class="live"><p>'+App.loading_text[App.locale]+"...</p><span></span></div>");b(document.body).append(a)}},set_browser_prefs:function(){b.os.android&&(Nav.options.ui_delay=300)},opposite_animation:function(a){switch(a){case "fall":return"sky"}},hide_ios_bar:function(){a.setTimeout(function(){0==b.scrollTop()&&
(a.scrollTo(0,1),Nav.hide_ios_bar())},3E3)},auto_links:function(b){b=b||Nav.view.$el;b.find("a[data-auto]").link({run:function(b,d){b.preventDefault();this.hasClass("back")?a.history.back():Nav.go(d,this.attr("data-auto"))}})},new_view:function(a,b){var c=Views.new(a);c.name=a;c.path=Router.parse(b).url;c.params=Router.to_parameters(c.path);(c.initialize||function(){}).apply(c);return c},get_freshest_view_for:function(a,b){for(var c=Nav.views.length-1;0<=c;c--)if(Nav.views[c].path==a&&!0==Nav.views[c].instance.inserted)return Nav.views[c].instance;
return Nav.new_view(b,a)},get_last_view_for:function(a){for(var b=Nav.moves.length-1;0<=b;b--)if(Nav.views[b].path==a)return Nav.moves[b].instance;return!1},get_prev_view_for:function(a){for(var b=0,c=Nav.moves.length-1;0<=c;c--)if(Nav.views[c].path==a)if(0==b)b++;else return Nav.moves[c].instance;return!1},cut_moves_at:function(a){for(var b=[],c=0;c<Nav.moves.length;c++)if(c<a)b.push(Nav.moves[c]);else break;Nav.moves=b;0==Nav.moves.length&&(Nav.moves.push({path:Nav.view.path,instance:Nav.view,view:Nav.view.name}),
Nav.views.push({path:Nav.view.path,instance:Nav.view,view:Nav.view.name}))}}})(window,$);
(function(a,b,c){a.Ui={min_height:0,remove_before_transition:[],clones_to_show:[],before_transition:function(){Ui.set_nav();Ui.remove_fixed_elements();Ui.set_min_size()},after_transition:function(){Ui.fix_element_complete()},resize:function(){Nav.view.$el.css({width:b(a).width()});Ui.min_height=0;Ui.set_min_size()},fix_element:function(c){if(300>b(a).height())return c;var e=c.clone();c.css({position:"absolute",top:b(a).height()-c.height()-b("header").height()+2,left:0,right:0});e.css({visibility:"hidden"}).addClass("fixed").css({position:"fixed",
bottom:0,top:"auto"});Ui.clones_to_show.push({clone:e,elmt:c});Nav.auto_links(e);b(document.body).append(e);Ui.remove_before_transition.push({show:c,clone:e});return e},fix_element_complete:function(){for(var a=0;a<Ui.clones_to_show.length;a++)Ui.clones_to_show[a].clone.css({visibility:"visible"}),Ui.clones_to_show[a].elmt.css({visibility:"hidden"}).css({position:"static"});Ui.clones_to_show=[]},remove_fixed_elements:function(){b.each(Ui.remove_before_transition,function(c,e){var g=0==b.scrollTop()?
2:b.scrollTop()+4;e.show.css({position:"absolute",top:b(a).height()-e.show.height()-b("header").height()+g,left:0,right:0});e.show.css({visibility:"visible"});e.clone.remove()});Ui.remove_before_transition=[]},set_min_size:function(){b(a).height()>Ui.min_height&&(Ui.min_height=b(a).height())},set_nav:function(){if(Nav.current_transition&&!0!==Nav.current_transition.back)var a=Nav.moves&&Nav.moves.current?Nav.moves.current.instance:Nav.view,b=Nav.moves?Nav.moves.current.path:"/",a=a.next_prev_label==
c?"Back":a.next_prev_label(),g=Nav.view.prev_link==c?Nav.view.$el.find("nav.bar a.back"):Nav.view.prev_link();else if(Nav.moves.current){var h=Nav.get_prev_view_for(Nav.moves.current.path)||Nav.get_last_view_for(Nav.moves.current.path);Nav.moves[h.history_index-2]!==c&&(a=Nav.moves[h.history_index-2].instance,b=Nav.moves[h.history_index-2].path,a=a.next_prev_label==c?"Back":a.next_prev_label(),g=Nav.view.prev_link==c?Nav.view.$el.find("nav.bar a.back"):Nav.view.prev_link())}g&&(b&&a)&&(Ui.truncate_button(g,
a),g.attr("href",b).attr("data-href",b));b=Nav.view.$el.find("a.next");h=b.find("span").html();null!=b&&(0<b.length&&h)&&Ui.truncate_button(b,h)},truncate_button:function(c,e){c.attr("title",e);var g={small:12,medium:20,large:40}[c.attr("data-size")||"small"],h=b('<span style="display:inline; visibility:hidden">m</span>');c.after(h);var l=h.width();h.remove();h=b(a).width()-320;0<h&&(g+=Math.floor(h/l));e&&e.length>g&&(e=e.substr(0,g)+"...");c.find("span").html(e)},form_fixes_after_transition:function(a,
c){c=c||{};b.os.android&&!b.browser.chrome&&(a.find("select").each(function(a){var d=b(this),l=Ui.insert_cloned_input(d);l.addClass(c.select_class||"cloned").on("change",function(){d.val(l.val());d.trigger("change")});(c.after_append||function(){}).apply(l,[l])}),a.find("input[type=radio]").each(function(a){var d=b(this),l=Ui.insert_cloned_input(d);l.attr("name",d.attr("name")).addClass(c.select_class||"cloned").addClass("radio");l.on("change",function(){d[0].checked=l[0].checked;d.trigger("change")});
(c.after_append||function(){}).apply(l,[l])}),a.find("input[type=checkbox]").each(function(a){var d=b(this),l=Ui.insert_cloned_input(d);l.addClass(c.select_class||"cloned").addClass("checkbox").on("change",function(){d[0].checked=l[0].checked;d.trigger("change")});(c.after_append||function(){}).apply(l,[l])}))},form_fixes_before_unload:function(a,c){c=c||{};b.os.android&&!b.browser.chrome&&(a.find("select").css({visibility:"visible"}),a.find("input[type=radio]").css({visibility:"visible"}),a.find("input[type=checkbox]").css({visibility:"visible"}),
b(document.body).find("select."+(c.select_class||"cloned")).remove(),b(document.body).find("input.radio."+(c.select_class||"cloned")).remove(),b(document.body).find("input.checkbox."+(c.select_class||"cloned")).remove())},form_fixes_resize:function(a,c){b.os.android&&!b.browser.chrome&&(a.find("select").each(function(a){a=b(this);var c=b(a.attr("data-clone"));Ui.size_cloned_input(a,c)}),a.find("input[type=radio]").each(function(a){a=b(this);var c=b(a.attr("data-clone"));Ui.size_cloned_input(a,c)}),
a.find("input[type=checkbox]").each(function(a){a=b(this);var c=b(a.attr("data-clone"));Ui.size_cloned_input(a,c)}))},form_fixes_on_resize:function(c,e){e=e||{};b.os.android&&!b.browser.chrome&&a.setTimeout(function(){Ui.form_fixes_resize(c,e)},0)},insert_cloned_input:function(a){var c=a.clone();a.css({visibility:"hidden"});c.val(a.val());Ui.size_cloned_input(a,c);Ui.tag_cloned_input(a,c);b(document.body).append(c);return c},size_cloned_input:function(a,b){var c=a.offset();b.css({position:"absolute",
zIndex:20,top:c.top,left:c.left,width:a.width(),height:a.height()})},tag_cloned_input:function(a,b){var c="cloned_input_"+Math.floor(11*Math.random());a.attr("data-clone",c);b.attr("id",c)},protect_form:function(a){var c=b('<div style="position:absolute; top:0; left:0; right:0; bottom:0; background:transparent; padding:0; margin:0;" />');c.css({height:a.height()});a.append(c);return c}}})(window,$);
var Views={store:{},"new":function(a){var b={},c;for(c in this.store[a])b[c]=this.store[a][c];for(c in this.instance_methods)b[c]=this.instance_methods[c];b.$el=$("<div />");b.className&&b.$el.attr("class",b.className);return b},define:function(a,b){this.store[a]=b},instance_methods:{attach_behavior:function(a){this.behaviors=this.behaviors||{};this.behaviors[a]="function"==typeof Behaviors[a]?new Behaviors[a](this):$.extend({},Behaviors[a]);"function"==typeof this.behaviors[a].initialize&&this.behaviors[a].initialize.apply(this)},
run:function(a,b){b=b||[];(this[a]||function(){}).apply(this,b);for(var c in this.behaviors)(this.behaviors[c][a]||function(){}).apply(this,b)}}},Router={routes:{},root:{},timer:null,prev_url:"",initialize:function(){this.index_routes()},listen:function(){this.prev_url=this.parse_hash().url;this.timer=window.setTimeout(function(){var a=Router.parse_hash().url;Router.prev_url!=a?(Nav.run("url_changed",[Nav.view]),"object"!==typeof Nav.current_transition?Nav.go(a,null,{back:!0,after_transition:function(){Router.listen()}}):
Router.listen()):Router.listen()},300)},pause:function(){window.clearTimeout(this.timer);this.timer=null},navigate:function(a){this.pause();this.replace_url(a);this.listen()},replace_url:function(a){window.location.href="#!"+this.parse(a).url},to_parameters:function(a){var b={},c=this.route_for(a);if(0<c.param_names.length){a=this.parse(a).url.match(c.exp);for(var d=1;d<=c.param_names.length;d++)b[c.param_names[d-1]]=a[d]}return b},parse:function(a){var b=a.split("?")[1];a=a.split("?")[0].replace("#!",
"").replace("#","");"/"==a.charAt(0)&&(a=a.substr(1));return{url:a,params:b}},parse_hash:function(){return this.parse(window.location.hash)},index_routes:function(){for(var a in Routes)if("_root"==a)this.root={view:Routes[a],param_names:[],exp:""};else{var b="^"+a+"$",b=b.replace("/","/"),c=[],d=a.match(/\:[a-z0-9\\-\\_]+/g);if(d)for(var e=0;e<d.length;e++)c.push(d[e].replace(":","")),b=b.replace(RegExp(":"+c[e],"g"),"([a-z0-9\\-\\_]+)");b=b.replace("*params","");this.routes[b]={view:Routes[a],param_names:c,
exp:b}}},view_for:function(a){return(this.route_for(a)||{}).view},route_for:function(a){a=this.parse(a).url;if(0<a.length)for(var b in this.routes){if(a.match(b))return this.routes[b]}else return this.root}},Animation={direct:function(a,b,c){Nav.load_page(b,{complete:function(){a.$el.hide();Animation.reset_slider();Nav.insert(b);b.$el.show();c()}})},slide_down:function(a,b,c){Nav.load_page(b,{complete:function(){a.$el.height();$(window).height();c()}})},slide_up:function(a,b,c){Nav.load_page(b,{complete:function(){var d=
parseInt($("#wrapper").css("top"));a.$el.height()>$(window).height()?(Nav.insert(b),b.$el.css({position:"absolute",top:d+a.$el.height()}).show(),$("#wrapper").animate({top:d-a.$el.height()},{complete:function(){c()}})):(Nav.insert(b),b.$el.css({position:"absolute",top:d+a.$el.height(),opacity:0}).show(),b.$el.animate({opacity:1},{complete:function(){$("#wrapper").animate({top:d-a.$el.height()},{complete:function(){c()}})}}))}})},slide:function(a,b,c){Nav.load_page(b,{complete:function(){var d=$(window).width(),
e=Animation.get_offset(Nav.elmt);a.$el.css({position:"absolute",top:0,left:e.x,width:d});Nav.insert(b,{before_append_or_display:function(){b.$el.css({position:"absolute",top:0,left:e.x+d,width:d})}});Nav.elmt.css({position:"relative"});Animation.move_element(Nav.elmt,{x:-(e.x+d),duration:300,end:function(a){Animation.reset_slider();Nav.view.$el.css({left:0});c()}})}})},slide_back:function(a,b,c){Nav.load_page(b,{complete:function(){var d=$(window).width(),e=Animation.get_offset(Nav.elmt);a.$el.css({position:"absolute",
top:0,left:e.x,width:d});Nav.insert(b,{before_append_or_display:function(){b.$el.css({position:"absolute",top:0,left:e.x-d,width:d})}});Nav.elmt.css({position:"relative"});Animation.move_element(Nav.elmt,{x:-(e.x-d),duration:300,end:function(a){Animation.reset_slider();Nav.view.$el.css({left:0});c()}})}})},cover:function(a,b,c){Nav.load_page(b,{complete:function(){var d=$(window).width(),e=Animation.get_offset(Nav.elmt),g=parseInt(b.$el.css("z-index"))||0,h=g+1;a.$el.css({"z-index":g});Nav.insert(b,
{before_append_or_display:function(){b.$el.css({position:"absolute",top:0,left:e.x+d,width:d,"z-index":h})}});Animation.move_element(b.$el,{x:-d,duration:350,transition:"ease-in",end:function(a){c()}})}})},uncover:function(a,b,c){Nav.load_page(b,{complete:function(){var d=$(window).width(),e=Animation.get_offset(Nav.elmt),g=parseInt(b.$el.css("z-index"))||1,h=g-1;a.$el.css({"z-index":g});b.$el.css("z-index")||b.$el.css({"z-index":g});Nav.insert(b,{before_append_or_display:function(){b.$el.css({position:"absolute",
top:0,left:e.x,width:d,"z-index":h})}});Animation.move_element(a.$el,{x:d,duration:450,transition:"ease-in",end:function(a){c()}})}})},move_element:function(a,b){b=b||{};var c={"-webkit-transition":(b.duration||"400")+"ms "+(b.transition||"ease-in-out"),"-webkit-transform":Animation.get_webkit_translation(b.x,b.y)};b["background-color"]&&(c["background-color"]=b["background-color"]);window.setTimeout(function(){a.css(c);if("function"==typeof b.end)a.on("webkitTransitionEnd",function(){a.off("webkitTransitionEnd");
b.end()})},0)},unfold_element:function(a,b){b=b||{};var c=a.clone();c.css({visibility:"hidden",position:"absolute",height:"auto"}).show();a.after(c);var d=c.height();c.remove();a.css({height:0}).show();var e=(b.duration||"400")+"ms";window.setTimeout(function(){a.css({"-webkit-transition-timing-function":b.transition||"ease-in-out","-webkit-transition":"height "+e});a.css({height:d});if("function"==typeof b.end)a.on("webkitTransitionEnd",function(){b.end();a.css({"-webkit-transition-timing-function":"",
"-webkit-transition":""});a.unbind("webkitTransitionEnd")})},0)},fold_element:function(a,b){b=b||{};var c=(b.duration||"400")+"ms";window.setTimeout(function(){a.css({"-webkit-transition-timing-function":b.transition||"ease-in-out","-webkit-transition":"height "+c});a.css({height:0});if("function"==typeof b.end)a.on("webkitTransitionEnd",function(){b.end();a.hide().css({"-webkit-transition-timing-function":"","-webkit-transition":""});a.unbind("webkitTransitionEnd")})},0)},get_offset:function(a){var b=
a.css("-webkit-transform");a={y:0,x:0};b&&0<b.length&&(b=b.split("(").reverse()[0].split(")")[0].split(","),1<b.length&&(a.x=-parseInt(b[0].replace(" ","").replace("px","")),a.y=-parseInt(b[1].replace(" ","").replace("px",""))));return a},get_webkit_translation:function(a,b){a=Math.ceil(a)||0;b=Math.ceil(b)||0;return $.support.webkit3d?"translate3d("+a+"px, "+b+"px, 0)":"translate("+a+"px, "+b+"px)"},reset_slider:function(){Nav.elmt.css({"-webkit-transition-timing-function":"ease-in","-webkit-transition-duration":"0ms",
"-webkit-transform":"none"})}};
Views.define("invitation",{className:"invitation",render:function(){this.$el.html($(Templates.invitation).html());this.$el.find("p.title strong").html(App.meeting.user.name);this.$el.find("p.location").html(App.meeting.trip.location);var a=App.date(App.meeting.trip.from),b=App.date(App.meeting.trip.to);this.$el.find("p.time").append("<span>"+a+"</span>");a!=b&&this.$el.find("p.time").append("<br/> to <span>"+App.date(App.meeting.trip.to)+"</span>");return this},before_transition:function(){this.$el.find("p.start a").link({run:function(a,b){a.preventDefault();
Nav.go(b,"slide")}})}});
Views.define("schedule",{className:"schedule",render:function(){this.$el.html($(Templates.schedule).html());for(var a=App.get_dates(new Date(App.parse_date(App.meeting.trip.from)),new Date(App.parse_date(App.meeting.trip.to))),b=0;b<a.length;b++){var c=this.build_day(a[b]);this.$el.find("div.days").append(c)}return this},before_transition:function(){var a=this;this.refresh_slots();this.$el.find("div.days a").link({run:function(b){b.preventDefault();this.toggleClass("on");a.toggle(this.attr("data-day"),this.attr("data-slot"))}});
this.$el.find("p.start a").link({run:function(b,c){b.preventDefault();a.validate(c)}})},validate:function(a){0<$.keys(App.reply.timeslots).length?Nav.go(a,"slide"):window.confirm("Don't you really haven't time for your friend? Come on...")&&App.send_reply(function(){Nav.go("/decline","slide")})},refresh_slots:function(){this.$el.find("div.days a").removeClass("on");"object"==typeof App.reply.timeslots&&this.$el.find("div.days a").each(function(){var a=$(this);App.reply.timeslots[a.attr("data-day")]&&
-1<$.inArray(parseInt(a.attr("data-slot")),App.reply.timeslots[a.attr("data-day")])&&a.addClass("on")})},build_day:function(a){var b=$('<div class="day" />');b.append("<h3>"+App.date(a)+"</h3>");b.append('<ul class="availabilities" />');for(var c=0;24>c;c+=2)b.find("ul.availabilities").append('<li><a href="#" data-slot="'+c+'" data-day="'+a+'">'+c+"-"+(c+2)+"h</a></li>");return b},toggle:function(a,b){a=new Date(a);b=parseInt(b);var c=a.getFullYear()+"-"+App.date_number(a.getMonth()+1)+"-"+App.date_number(a.getDate());
App.reply.timeslots=App.reply.timeslots||{};App.reply.timeslots[c]=App.reply.timeslots[c]||[];-1==$.inArray(b,App.reply.timeslots[c])?App.reply.timeslots[c].push(b):(App.reply.timeslots[c]=App.reply.timeslots[c].without(b),0==App.reply.timeslots[c].length&&delete App.reply.timeslots[c]);App.save_reply()}});
Views.define("place",{className:"schedule",initialize:function(){this.attach_behavior("place_selector")},render:function(){this.$el.html($(Templates.place).html());return this},before_transition:function(){var a=this;this.$el.find("p.start a").link({run:function(b,c){b.preventDefault();a.complete_meeting()}});this.$el.find("div.current_location a").link({run:function(b){b.preventDefault();a.current_location()}})},after_transition:function(){var a=this.$el.find(".foursquare input"),b=this;this.$el.find("form.foursquare").on("submit",
function(c){c.preventDefault();a.blur();b.run("refresh_places",[a.val()])})},unselect_all:function(){this.$el.find("div.current_location").removeClass("on").find("div.map").hide();this.$el.find("ul.places li").removeClass("selected")},current_location:function(){var a=this;App.get_position(function(b){b&&(b=new google.maps.LatLng(b.latitude,b.longitude),(new google.maps.Geocoder).geocode({latLng:b},function(c,d){d==google.maps.GeocoderStatus.OK&&0<c.length&&a.use_current_location(c[1],b)}))})},use_current_location:function(a,
b){this.unselect_all();this.$el.find("div.current_location a").text(a.formatted_address);var c=this.$el.find("div.map"),d=this;if(0==c.length){c=$('<div class="map" />');this.$el.find("div.current_location").append(c);var e=new google.maps.Map(c.get(0),{zoom:16,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP}),g=new google.maps.Marker({position:b,map:e});google.maps.event.addListener(e,"center_changed",function(){var a=e.getCenter();g.setPosition(a);d.update_location({latitude:a.lat(),longitude:a.lng()})})}else c.show();
this.$el.find("div.current_location").addClass("on");this.update_location({latitude:b.lat(),longitude:b.lng()});Nav.run("resize")},use_place:function(a){this.unselect_all();a.parents("li").first().addClass("selected");a=this.places[a.attr("data-id")];this.update_location({latitude:a.location.lat,longitude:a.location.lng,foursquare:a})},update_location:function(a){App.reply.location=a;App.save_reply()},complete_meeting:function(){App.loader();App.send_reply(function(){Nav.go("/complete","slide",{after_transition:function(){App.loader_elmt&&
(App.loader_elmt.remove(),App.loader_elmt=null)}})})}});Views.define("complete",{className:"complete",render:function(){this.$el.html($(Templates.complete).html());this.$el.find("strong").html(App.meeting.user.name);return this},before_transition:function(){this.$el.find("a").link({run:function(a,b){a.preventDefault();App.foursquare_token?Nav.go(b,"slide"):App.authenticate_foursquare()}})}});
Views.define("decline",{className:"complete",render:function(){this.$el.html($(Templates.decline).html());this.$el.find("strong").html(App.meeting.user.name);return this}});
Views.define("recommend",{className:"schedule",initialize:function(){App.foursquare_token||App.authenticate_foursquare();this.attach_behavior("place_selector")},render:function(){this.$el.html($(Templates.recommend).html());this.$el.find("strong").html(App.meeting.user.name);return this},before_transition:function(){var a=this;this.$el.find("p.start a").link({run:function(){a.send_recs()}});var b=this.$el.find(".foursquare input"),a=this;this.$el.find("form.foursquare").on("submit",function(c){c.preventDefault();
b.blur();a.run("refresh_places",[b.val()])})},after_transition:function(){this.run("refresh_places",["",{api_path:"/users/self/checkins"}])},use_place:function(a){a.parents("li").first().toggleClass("selected")},send_recs:function(){var a=this;App.loader();App.api.request("put@meetings/"+App.meeting.id,{data:{recommendations_attributes:$.map(this.$el.find("ul.places li.selected a"),function(b){return{foursquare:a.places[$(b).attr("data-id")]}})},success:function(){204==this.code&&Nav.go("/thanks",
"slide",{after_transition:function(){App.loader_elmt&&(App.loader_elmt.remove(),App.loader_elmt=null)}})}})}});Views.define("thanks",{className:"complete",render:function(){this.$el.html($(Templates.thanks).html());this.$el.find("strong").html(App.meeting.user.name);return this}});
Behaviors.place_selector={initialize:function(){this.places={}},refresh_places:function(a,b){var c=this;b=b||{};var d=$('<span class="bjr_loader"><span></span></span>');d.css({position:"absolute",top:160,left:"50%","margin-left":-14});this.$el.find("ul.places").empty().before(d);App.get_position(function(d){var g={ll:d.latitude+","+d.longitude,v:"20130823",limit:200};c.position={lat:d.latitude,lng:d.longitude};App.foursquare_token?g.oauth_token=App.foursquare_token:(g.client_id=App.params.foursquare.client_id,
g.client_secret="CAHKQWBRYE3W33VLHFNLAUEEMZJ5H124JDCXSPZW0SUORM0P");a&&0<a.length&&(g.query=a);c.requests.push($.ajax({url:"https://api.foursquare.com/v2"+(b.api_path||"/venues/search"),data:g,dataType:"json",success:function(a){a.response.venues&&0<a.response.venues.length?c.run("display_places",[a.response.venues]):a.response.checkins&&0<a.response.checkins.items.length&&c.run("display_places",[$.map(a.response.checkins.items,function(a){return a.venue})])}}))})},close_selector:function(a){var b=
this.$el.find("form.status");b.css({position:"absolute",left:0,top:0,right:0}).show();a.css({position:"absolute"});Animation.move_element(a,{y:$(window).height(),end:function(){a.remove();b.css({position:"static"});Nav.run("resize");var c=$("#above p.foursquare_powered");c.animate({opacity:0},{complete:function(){c.remove()}})}})},display_places:function(a){for(var b=this.$el.find("ul.places"),c=this,d=0;d<a.length;d++){var e=$('<li><a href="#" data-id="'+a[d].id+'"></a></li>');e.find("a").append("<strong>"+
a[d].name+"</strong>").append("<span>"+this.behaviors.place_selector.foursquare_location(a[d])+"</span>");b.append(e);e.find("a").link({run:function(a){a.preventDefault();c.run("use_place",[this])}});this.places[a[d].id]=a[d]}Nav.run("resize")},foursquare_location:function(a){var b="";a.location.address&&(b+=a.location.address+", ");a.location.postalCode&&(b+=a.location.postalCode+" ");a.location.city&&(b+=a.location.city);return b}};
var Templates={complete:'<div class="complete invitation"><div class="message"><p><strong>{name}</strong> thanks you!</p><p>You\'re gonna receive news from him soon.</p></div><div class="info"><p class="recommend">Be nice to <strong>{name}</strong> and tell him places he shouldn\'t miss during his visit</p><p class="start"><a href="/recommend">Share some places</a></p></div></div>',decline:'<div class="complete"><div class="message"><p><strong>{name}</strong> will be missing you.</p><p>Too bad.</p></div></div>',
error:'<div><div class="complete"><div class="message"><p><strong>There was a problem</strong></p><p>This meeting doesn\'t exist or a problem occured.</p></div></div></div>',invitation:'<div class="invitation"><p class="title">Your friend <strong>{name}</strong> is visiting town and wants to meet you!</p><div class="info"><p class="location">{location}</p><p class="time"></p><p class="start green"><a href="/schedule">Let\'s meet him</a></p></div></div>',place:'<div class="schedule"><div class="title"><p>Suggest a nice place to meet</p><nav class="steps"><span class="done"></span><span class="done"></span><span class="on"></span></nav></div><div class="place"><div class="current_location"><p><a href="#">At my current location</a></p></div><form class="foursquare"><p class="search"><input name="q" placeholder="In a public location" type="search"/></p><p class="send"><input type="submit" value="Ok"/></p><ul class="places"></ul><p class="powered">Powered by Foursquare</p></form></div><div class="info"><p class="start"><a href="/place">Finish</a></p></div></div>',
place_selector:'<div class="place_selector"><h2>Select a place to meet</h2><form action="#" class="search" method="post"><p class="search"><input class="font-bold" name="q" placeholder="Search for a place" type="search"/></p><p class="submit"><input type="submit" value="Ok"/></p></form><ul class="places"></ul></div>',recommend:'<div class="schedule"><div class="title"><p>Tell <strong>{name}</strong> where to go</p></div><div class="place"><form class="foursquare"><p class="search"><input name="q" placeholder="In a public location" type="search"/></p><p class="send"><input type="submit" value="Ok"/></p><ul class="places"></ul><p class="powered">Powered by Foursquare</p></form></div><div class="info"><p class="start"><a href="">Send</a></p></div></div>',
schedule:'<div class="schedule"><div class="title"><p>When would you like to meet?</p><nav class="steps"><span class="done"></span><span class="on"></span><span></span></nav></div><div class="info"><div class="days"></div><p class="start"><a href="/place">Continue</a></p></div></div>',thanks:'<div class="complete invitation"><div class="message"><p><strong>{name}</strong> thanks you!</p><p>He\'s gonna enjoy his trip a bit more with your recommendations.</p></div><div class="info"><p class="bye">You can resume your activities now.</p></div></div>'};
