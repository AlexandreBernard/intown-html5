(function(b){String.prototype.trim===b&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});Array.prototype.reduce===b&&(Array.prototype.reduce=function(a){if(void 0===this||null===this)throw new TypeError;var h=Object(this),c=h.length>>>0,d=0,f;if("function"!=typeof a)throw new TypeError;if(0==c&&1==arguments.length)throw new TypeError;if(2<=arguments.length)f=arguments[1];else{do{if(d in h){f=h[d++];break}if(++d>=c)throw new TypeError;}while(1)}for(;d<c;)d in h&&
(f=a.call(b,f,h[d],d,h)),d++;return f})})();
var Zepto=function(){function b(e){return"[object Function]"=={}.toString.call(e)}function a(e){return e instanceof Object}function h(e){return e instanceof Array}function c(e){return"number"==typeof e.length}function d(e){return e.filter(function(e){return e!==w&&null!==e})}function f(e){return e.replace(/-+(.)?/g,function(e,a){return a?a.toUpperCase():""})}function l(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}
function p(e){return e.filter(function(e,a,g){return g.indexOf(e)==a})}function n(e){return e in B?B[e]:B[e]=RegExp("(^|\\s)"+e+"(\\s|$)")}function t(a,g){g===w&&y.test(a)&&RegExp.$1;g in e||(g="*");var b=e[g];b.innerHTML=""+a;return k.call(b.childNodes)}function r(e,a){e=e||x;e.__proto__=r.prototype;e.selector=a||"";return e}function m(e,a){if(!e)return r();if(a!==w)return m(a).find(e);if(b(e))return m(s).ready(e);if(e instanceof r)return e;var g;h(e)?g=d(e):0<=E.indexOf(e.nodeType)||e===window?
(g=[e],e=null):y.test(e)?(g=t(e.trim(),RegExp.$1),e=null):g=e.nodeType&&3==e.nodeType?[e]:D(s,e);return r(g,e)}function u(e,a){return a===w?m(e):m(e).filter(a)}function v(e,a,g,c){return b(a)?a.call(e,g,c):a}function q(e,a,g){var b=e%2?a:a.parentNode;b&&b.insertBefore(g,!e?a.nextSibling:1==e?b.firstChild:2==e?a:null)}function z(e,a){a(e);for(var g in e.childNodes)z(e.childNodes[g],a)}var w,A,D,C,x=[],k=x.slice,s=window.document,F={},B={},G=s.defaultView.getComputedStyle,g={"column-count":1,columns:1,
"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},y=/^\s*<(\w+)[^>]*>/,E=[1,9,11],H=s.createElement("table"),J=s.createElement("tr"),e={tr:s.createElement("tbody"),tbody:H,thead:H,tfoot:H,td:J,th:J,"*":s.createElement("div")},I=/complete|loaded|interactive/,K=/^\.([\w-]+)$/,L=/^#([\w-]+)$/,M=/^[\w-]+$/;m.extend=function(e){k.call(arguments,1).forEach(function(a){for(A in a)e[A]=a[A]});return e};m.qsa=D=function(e,a){var g;return e===s&&L.test(a)?(g=e.getElementById(RegExp.$1))?[g]:x:k.call(K.test(a)?
e.getElementsByClassName(RegExp.$1):M.test(a)?e.getElementsByTagName(a):e.querySelectorAll(a))};m.isFunction=b;m.isObject=a;m.isArray=h;m.map=function(e,a){var g,b=[],d;if(c(e))for(d=0;d<e.length;d++)g=a(e[d],d),null!=g&&b.push(g);else for(d in e)g=a(e[d],d),null!=g&&b.push(g);return 0<b.length?[].concat.apply([],b):b};m.each=function(e,a){var g;if(c(e))for(g=0;g<e.length&&!1!==a(g,e[g]);g++);else for(g in e)if(!1===a(g,e[g]))break;return e};m.fn={forEach:x.forEach,reduce:x.reduce,push:x.push,indexOf:x.indexOf,
concat:x.concat,map:function(e){return m.map(this,function(a,g){return e.call(a,g,a)})},slice:function(){return m(k.apply(this,arguments))},ready:function(e){I.test(s.readyState)?e(m):s.addEventListener("DOMContentLoaded",function(){e(m)},!1);return this},get:function(e){return e===w?this:this[e]},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){this.forEach(function(a,g){e.call(a,g,a)});
return this},filter:function(e){return m([].filter.call(this,function(a){return a.parentNode&&0<=D(a.parentNode,e).indexOf(a)}))},end:function(){return this.prevObject||m()},andSelf:function(){return this.add(this.prevObject||m())},add:function(e,a){return m(p(this.concat(m(e,a))))},is:function(e){return 0<this.length&&0<m(this[0]).filter(e).length},not:function(e){var a=[];if(b(e)&&e.call!==w)this.each(function(g){e.call(this,g)||a.push(this)});else{var g="string"==typeof e?this.filter(e):c(e)&&
b(e.item)?k.call(e):m(e);this.forEach(function(e){0>g.indexOf(e)&&a.push(e)})}return m(a)},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!a(e)?e:m(e)},last:function(){var e=this[this.length-1];return e&&!a(e)?e:m(e)},find:function(e){var a;a=1==this.length?D(this[0],e):this.map(function(){return D(this,e)});return m(a)},closest:function(e,a){var g=this[0],b=D(a||s,e);for(b.length||(g=null);g&&0>b.indexOf(g);)g=g!==a&&g!==s&&g.parentNode;return m(g)},
parents:function(e){for(var a=[],g=this;0<g.length;)g=m.map(g,function(e){if((e=e.parentNode)&&e!==s&&0>a.indexOf(e))return a.push(e),e});return u(a,e)},parent:function(e){return u(p(this.pluck("parentNode")),e)},children:function(e){return u(this.map(function(){return k.call(this.children)}),e)},siblings:function(e){return u(this.map(function(e,a){return k.call(a.parentNode.children).filter(function(e){return e!==a})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return this.map(function(){return this[e]})},
show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=null);if("none"==G(this,"").getPropertyValue("display")){var e=this.style,a=this.nodeName,g,b;F[a]||(g=s.createElement(a),s.body.appendChild(g),b=G(g,"").getPropertyValue("display"),g.parentNode.removeChild(g),"none"==b&&(b="block"),F[a]=b);e.display=F[a]}})},replaceWith:function(e){return this.each(function(){m(this).before(e).remove()})},wrap:function(e){return this.each(function(){m(this).wrapAll(m(e)[0].cloneNode(!1))})},
wrapAll:function(e){this[0]&&(m(this[0]).before(e=m(e)),e.append(this));return this},unwrap:function(){this.parent().each(function(){m(this).replaceWith(m(this).children())});return this},hide:function(){return this.css("display","none")},toggle:function(e){return(e===w?"none"==this.css("display"):e)?this.show():this.hide()},prev:function(){return m(this.pluck("previousElementSibling"))},next:function(){return m(this.pluck("nextElementSibling"))},html:function(e){return e===w?0<this.length?this[0].innerHTML:
null:this.each(function(a){var g=this.innerHTML;m(this).empty().append(v(this,e,a,g))})},text:function(e){return e===w?0<this.length?this[0].textContent:null:this.each(function(){this.textContent=e})},attr:function(e,g){var b;return"string"==typeof e&&g===w?0==this.length?w:"value"==e&&"INPUT"==this[0].nodeName?this.val():!(b=this[0].getAttribute(e))&&e in this[0]?this[0][e]:b:this.each(function(b){if(a(e))for(A in e)this.setAttribute(A,e[A]);else this.setAttribute(e,v(this,g,b,this.getAttribute(e)))})},
removeAttr:function(e){return this.each(function(){this.removeAttribute(e)})},data:function(e,a){return this.attr("data-"+e,a)},val:function(e){return e===w?0<this.length?this[0].value:null:this.each(function(a){this.value=v(this,e,a,this.value)})},offset:function(){if(0==this.length)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:e.width,height:e.height}},css:function(e,a){if(a===w&&"string"==typeof e)return 0==this.length?
w:this[0].style[f(e)]||G(this[0],"").getPropertyValue(e);var b="";for(A in e)b+=l(A)+":"+("number"==typeof e[A]&&!g[l(A)]?e[A]+"px":e[A])+";";"string"==typeof e&&(b=l(e)+":"+("number"==typeof a&&!g[l(e)]?a+"px":a));return this.each(function(){this.style.cssText+=";"+b})},index:function(e){return e?this.indexOf(m(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return 1>this.length?!1:n(e).test(this[0].className)},addClass:function(e){return this.each(function(a){C=[];var g=this.className;
v(this,e,a,g).split(/\s+/g).forEach(function(e){m(this).hasClass(e)||C.push(e)},this);C.length&&(this.className+=(g?" ":"")+C.join(" "))})},removeClass:function(e){return this.each(function(a){if(e===w)return this.className="";C=this.className;v(this,e,a,C).split(/\s+/g).forEach(function(e){C=C.replace(n(e)," ")});this.className=C.trim()})},toggleClass:function(e,a){return this.each(function(g){g=v(this,e,g,this.className);(a===w?!m(this).hasClass(g):a)?m(this).addClass(g):m(this).removeClass(g)})}};
"filter add not eq first last find closest parents parent children siblings".split(" ").forEach(function(e){var a=m.fn[e];m.fn[e]=function(){var e=a.apply(this,arguments);e.prevObject=this;return e}});["width","height"].forEach(function(e){m.fn[e]=function(a){var g,b=e.replace(/./,function(e){return e[0].toUpperCase()});return a===w?this[0]==window?window["inner"+b]:this[0]==s?s.documentElement["offset"+b]:(g=this.offset())&&g[e]:this.each(function(g){var b=m(this);b.css(e,v(this,a,g,b[e]()))})}});
["after","prepend","before","append"].forEach(function(e,g){m.fn[e]=function(e){var b=a(e)?e:t(e);if(!("length"in b)||b.nodeType)b=[b];if(1>b.length)return this;var c=this.length,d=1<c,y=2>g;return this.each(function(e,a){for(var I=0;I<b.length;I++){var f=b[y?b.length-I-1:I];z(f,function(e){null!=e.nodeName&&("SCRIPT"===e.nodeName.toUpperCase()&&(!e.type||"text/javascript"===e.type))&&window.eval.call(window,e.innerHTML)});d&&e<c-1&&(f=f.cloneNode(!0));q(g,a,f)}})};m.fn[g%2?e+"To":"insert"+(g?"Before":
"After")]=function(a){m(a)[e](this);return this}});r.prototype=m.fn;return m}();window.Zepto=Zepto;"$"in window||(window.$=Zepto);
(function(b){function a(a,b,c,d){b=h(b);if(b.ns)var f=RegExp("(?:^| )"+b.ns.replace(" "," .* ?")+"(?: |$)");return(n[a._zid||(a._zid=t++)]||[]).filter(function(a){return a&&(!b.e||a.e==b.e)&&(!b.ns||f.test(a.ns))&&(!c||a.fn==c)&&(!d||a.sel==d)})}function h(a){a=(""+a).split(".");return{e:a[0],ns:a.slice(1).sort().join(" ")}}function c(a,c,d){b.isObject(a)?b.each(a,d):a.split(/\s/).forEach(function(a){d(a,c)})}function d(a,d,f,l,p){var m=a._zid||(a._zid=t++),x=n[m]||(n[m]=[]);c(d,f,function(c,d){var f=
p&&p(d,c),w=f||d,z=function(g){var b=w.apply(a,[g].concat(g.data));!1===b&&g.preventDefault();return b},f=b.extend(h(c),{fn:d,proxy:z,sel:l,del:f,i:x.length});x.push(f);a.addEventListener(f.e,z,!1)})}function f(b,d,f,h){var l=b._zid||(b._zid=t++);c(d||"",f,function(c,d){a(b,c,d,h).forEach(function(a){delete n[l][a.i];b.removeEventListener(a.e,a.proxy,!1)})})}function l(a){var c=b.extend({originalEvent:a},a);b.each(v,function(b,d){c[b]=function(){this[d]=m;return a[b].apply(a,arguments)};c[d]=u});
return c}function p(a){if(!("defaultPrevented"in a)){a.defaultPrevented=!1;var b=a.preventDefault;a.preventDefault=function(){this.defaultPrevented=!0;b.call(this)}}}var n={},t=1,r={};r.click=r.mousedown=r.mouseup=r.mousemove="MouseEvents";b.event={add:d,remove:f};b.fn.bind=function(a,b){return this.each(function(){d(this,a,b)})};b.fn.unbind=function(a,b){return this.each(function(){f(this,a,b)})};b.fn.one=function(a,b){return this.each(function(c,h){d(this,a,b,null,function(a,b){return function(){var c=
a.apply(h,arguments);f(h,b,a);return c}})})};var m=function(){return!0},u=function(){return!1},v={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};b.fn.delegate=function(a,c,f){return this.each(function(h,p){d(p,c,f,a,function(c){return function(d){var f,h=b(d.target).closest(a,p).get(0);if(h)return f=b.extend(l(d),{currentTarget:h,liveFired:p}),c.apply(h,[f].concat([].slice.call(arguments,1)))}})})};b.fn.undelegate=
function(a,b,c){return this.each(function(){f(this,b,c,a)})};b.fn.live=function(a,c){b(document.body).delegate(this.selector,a,c);return this};b.fn.die=function(a,c){b(document.body).undelegate(this.selector,a,c);return this};b.fn.on=function(a,c,d){return void 0===c||b.isFunction(c)?this.bind(a,c):this.delegate(c,a,d)};b.fn.off=function(a,c,d){return void 0===c||b.isFunction(c)?this.unbind(a,c):this.undelegate(c,a,d)};b.fn.trigger=function(a,c){"string"==typeof a&&(a=b.Event(a));p(a);a.data=c;return this.each(function(){this.dispatchEvent(a)})};
b.fn.triggerHandler=function(c,d){var f,h;this.each(function(p,m){f=l("string"==typeof c?b.Event(c):c);f.data=d;f.target=m;b.each(a(m,c.type||c),function(a,b){h=b.proxy(f);if(f.isImmediatePropagationStopped())return!1})});return h};"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(a){b.fn[a]=function(b){return this.bind(a,b)}});["focus","blur"].forEach(function(a){b.fn[a]=
function(b){if(b)this.bind(a,b);else if(this.length)try{this.get(0)[a]()}catch(c){}return this}});b.Event=function(a,b){var c=document.createEvent(r[a]||"Events"),d=!0;if(b)for(var f in b)"bubbles"==f?d=!!b[f]:c[f]=b[f];c.initEvent(a,d,!0,null,null,null,null,null,null,null,null,null,null,null,null);return c}})(Zepto);
(function(b){function a(a){var b=this.os={},d=this.browser={},f=a.match(/WebKit\/([\d.]+)/),l=a.match(/(Android)\s+([\d.]+)/),p=a.match(/(iPad).*OS\s([\d_]+)/),n=!p&&a.match(/(iPhone\sOS)\s([\d_]+)/),t=a.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),r=t&&a.match(/TouchPad/);a=a.match(/(BlackBerry).*Version\/([\d.]+)/);f&&(d.version=f[1]);d.webkit=!!f;l&&(b.android=!0,b.version=l[2]);n&&(b.ios=!0,b.version=n[2].replace(/_/g,"."),b.iphone=!0);p&&(b.ios=!0,b.version=p[2].replace(/_/g,"."),b.ipad=!0);t&&(b.webos=
!0,b.version=t[2]);r&&(b.touchpad=!0);a&&(b.blackberry=!0,b.version=a[2])}a.call(b,navigator.userAgent);b.__detect=a})(Zepto);
(function(b,a){var h="",c,d=window.document.createElement("div"),f=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;b.each({Webkit:"webkit",Moz:"",O:"o",ms:"MS"},function(b,f){if(d.style[b+"TransitionProperty"]!==a)return h="-"+b.toLowerCase()+"-",c=f,!1});b.fx={off:c===a&&d.style.transitionProperty===a,cssPrefix:h,transitionEnd:c?c+"TransitionEnd":"transitionend",animationEnd:c?c+"AnimationEnd":"animationend"};b.fn.animate=function(a,c,d,f){b.isObject(c)&&(d=c.easing,
f=c.complete,c=c.duration);c&&(c/=1E3);return this.anim(a,c,d,f)};b.fn.anim=function(c,d,n,t){var r,m={},u,v=this,q,z=b.fx.transitionEnd;d===a&&(d=0.4);b.fx.off&&(d=0);if("string"==typeof c)m[h+"animation-name"]=c,m[h+"animation-duration"]=d+"s",z=b.fx.animationEnd;else{for(u in c)f.test(u)?(r||(r=[]),r.push(u+"("+c[u]+")")):m[u]=c[u];r&&(m[h+"transform"]=r.join(" "));b.fx.off||(m[h+"transition"]="all "+d+"s "+(n||""))}q=function(){var a={};a[h+"transition"]=a[h+"animation-name"]="none";b(this).css(a);
t&&t.call(this)};if(0<d)this.one(z,q);setTimeout(function(){v.css(m);0>=d&&setTimeout(function(){v.each(function(){q.call(this)})},0)},0);return this};d=null})(Zepto);
(function(b){function a(a,c,d,f){if(a.global)return a=c||m,d=b.Event(d),b(a).trigger(d,f),!d.defaultPrevented}function h(c){c.global&&0===b.active++&&a(c,null,"ajaxStart")}function c(b,c){var d=c.context;if(!1===c.beforeSend.call(d,b,c)||!1===a(c,d,"ajaxBeforeSend",[b,c]))return!1;a(c,d,"ajaxSend",[b,c])}function d(b,c,d){var f=d.context;d.success.call(f,b,"success",c);a(d,f,"ajaxSuccess",[c,d,b]);l("success",c,d)}function f(b,c,d,f){var h=f.context;f.error.call(h,d,c,b);a(f,h,"ajaxError",[d,f,b]);
l(c,d,f)}function l(c,d,f){var h=f.context;f.complete.call(h,d,c);a(f,h,"ajaxComplete",[d,f]);f.global&&!--b.active&&a(f,null,"ajaxStop")}function p(){}function n(a,c,d,f){var h=b.isArray(c);b.each(c,function(c,k){f&&(c=d?f:f+"["+(h?"":c)+"]");!f&&h?a.add(k.name,k.value):(d?b.isArray(k):r(k))?n(a,k,d,c):a.add(c,k)})}var t=0,r=b.isObject,m=window.document,u,v;b.active=0;b.ajaxJSONP=function(a){var c="jsonp"+ ++t,f=m.createElement("script"),h={abort:function(){b(f).remove();c in window&&(window[c]=
p);l(h,a,"abort")}},n;window[c]=function(l){clearTimeout(n);b(f).remove();delete window[c];d(l,h,a)};f.src=a.url.replace(/=\?/,"="+c);b("head").append(f);0<a.timeout&&(n=setTimeout(function(){h.abort();l(h,a,"timeout")},a.timeout));return h};b.ajaxSettings={type:"GET",beforeSend:p,success:p,error:p,complete:p,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",
text:"text/plain"},crossDomain:!1,timeout:0};b.ajax=function(a){var l=b.extend({},a||{});for(u in b.ajaxSettings)void 0===l[u]&&(l[u]=b.ajaxSettings[u]);h(l);l.crossDomain||(l.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(l.url)&&RegExp.$2!=window.location.host);if(/=\?/.test(l.url))return b.ajaxJSONP(l);l.url||(l.url=window.location.toString());l.data&&!l.contentType&&(l.contentType="application/x-www-form-urlencoded");r(l.data)&&(l.data=b.param(l.data));l.type.match(/get/i)&&l.data&&(a=l.data,l.url.match(/\?.*=/)?
a="&"+a:"?"!=a[0]&&(a="?"+a),l.url+=a);var m=l.accepts[l.dataType];a={};var n=/^([\w-]+:)\/\//.test(l.url)?RegExp.$1:window.location.protocol,q=b.ajaxSettings.xhr(),x;l.crossDomain||(a["X-Requested-With"]="XMLHttpRequest");m&&(a.Accept=m);l.headers=b.extend(a,l.headers||{});q.onreadystatechange=function(){if(4==q.readyState){clearTimeout(x);var a,b=!1;if(200<=q.status&&300>q.status||0==q.status&&"file:"==n){if("application/json"==m&&!/^\s*$/.test(q.responseText))try{a=JSON.parse(q.responseText)}catch(c){b=
c}else a=q.responseText;b?f(b,"parsererror",q,l):d(a,q,l)}else f(null,"error",q,l)}};q.open(l.type,l.url,!0);l.contentType&&(l.headers["Content-Type"]=l.contentType);for(v in l.headers)q.setRequestHeader(v,l.headers[v]);if(!1===c(q,l))return q.abort(),!1;0<l.timeout&&(x=setTimeout(function(){q.onreadystatechange=p;q.abort();f(null,"timeout",q,l)},l.timeout));q.send(l.data);return q};b.get=function(a,c){return b.ajax({url:a,success:c})};b.post=function(a,c,d,f){b.isFunction(c)&&(f=f||d,d=c,c=null);
return b.ajax({type:"POST",url:a,data:c,success:d,dataType:f})};b.getJSON=function(a,c){return b.ajax({url:a,success:c,dataType:"json"})};b.fn.load=function(a,c){if(!this.length)return this;var d=this,f=a.split(/\s/),h;1<f.length&&(a=f[0],h=f[1]);b.get(a,function(a){d.html(h?b(m.createElement("div")).html(a).find(h).html():a);c&&c.call(d)});return this};var q=encodeURIComponent;b.param=function(a,b){var c=[];c.add=function(a,b){this.push(q(a)+"="+q(b))};n(c,a,b);return c.join("&").replace("%20","+")}})(Zepto);
(function(b){b.fn.serializeArray=function(){var a=[],h;b(Array.prototype.slice.call(this.get(0).elements)).each(function(){h=b(this);var c=h.attr("type");!this.disabled&&("submit"!=c&&"reset"!=c&&"button"!=c&&("radio"!=c&&"checkbox"!=c||this.checked))&&a.push({name:h.attr("name"),value:h.val()})});return a};b.fn.serialize=function(){var a=[];this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))});return a.join("&")};b.fn.submit=function(a){a?
this.bind("submit",a):this.length&&(a=b.Event("submit"),this.eq(0).trigger(a),a.defaultPrevented||this.get(0).submit());return this}})(Zepto);
(function(b){function a(a,b,c,d){var f=Math.abs(a-b),h=Math.abs(c-d);return f>=h?0<a-b?"Left":"Right":0<c-d?"Up":"Down"}function h(){c.last&&Date.now()-c.last>=f&&(b(c.target).trigger("longTap"),c={})}var c={},d,f=750;b(document).ready(function(){b(document.body).bind("touchstart",function(a){var b=Date.now(),n=b-(c.last||b);c.target="tagName"in a.touches[0].target?a.touches[0].target:a.touches[0].target.parentNode;d&&clearTimeout(d);c.x1=a.touches[0].pageX;c.y1=a.touches[0].pageY;0<n&&250>=n&&(c.isDoubleTap=
!0);c.last=b;setTimeout(h,f)}).bind("touchmove",function(a){c.x2=a.touches[0].pageX;c.y2=a.touches[0].pageY}).bind("touchend",function(f){c.isDoubleTap?(b(c.target).trigger("doubleTap"),c={}):0<c.x2||0<c.y2?((30<Math.abs(c.x1-c.x2)||30<Math.abs(c.y1-c.y2))&&b(c.target).trigger("swipe")&&b(c.target).trigger("swipe"+a(c.x1,c.x2,c.y1,c.y2)),c.x1=c.x2=c.y1=c.y2=c.last=0):"last"in c&&(d=setTimeout(function(){d=null;b(c.target).trigger("tap");c={}},250))}).bind("touchcancel",function(){c={}})});"swipe swipeLeft swipeRight swipeUp swipeDown doubleTap tap longTap".split(" ").forEach(function(a){b.fn[a]=
function(b){return this.bind(a,b)}})})(Zepto);
(function(){function b(a,g,c){if(a===g)return 0!==a||1/a==1/g;if(null==a||null==g)return a===g;a._chain&&(a=a._wrapped);g._chain&&(g=g._wrapped);if(a.isEqual&&k.isFunction(a.isEqual))return a.isEqual(g);if(g.isEqual&&k.isFunction(g.isEqual))return g.isEqual(a);var d=n.call(a);if(d!=n.call(g))return!1;switch(d){case "[object String]":return a==String(g);case "[object Number]":return a!=+a?g!=+g:0==a?1/a==1/g:a==+g;case "[object Date]":case "[object Boolean]":return+a==+g;case "[object RegExp]":return a.source==
g.source&&a.global==g.global&&a.multiline==g.multiline&&a.ignoreCase==g.ignoreCase}if("object"!=typeof a||"object"!=typeof g)return!1;for(var f=c.length;f--;)if(c[f]==a)return!0;c.push(a);var f=0,y=!0;if("[object Array]"==d){if(f=a.length,y=f==g.length)for(;f--&&(y=f in a==f in g&&b(a[f],g[f],c)););}else{if("constructor"in a!="constructor"in g||a.constructor!=g.constructor)return!1;for(var h in a)if(k.has(a,h)&&(f++,!(y=k.has(g,h)&&b(a[h],g[h],c))))break;if(y){for(h in g)if(k.has(g,h)&&!f--)break;
y=!f}}c.pop();return y}var a=this,h=a._,c={},d=Array.prototype,f=Object.prototype,l=d.slice,p=d.unshift,n=f.toString,t=f.hasOwnProperty,r=d.forEach,m=d.map,u=d.reduce,v=d.reduceRight,q=d.filter,z=d.every,w=d.some,A=d.indexOf,D=d.lastIndexOf,f=Array.isArray,C=Object.keys,x=Function.prototype.bind,k=function(a){return new E(a)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=k),exports._=k):a._=k;k.VERSION="1.3.1";var s=k.each=k.forEach=function(a,
b,g){if(null!=a)if(r&&a.forEach===r)a.forEach(b,g);else if(a.length===+a.length)for(var d=0,f=a.length;d<f&&!(d in a&&b.call(g,a[d],d,a)===c);d++);else for(d in a)if(k.has(a,d)&&b.call(g,a[d],d,a)===c)break};k.map=k.collect=function(a,b,g){var c=[];if(null==a)return c;if(m&&a.map===m)return a.map(b,g);s(a,function(a,e,d){c[c.length]=b.call(g,a,e,d)});a.length===+a.length&&(c.length=a.length);return c};k.reduce=k.foldl=k.inject=function(a,b,g,c){var d=2<arguments.length;null==a&&(a=[]);if(u&&a.reduce===
u)return c&&(b=k.bind(b,c)),d?a.reduce(b,g):a.reduce(b);s(a,function(a,e,f){d?g=b.call(c,g,a,e,f):(g=a,d=!0)});if(!d)throw new TypeError("Reduce of empty array with no initial value");return g};k.reduceRight=k.foldr=function(a,b,g,c){var d=2<arguments.length;null==a&&(a=[]);if(v&&a.reduceRight===v)return c&&(b=k.bind(b,c)),d?a.reduceRight(b,g):a.reduceRight(b);var f=k.toArray(a).reverse();c&&!d&&(b=k.bind(b,c));return d?k.reduce(f,b,g,c):k.reduce(f,b)};k.find=k.detect=function(a,b,g){var c;F(a,function(a,
e,d){if(b.call(g,a,e,d))return c=a,!0});return c};k.filter=k.select=function(a,b,g){var c=[];if(null==a)return c;if(q&&a.filter===q)return a.filter(b,g);s(a,function(a,e,d){b.call(g,a,e,d)&&(c[c.length]=a)});return c};k.reject=function(a,b,g){var c=[];if(null==a)return c;s(a,function(a,e,d){b.call(g,a,e,d)||(c[c.length]=a)});return c};k.every=k.all=function(a,b,g){var d=!0;if(null==a)return d;if(z&&a.every===z)return a.every(b,g);s(a,function(a,e,f){if(!(d=d&&b.call(g,a,e,f)))return c});return d};
var F=k.some=k.any=function(a,b,g){b||(b=k.identity);var d=!1;if(null==a)return d;if(w&&a.some===w)return a.some(b,g);s(a,function(a,e,f){if(d||(d=b.call(g,a,e,f)))return c});return!!d};k.include=k.contains=function(a,b){var g=!1;return null==a?g:A&&a.indexOf===A?-1!=a.indexOf(b):g=F(a,function(a){return a===b})};k.invoke=function(a,b){var g=l.call(arguments,2);return k.map(a,function(a){return(k.isFunction(b)?b||a:a[b]).apply(a,g)})};k.pluck=function(a,b){return k.map(a,function(a){return a[b]})};
k.max=function(a,b,g){if(!b&&k.isArray(a))return Math.max.apply(Math,a);if(!b&&k.isEmpty(a))return-Infinity;var c={computed:-Infinity};s(a,function(a,e,d){e=b?b.call(g,a,e,d):a;e>=c.computed&&(c={value:a,computed:e})});return c.value};k.min=function(a,b,g){if(!b&&k.isArray(a))return Math.min.apply(Math,a);if(!b&&k.isEmpty(a))return Infinity;var c={computed:Infinity};s(a,function(a,e,d){e=b?b.call(g,a,e,d):a;e<c.computed&&(c={value:a,computed:e})});return c.value};k.shuffle=function(a){var b=[],g;
s(a,function(a,e,c){0==e?b[0]=a:(g=Math.floor(Math.random()*(e+1)),b[e]=b[g],b[g]=a)});return b};k.sortBy=function(a,b,g){return k.pluck(k.map(a,function(a,e,c){return{value:a,criteria:b.call(g,a,e,c)}}).sort(function(a,e){var b=a.criteria,g=e.criteria;return b<g?-1:b>g?1:0}),"value")};k.groupBy=function(a,b){var g={},c=k.isFunction(b)?b:function(a){return a[b]};s(a,function(a,b){var e=c(a,b);(g[e]||(g[e]=[])).push(a)});return g};k.sortedIndex=function(a,b,g){g||(g=k.identity);for(var c=0,d=a.length;c<
d;){var f=c+d>>1;g(a[f])<g(b)?c=f+1:d=f}return c};k.toArray=function(a){return!a?[]:a.toArray?a.toArray():k.isArray(a)||k.isArguments(a)?l.call(a):k.values(a)};k.size=function(a){return k.toArray(a).length};k.first=k.head=function(a,b,g){return null!=b&&!g?l.call(a,0,b):a[0]};k.initial=function(a,b,g){return l.call(a,0,a.length-(null==b||g?1:b))};k.last=function(a,b,g){return null!=b&&!g?l.call(a,Math.max(a.length-b,0)):a[a.length-1]};k.rest=k.tail=function(a,b,g){return l.call(a,null==b||g?1:b)};
k.compact=function(a){return k.filter(a,function(a){return!!a})};k.flatten=function(a,b){return k.reduce(a,function(a,g){if(k.isArray(g))return a.concat(b?g:k.flatten(g));a[a.length]=g;return a},[])};k.without=function(a){return k.difference(a,l.call(arguments,1))};k.uniq=k.unique=function(a,b,g){g=g?k.map(a,g):a;var c=[];k.reduce(g,function(g,d,f){if(0==f||(!0===b?k.last(g)!=d:!k.include(g,d)))g[g.length]=d,c[c.length]=a[f];return g},[]);return c};k.union=function(){return k.uniq(k.flatten(arguments,
!0))};k.intersection=k.intersect=function(a){var b=l.call(arguments,1);return k.filter(k.uniq(a),function(a){return k.every(b,function(b){return 0<=k.indexOf(b,a)})})};k.difference=function(a){var b=k.flatten(l.call(arguments,1));return k.filter(a,function(a){return!k.include(b,a)})};k.zip=function(){for(var a=l.call(arguments),b=k.max(k.pluck(a,"length")),g=Array(b),c=0;c<b;c++)g[c]=k.pluck(a,""+c);return g};k.indexOf=function(a,b,g){if(null==a)return-1;var c;if(g)return g=k.sortedIndex(a,b),a[g]===
b?g:-1;if(A&&a.indexOf===A)return a.indexOf(b);g=0;for(c=a.length;g<c;g++)if(g in a&&a[g]===b)return g;return-1};k.lastIndexOf=function(a,b){if(null==a)return-1;if(D&&a.lastIndexOf===D)return a.lastIndexOf(b);for(var g=a.length;g--;)if(g in a&&a[g]===b)return g;return-1};k.range=function(a,b,g){1>=arguments.length&&(b=a||0,a=0);g=arguments[2]||1;for(var c=Math.max(Math.ceil((b-a)/g),0),d=0,f=Array(c);d<c;)f[d++]=a,a+=g;return f};var B=function(){};k.bind=function(a,b){var g,c;if(a.bind===x&&x)return x.apply(a,
l.call(arguments,1));if(!k.isFunction(a))throw new TypeError;c=l.call(arguments,2);return g=function(){if(!(this instanceof g))return a.apply(b,c.concat(l.call(arguments)));B.prototype=a.prototype;var d=new B,f=a.apply(d,c.concat(l.call(arguments)));return Object(f)===f?f:d}};k.bindAll=function(a){var b=l.call(arguments,1);0==b.length&&(b=k.functions(a));s(b,function(b){a[b]=k.bind(a[b],a)});return a};k.memoize=function(a,b){var g={};b||(b=k.identity);return function(){var c=b.apply(this,arguments);
return k.has(g,c)?g[c]:g[c]=a.apply(this,arguments)}};k.delay=function(a,b){var g=l.call(arguments,2);return setTimeout(function(){return a.apply(a,g)},b)};k.defer=function(a){return k.delay.apply(k,[a,1].concat(l.call(arguments,1)))};k.throttle=function(a,b){var g,c,d,f,y,h=k.debounce(function(){y=f=!1},b);return function(){g=this;c=arguments;d||(d=setTimeout(function(){d=null;y&&a.apply(g,c);h()},b));f?y=!0:a.apply(g,c);h();f=!0}};k.debounce=function(a,b){var g;return function(){var c=this,d=arguments;
clearTimeout(g);g=setTimeout(function(){g=null;a.apply(c,d)},b)}};k.once=function(a){var b=!1,g;return function(){if(b)return g;b=!0;return g=a.apply(this,arguments)}};k.wrap=function(a,b){return function(){var g=[a].concat(l.call(arguments,0));return b.apply(this,g)}};k.compose=function(){var a=arguments;return function(){for(var b=arguments,g=a.length-1;0<=g;g--)b=[a[g].apply(this,b)];return b[0]}};k.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};k.keys=
C||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],g;for(g in a)k.has(a,g)&&(b[b.length]=g);return b};k.values=function(a){return k.map(a,k.identity)};k.functions=k.methods=function(a){var b=[],g;for(g in a)k.isFunction(a[g])&&b.push(g);return b.sort()};k.extend=function(a){s(l.call(arguments,1),function(b){for(var g in b)a[g]=b[g]});return a};k.defaults=function(a){s(l.call(arguments,1),function(b){for(var g in b)null==a[g]&&(a[g]=b[g])});return a};k.clone=function(a){return!k.isObject(a)?
a:k.isArray(a)?a.slice():k.extend({},a)};k.tap=function(a,b){b(a);return a};k.isEqual=function(a,g){return b(a,g,[])};k.isEmpty=function(a){if(k.isArray(a)||k.isString(a))return 0===a.length;for(var b in a)if(k.has(a,b))return!1;return!0};k.isElement=function(a){return!!(a&&1==a.nodeType)};k.isArray=f||function(a){return"[object Array]"==n.call(a)};k.isObject=function(a){return a===Object(a)};k.isArguments=function(a){return"[object Arguments]"==n.call(a)};k.isArguments(arguments)||(k.isArguments=
function(a){return!(!a||!k.has(a,"callee"))});k.isFunction=function(a){return"[object Function]"==n.call(a)};k.isString=function(a){return"[object String]"==n.call(a)};k.isNumber=function(a){return"[object Number]"==n.call(a)};k.isNaN=function(a){return a!==a};k.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==n.call(a)};k.isDate=function(a){return"[object Date]"==n.call(a)};k.isRegExp=function(a){return"[object RegExp]"==n.call(a)};k.isNull=function(a){return null===a};k.isUndefined=
function(a){return void 0===a};k.has=function(a,b){return t.call(a,b)};k.noConflict=function(){a._=h;return this};k.identity=function(a){return a};k.times=function(a,b,g){for(var c=0;c<a;c++)b.call(g,c)};k.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};k.mixin=function(a){s(k.functions(a),function(b){J(b,k[b]=a[b])})};var G=0;k.uniqueId=function(a){var b=G++;return a?a+b:b};k.templateSettings=
{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var g=/.^/,y=function(a){return a.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};k.template=function(a,b){var c=k.templateSettings,c="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.escape||g,function(a,b){return"',_.escape("+y(b)+"),'"}).replace(c.interpolate||g,function(a,b){return"',"+y(b)+",'"}).replace(c.evaluate||g,function(a,
b){return"');"+y(b).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",d=new Function("obj","_",c);return b?d(b,k):function(a){return d.call(this,a,k)}};k.chain=function(a){return k(a).chain()};var E=function(a){this._wrapped=a};k.prototype=E.prototype;var H=function(a,b){return b?k(a).chain():a},J=function(a,b){E.prototype[a]=function(){var a=l.call(arguments);p.call(a,this._wrapped);return H(b.apply(k,a),this._chain)}};
k.mixin(k);s("pop push reverse shift sort splice unshift".split(" "),function(a){var b=d[a];E.prototype[a]=function(){var g=this._wrapped;b.apply(g,arguments);var c=g.length;("shift"==a||"splice"==a)&&0===c&&delete g[0];return H(g,this._chain)}});s(["concat","join","slice"],function(a){var b=d[a];E.prototype[a]=function(){return H(b.apply(this._wrapped,arguments),this._chain)}});E.prototype.chain=function(){this._chain=!0;return this};E.prototype.value=function(){return this._wrapped}}).call(this);
(function(){var b=this,a=b.Backbone,h=Array.prototype.slice,c=Array.prototype.splice,d;d="undefined"!==typeof exports?exports:b.Backbone={};d.VERSION="0.9.2";var f=b._;!f&&"undefined"!==typeof require&&(f=require("underscore"));var l=b.jQuery||b.Zepto||b.ender;d.setDomLibrary=function(a){l=a};d.noConflict=function(){b.Backbone=a;return this};d.emulateHTTP=!1;d.emulateJSON=!1;var p=/\s+/,n=d.Events={on:function(a,b,c){var d,f,e,k,h;if(!b)return this;a=a.split(p);for(d=this._callbacks||(this._callbacks=
{});f=a.shift();)e=(h=d[f])?h.tail:{},e.next=k={},e.context=c,e.callback=b,d[f]={tail:k,next:h?h.next:e};return this},off:function(a,b,c){var d,h,e,k,l,m;if(h=this._callbacks){if(!a&&!b&&!c)return delete this._callbacks,this;for(a=a?a.split(p):f.keys(h);d=a.shift();)if(e=h[d],delete h[d],e&&(b||c))for(k=e.tail;(e=e.next)!==k;)if(l=e.callback,m=e.context,b&&l!==b||c&&m!==c)this.on(d,l,m);return this}},trigger:function(a){var b,c,d,f,e,k;if(!(d=this._callbacks))return this;e=d.all;a=a.split(p);for(k=
h.call(arguments,1);b=a.shift();){if(c=d[b])for(f=c.tail;(c=c.next)!==f;)c.callback.apply(c.context||this,k);if(c=e){f=c.tail;for(b=[b].concat(k);(c=c.next)!==f;)c.callback.apply(c.context||this,b)}}return this}};n.bind=n.on;n.unbind=n.off;var t=d.Model=function(a,b){var c;a||(a={});b&&b.parse&&(a=this.parse(a));if(c=B(this,"defaults"))a=f.extend({},c,a);b&&b.collection&&(this.collection=b.collection);this.attributes={};this._escapedAttributes={};this.cid=f.uniqueId("c");this.changed={};this._silent=
{};this._pending={};this.set(a,{silent:!0});this.changed={};this._silent={};this._pending={};this._previousAttributes=f.clone(this.attributes);this.initialize.apply(this,arguments)};f.extend(t.prototype,n,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return f.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;b=this.get(a);return this._escapedAttributes[a]=f.escape(null==
b?"":""+b)},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,k;f.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b);c||(c={});if(!d)return this;d instanceof t&&(d=d.attributes);if(c.unset)for(k in d)d[k]=void 0;if(!this._validate(d,c))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);b=c.changes={};var e=this.attributes,h=this._escapedAttributes,l=this._previousAttributes||{};for(k in d){a=d[k];if(!f.isEqual(e[k],a)||c.unset&&f.has(e,k))delete h[k],(c.silent?this._silent:
b)[k]=!0;c.unset?delete e[k]:e[k]=a;!f.isEqual(l[k],a)||f.has(e,k)!=f.has(l,k)?(this.changed[k]=a,c.silent||(this._pending[k]=!0)):(delete this.changed[k],delete this._pending[k])}c.silent||this.change(c);return this},unset:function(a,b){(b||(b={})).unset=!0;return this.set(a,null,b)},clear:function(a){(a||(a={})).unset=!0;return this.set(f.clone(this.attributes),a)},fetch:function(a){a=a?f.clone(a):{};var b=this,c=a.success;a.success=function(d,f,e){if(!b.set(b.parse(d,e),a))return!1;c&&c(b,d)};
a.error=d.wrapError(a.error,b,a);return(this.sync||d.sync).call(this,"read",this,a)},save:function(a,b,c){var k,h;f.isObject(a)||null==a?(k=a,c=b):(k={},k[a]=b);c=c?f.clone(c):{};if(c.wait){if(!this._validate(k,c))return!1;h=f.clone(this.attributes)}a=f.extend({},c,{silent:!0});if(k&&!this.set(k,c.wait?a:c))return!1;var e=this,l=c.success;c.success=function(a,b,g){b=e.parse(a,g);c.wait&&(delete c.wait,b=f.extend(k||{},b));if(!e.set(b,c))return!1;l?l(e,a):e.trigger("sync",e,a,c)};c.error=d.wrapError(c.error,
e,c);b=this.isNew()?"create":"update";b=(this.sync||d.sync).call(this,b,this,c);c.wait&&this.set(h,a);return b},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,k=function(){b.trigger("destroy",b,b.collection,a)};if(this.isNew())return k(),!1;a.success=function(d){a.wait&&k();c?c(b,d):b.trigger("sync",b,d,a)};a.error=d.wrapError(a.error,b,a);var h=(this.sync||d.sync).call(this,"delete",this,a);a.wait||k();return h},url:function(){var a=B(this,"urlRoot")||B(this.collection,"url")||G();
return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var c in this._silent)this._pending[c]=!0;var d=f.extend({},a.changes,this._silent);this._silent={};for(c in d)this.trigger("change:"+c,this,this.get(c),a);if(b)return this;for(;!f.isEmpty(this._pending);){this._pending=
{};this.trigger("change",this,a);for(c in this.changed)!this._pending[c]&&!this._silent[c]&&delete this.changed[c];this._previousAttributes=f.clone(this.attributes)}this._changing=!1;return this},hasChanged:function(a){return!arguments.length?!f.isEmpty(this.changed):f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._previousAttributes,k;for(k in a)if(!f.isEqual(d[k],b=a[k]))(c||(c={}))[k]=b;return c},previous:function(a){return!arguments.length||
!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return f.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validate(a,b);if(!c)return!0;b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b);return!1}});var r=d.Collection=function(a,b){b||(b={});b.model&&(this.model=b.model);b.comparator&&(this.comparator=b.comparator);
this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,{silent:!0,parse:b.parse})};f.extend(r.prototype,n,{model:t,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){var d,k,h,e,l,m={},q={},p=[];b||(b={});a=f.isArray(a)?a.slice():[a];d=0;for(k=a.length;d<k;d++){if(!(h=a[d]=this._prepareModel(a[d],b)))throw Error("Can't add an invalid model to a collection");e=h.cid;l=h.id;m[e]||this._byCid[e]||null!=l&&(q[l]||this._byId[l])?
p.push(d):m[e]=q[l]=h}for(d=p.length;d--;)a.splice(p[d],1);d=0;for(k=a.length;d<k;d++)(h=a[d]).on("all",this._onModelEvent,this),this._byCid[h.cid]=h,null!=h.id&&(this._byId[h.id]=h);this.length+=k;c.apply(this.models,[null!=b.at?b.at:this.models.length,0].concat(a));this.comparator&&this.sort({silent:!0});if(b.silent)return this;d=0;for(k=this.models.length;d<k;d++)if(m[(h=this.models[d]).cid])b.index=d,h.trigger("add",h,this,b);return this},remove:function(a,b){var c,d,k,e;b||(b={});a=f.isArray(a)?
a.slice():[a];c=0;for(d=a.length;c<d;c++)if(e=this.getByCid(a[c])||this.get(a[c]))delete this._byId[e.id],delete this._byCid[e.cid],k=this.indexOf(e),this.models.splice(k,1),this.length--,b.silent||(b.index=k,e.trigger("remove",e,this,b)),this._removeReference(e);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,b);return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,f.extend({at:0},b));return a},
shift:function(a){var b=this.at(0);this.remove(b,a);return b},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return f.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var b=f.bind(this.comparator,this);1==this.comparator.length?
this.models=this.sortBy(b):this.models.sort(b);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return f.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);this._reset();this.add(a,f.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a=a?f.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(d,
f,e){b[a.add?"add":"reset"](b.parse(d,e),a);c&&c(b,d)};a.error=d.wrapError(a.error,b,a);return(this.sync||d.sync).call(this,"read",this,a)},create:function(a,b){var c=this;b=b?f.clone(b):{};a=this._prepareModel(a,b);if(!a)return!1;b.wait||c.add(a,b);var d=b.success;b.success=function(f,e,k){b.wait&&c.add(f,b);d?d(f,e):f.trigger("sync",a,e,b)};a.save(null,b);return a},parse:function(a,b){return a},chain:function(){return f(this.models).chain()},_reset:function(a){this.length=0;this.models=[];this._byId=
{};this._byCid={}},_prepareModel:function(a,b){b||(b={});a instanceof t?a.collection||(a.collection=this):(b.collection=this,a=new this.model(a,b),a._validate(a.attributes,b)||(a=!1));return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,
arguments))}});f.each("forEach each map reduce reduceRight find detect filter select reject every all some any include contains invoke max min sortBy sortedIndex toArray size first initial rest last without indexOf shuffle lastIndexOf isEmpty groupBy".split(" "),function(a){r.prototype[a]=function(){return f[a].apply(f,[this.models].concat(f.toArray(arguments)))}});var m=d.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},u=/:\w+/g,
v=/\*\w+/g,q=/[-[\]{}()+?.,\\^$|#\s]/g;f.extend(m.prototype,n,{initialize:function(){},route:function(a,b,c){d.history||(d.history=new z);f.isRegExp(a)||(a=this._routeToRegExp(a));c||(c=this[b]);d.history.route(a,f.bind(function(f){f=this._extractParameters(a,f);c&&c.apply(this,f);this.trigger.apply(this,["route:"+b].concat(f));d.history.trigger("route",this,b,f)},this));return this},navigate:function(a,b){d.history.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,
this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(q,"\\$&").replace(u,"([^/]+)").replace(v,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var z=d.History=function(){this.handlers=[];f.bindAll(this,"checkUrl")},w=/^[#\/]/,A=/msie [\w.]+/;z.started=!1;f.extend(z.prototype,n,{interval:50,getHash:function(a){return(a=(a?a.location:window.location).href.match(/#(.*)$/))?a[1]:
""},getFragment:function(a,b){if(null==a)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c)}else a=this.getHash();a.indexOf(this.options.root)||(a=a.substr(this.options.root.length));return a.replace(w,"")},start:function(a){if(z.started)throw Error("Backbone.history has already been started");z.started=!0;this.options=f.extend({},{root:"/"},this.options,a);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=
!(!this.options.pushState||!window.history||!window.history.pushState);a=this.getFragment();var b=document.documentMode;if(b=A.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b))this.iframe=l('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?l(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!b?l(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,
this.interval));this.fragment=a;a=window.location;b=a.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&(this._hasPushState&&b&&a.hash)&&(this.fragment=this.getHash().replace(w,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},
stop:function(){l(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);z.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a==this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return f.any(this.handlers,
function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!z.started)return!1;if(!b||!0===b)b={trigger:b};var c=(a||"").replace(w,"");this.fragment!=c&&(this._hasPushState?(0!=c.indexOf(this.options.root)&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||
this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a))},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var D=d.View=function(a){this.cid=f.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},C=/^(\S+)\s*(.*)$/,x="model collection el id attributes className tagName".split(" ");
f.extend(D.prototype,n,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(a,b,c){a=document.createElement(a);b&&l(a).attr(b);c&&l(a).html(c);return a},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof l?a:l(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=B(this,"events"))){this.undelegateEvents();
for(var b in a){var c=a[b];f.isFunction(c)||(c=this[a[b]]);if(!c)throw Error('Method "'+a[b]+'" does not exist');var d=b.match(C),k=d[1],d=d[2],c=f.bind(c,this),k=k+(".delegateEvents"+this.cid);""===d?this.$el.bind(k,c):this.$el.delegate(d,k,c)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=f.extend({},this.options,a));for(var b=0,c=x.length;b<c;b++){var d=x[b];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,
!1);else{var a=B(this,"attributes")||{};this.id&&(a.id=this.id);this.className&&(a["class"]=this.className);this.setElement(this.make(this.tagName,a),!1)}}});t.extend=r.extend=m.extend=D.extend=function(a,b){var c=F(this,a,b);c.extend=this.extend;return c};var k={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};d.sync=function(a,b,c){var h=k[a];c||(c={});var m={type:h,dataType:"json"};c.url||(m.url=B(b,"url")||G());if(!c.data&&b&&("create"==a||"update"==a))m.contentType="application/json",
m.data=JSON.stringify(b.toJSON());d.emulateJSON&&(m.contentType="application/x-www-form-urlencoded",m.data=m.data?{model:m.data}:{});if(d.emulateHTTP&&("PUT"===h||"DELETE"===h))d.emulateJSON&&(m.data._method=h),m.type="POST",m.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",h)};"GET"!==m.type&&!d.emulateJSON&&(m.processData=!1);return l.ajax(f.extend(m,c))};d.wrapError=function(a,b,c){return function(d,f){f=d===b?f:d;a?a(b,f,c):b.trigger("error",b,f,c)}};var s=function(){},F=function(a,
b,c){var d;d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)};f.extend(d,a);s.prototype=a.prototype;d.prototype=new s;b&&f.extend(d.prototype,b);c&&f.extend(d,c);d.prototype.constructor=d;d.__super__=a.prototype;return d},B=function(a,b){return!a||!a[b]?null:f.isFunction(a[b])?a[b]():a[b]},G=function(){throw Error('A "url" property or function must be specified');}}).call(this);$.fn.clone=function(){var b=[];this.each(function(){b.push(this.cloneNode(!0))});return $(b)};
$.scrollTop=function(b){if(b||0===b)document.body.scrollTop=b;else return document.body.scrollTop};
(function(){(function(b){return b.fn.hoover=function(a){var h,c,d,f,l,p,n;h=this;n=null;d=!1;p={"in":250,out:150};a&&b.extend(p,a);c=function(){h.trigger("hooverIn");l();return d=!0};f=function(){h.trigger("hooverOut");l();return d=!1};l=function(){n&&clearTimeout(n);return n=null};h.bind("mouseover",function(){if(d)return l();if(!n)return n=setTimeout(c,p["in"])});h.bind("mouseout",function(){return d?(n&&l(),n=setTimeout(f,p.out)):l()});return this}})(window.Zepto||window.jQuery)}).call(this);
var Routes={routes:{place:"place",schedule:"schedule","*actions":"invitation"}},Views={},Behaviors={},App={params:{os_offset:0},initialize:function(){"iPhone"==Env.device.device&&7>Env.device.version&&(this.params.os_offset=60);window.setTimeout(function(){Nav.initialize({remove_views:!1,no_access_animation:"slide",ui_delay:500})},500);App.listen()},after_initialize:function(){},before_transition:function(){Nav.view.requests=[];App.resize();$.fn.placeholder&&Nav.view.$el.find("input[type=text], input[type=date], input[type=password], textarea").placeholder()},
after_transition:function(){Nav.elmt.css({height:Nav.view.$el.height()})},before_unload:function(){Nav.view.requests&&App.cancel_requests()},cancel_requests:function(){for(var b=0;b<Nav.view.requests.length;b++)Nav.view.requests[b].abort();Nav.view.refreshing=!1;Nav.view.requests=[]},resize:function(){0<App.params.os_offset&&(Ui.min_height=$(window).height()+App.params.os_offset,App.params.os_offset=0);var b=Nav.elmt.is("#wrapper")?$("header").height():0,a=App.get_auto_height(Nav.view.$el),h=App.get_auto_height(Nav.elmt);
a+b+App.params.os_offset<Ui.min_height?Nav.view.$el.css({height:Ui.min_height-b+App.params.os_offset}):Nav.view.$el.css({height:a});b=[a,h,$(window).height()];Nav.current_transition&&b.push(Nav.current_transition.prev_view.$el.height());b=_.max(b);Nav.elmt.css({height:b})},reset_and_resize:function(){Nav.elmt.css({height:"auto"});Nav.view.$el.css({height:"auto"});Nav.run("resize")},listen:function(){App.listener=window.setTimeout(function(){App.listen()},2E3)},get_auto_height:function(b){var a=b.clone();
a.css({visibility:"hidden",height:"auto"});b.after(a);b=a.height();a.remove();return b},get_position:function(b){b({latitude:52.495971,longitude:13.453954});return!1}};$.fn.prop=$.fn.prop||$.fn.attr;String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};$(document).ready(function(){App.initialize()});
App.api={urls:{public_users:"get@public/users",login:"get@me",current_user:"get@me",register:"post@me",users:"get@users",user:"get@users/{id}",user_statuses:"get@users/{user_id}/statuses",mutual_facebook_friends:"get@users/{user_id}/mutual_facebook_friends",interests:"get@users/{user_id}/interests",update_user:"put@me",confirm_email:"put@me/confirm",deactivate:"delete@me",statuses:"get@statuses",status:"get@statuses/{id}",comments:"get@statuses/{status_id}/comments",comments_from:"get@statuses/{status_id}/comments/{user_id}",
likes:"get@statuses/{status_id}/likes",dislikes:"get@statuses/{status_id}/dislikes",post_status:"post@me/statuses",search:"get@search",reply_status:"post@statuses/{status_id}/comments",reply_status_to:"post@statuses/{status_id}/comments/{user_id}",like_status:"post@statuses/{status_id}/likes",dislike_status:"post@statuses/{status_id}/dislikes",unlike_status:"delete@statuses/{status_id}/likes",undislike_status:"delete@statuses/{status_id}/dislikes",friend_requests:"get@me/friend_requests",friend_suggestions:"get@me/friend_suggestions",
send_bonjour:"post@users/{user_id}/friend_request",cancel_bonjour:"delete@your/users/{user_id}/bonjour",unfriend:"delete@me/friends/{user_id}",friends:"get@me/friends",message_threads:"get@me/conversations",messages:"get@me/conversations/{user_id}/messages",update_conversation:"put@me/conversations/{user_id}",send_message:"post@me/conversations/{user_id}/messages",events:"get@me/events",clear_events:"post@my/dashboard/timeline",counters:"get@me/counters",forgot_password:"post@me/password",reset_password:"put@me/password",
update_notification:"put@my/notification",block_user:"post@users/{user_id}/block",unblock_user:"delete@users/{user_id}/block",report_abuse:"post@me/reports",blocked_users:"get@me/blocked_users",upload_picture:"post@me/profile_photos",delete_photo:"delete@me/profile_photos/{id}",set_as_avatar:"put@me/profile_photos/{id}",notification_settings:"get@my/notification",current_facebook_user:"get@me/facebook_user",link_facebook_user:"post@me/facebook_user"},include_location:!1,request:function(b,a){var h=
{};h.url="/"+App.api.urls[b].split("@")[1];h.method=App.api.urls[b].split("@")[0];a.data||(a.data={});h.api_level=a.api_level||1;1==h.api_level&&(h.url="/1"+h.url);a.vars&&_.each(a.vars,function(a,b){h.url=h.url.replace("{"+b+"}",a)});App.auth.user()&&!0==!a.anonymous&&(a.data?a.data.auth_token=App.auth.user().authentication_token:a.data={auth_token:App.auth.user().authentication_token},!0==App.api.include_location&&(a.data.latitude=App.auth.attr("latitude"),a.data.longitude=App.auth.attr("longitude"),
App.api.include_location=!1));h.locale=a.locale||App.i18n.locale;a.data&&("post"==h.method||"put"==h.method?h.data=a.data:-1==h.url.indexOf("?")?h.url+="?"+$.param(a.data):h.url+="&"+$.param(a.data));!a.error&&a.dialog&&(a.error=function(){App.ui.refresh_dialog(a.dialog,{content:"<p>"+App.i18n.t("error_retry","general")+'</p><div class="buttons"><a class="btn ok" href=""><span>Ok</span></a></div>'})});var c=!1===Env.use_proxy?$.ajax({type:h.method,data:h.data,url:Env.api_url+h.url,beforeSend:function(b){b.setRequestHeader("Accept",
1===a.api_level?"application/json":"application/hal+json; level="+a.api_level)},dataType:"json",timeout:2E4,success:function(b){App.api.respond_with({data:b,code:c.status},a)},error:function(b){c.responseText?App.api.respond_with({data:JSON.parse(c.responseText),code:c.status},a):(a.error||function(){}).apply()}}):$.ajax({type:"post",data:h,url:"/api",dataType:"json",timeout:2E4,success:function(b){App.api.respond_with(b,a)},error:a.error});return c},respond_with:function(b,a){if(401==b.code&&b.errors&&
b.errors.auth_token)App.auth.destroy(),Nav.view&&Nav.go("/login","slide_back");else if(a.success)switch(a.as){case "text":a.success.apply(JSON.stringify(b),[JSON.stringify(b)]);break;default:a.success.apply(b,[b])}}};
App.auth={initialize:function(){App.auth.default_user_params={embedded:"photos,last_status,interests",photo_style:App.util.photo_style(["small","normal","big"])}},user:function(){return App.auth.current_user?App.auth.current_user:window.localStorage&&window.localStorage.getItem("user")&&0<window.localStorage.getItem("user").length?(App.auth.current_user=JSON.parse(window.localStorage.getItem("user")).data,App.auth.current_user):null},attr:function(b){if(App.params["auth_"+b])return App.params["auth_"+
b];if(window.localStorage)return(b=window.localStorage.getItem("auth_"+b))&&0<b.length?b:null;console.log("no local storage");return null},save:function(b){if(window.localStorage){for(var a in b)"password"!==a&&window.localStorage.setItem("auth_"+a,b[a]);return!0}console.log("no local storage");return!1},save_user:function(b){window.localStorage&&window.localStorage.setItem("user",b);App.auth.current_user=JSON.parse(b.toString()).data;App.auth.save({last_update:(new Date).getTime()})},refresh_user:function(b,
a){App.api.request("current_user",{api_level:2,as:"text",data:App.auth.default_user_params,success:function(){App.auth.refresh_user_with(this);(b||function(){})()},error:a})},refresh_user_with:function(b){_.each(Nav.moves,function(a){"profile"==a.view&&a.instance!=Nav.view&&(a.instance.$el.remove(),a.instance.inserted=!1,a.instance.data=null)});App.auth.save_user(b);Nav.view&&"function"==typeof Nav.view.refresh_footer&&Nav.view.refresh_footer.apply(Nav.view)},destroy:function(){window.localStorage&&
(window.localStorage.setItem("auth_token",""),window.localStorage.setItem("user",""),window.localStorage.setItem("auth_email",""),window.localStorage.setItem("auth_last_update",""),window.localStorage.setItem("auth_latitude",""),window.localStorage.setItem("auth_longitude",""));App.params.auth_token=null;App.params.auth_email=null;App.auth.current_user=null;_.each(Nav.moves,function(b){b.instance!=Nav.view&&(b.instance.$el.remove(),b.instance.inserted=!1,b.instance.data=null)})},avatar:function(b){if(App.auth.user()&&
App.auth.user()._embedded&&App.auth.user()._embedded.photos)for(var a=App.auth.user()._embedded.photos,h=0;h<a.length;h++)if(!0==a[h].avatar)return a[h][App.util.photo_style(b)];return null}};
(function(b,a,h){a.support=a.support||{};a.support.touch="ontouchend"in document;a.support.mouse=!0==a.os.blackberry||!a.support.touch;a.support.webkit=(document.body||document.documentElement).style.WebkitTransition!==h;a.support.webkit3d="WebKitCSSMatrix"in b&&"m11"in new WebKitCSSMatrix;b=a.support;h=document.createElement("input");h.setAttribute("type","file");b.upload=!h.disabled;a.browser=a.browser||{};a.browser.chrome=!!navigator.userAgent.match(/chrome/i)})(window,$);
(function(b,a,h){function c(c){function l(c){a(document.body).on("mousemove",function(){v=!1});c.on("mouseover mousedown",function(a){!1==v&&t(a)});c.on("mouseout mouseup",function(a){!1==v&&r(a)});c.on("click",function(a){!(b.isFakeEvent!==h&&!0===b.isFakeEvent(a))&&!1==v&&m(a)})}function p(b){b.on("click",function(a){a.preventDefault()});b.each(function(){var b=0,h=0,l=null,p=!1,q=this;a(q).on("touchstart",function(c){a.support.mouse&&(v=!0);b=c.targetTouches[0].clientX;h=c.targetTouches[0].clientY;
n();0>d.indexOf(q)&&(d.push(q),l=setTimeout(function(){l=null;t(c)},150))},!1);a(q).on("touchmove",function(a){if(!p&&(Math.abs(a.targetTouches[0].clientX-b)>c.distance||Math.abs(a.targetTouches[0].clientY-h)>c.distance))p=!0,l?(clearTimeout(l),l=null):r(a)},!1);a(q).on("touchend",function(a){!p&&0<=d.indexOf(q)&&(null!==l?(clearTimeout(l),l=null,t(a),setTimeout(function(){m(a);setTimeout(function(){r(a)},100)},100)):(m(a),r(a)));p=!1},!1)})}function n(){for(var a=0;a<d.length;a++)r({target:d[a],
preventDefault:function(){},stopPropagation:function(){}})}function t(b){var d=a(b.target).is("a")?a(b.target):a(b.target).parents("a");d.addClass(c.hover_class);c.enter.apply(d,[b])}function r(b){var h=a(b.target).is("a")?a(b.target):a(b.target).parents("a");h.removeClass(c.hover_class);c.leave.apply(h,[b]);b=[];for(var l=0;l<d.length;l++)d[l]!==h.get(0)&&b.push(d[l]);d=b}function m(b){b.preventDefault();var d=a(b.target).is("a")?a(b.target):a(b.target).parents("a");c.run.apply(d,[b,d.attr("data-href")])}
c=a.extend({hover_class:"hover",time:500,distance:15,leave:function(){},enter:function(){},run:function(){}},c);var u=a(this),v=a.support.mouse;(function(b){b.each(function(){var b=a(this);null==b.attr("data-href")&&b.attr("data-href",b.attr("href"))})})(u);a.support.touch&&(p(u),u.attr("href",""));a.support.mouse&&l(u);u.on("run",function(a){m(a)});return a(this)}var d=[];a.fn.link=a.fn.link||c})(window,$);
(function(b,a,h){b.Nav={moves:[],views:[],options:{},initialize:function(c){Nav.options=_.extend({elmt:"#wrapper",append_to:"#wrapper",ui_delay:0,access_filter:function(){return!0},remove_views:!0},c);Nav.set_browser_prefs();Nav.elmt=a(Nav.options.elmt);Nav.append_to=a(Nav.options.append_to);c=Backbone.Router.extend(Routes);Nav.router=new c;Backbone.history.start();var d=Backbone.history.getFragment(b.location.hash),f=this.get_view_for(d);Nav.view=Nav.new_view(f,d);Nav.params=Nav.router._extractParameters(this.get_route_for(d).route,
Backbone.history.getFragment(d));c=Nav.check_access_filter(Nav.view);!0!==c?(f=Nav.get_view_for(c),Nav.view=Nav.new_view(f),Nav.url_before_access_filter=d,b.localStorage&&b.localStorage.setItem("url_before_access_filter",d),b.location.replace("#"+c),d=Backbone.history.getFragment(c),Nav.params=Nav.router._extractParameters(this.get_route_for(d).route,Backbone.history.getFragment(d))):b.localStorage&&(Nav.url_before_access_filter=b.localStorage.getItem("url_before_access_filter"));this.history();Nav.controller=
f;""==b.location.hash?b.location.href="#":a.os.ios&&7>a.os.version.split(".")[0]&&b.scrollTo(0,1);this.load_page(Nav.view,{complete:function(){Nav.insert(Nav.view);Nav.moves.push({path:"/"+d,view:f,instance:Nav.view});Nav.views.push({path:"/"+d,view:f,instance:Nav.view});Nav.moves.current=Nav.moves[0];Nav.run("after_transition",[Nav.view]);Nav.run("after_initialize",[Nav.view])}});a.os.ios&&7>a.os.version.split(".")[0]&&Nav.hide_ios_bar();Nav.init_resizing()},history:function(){_.extend(Backbone.history,
BackboneHistoryExt);Backbone.history.on("route",function(a,b,f){Nav.controller=b;Nav.params=f;Nav.view.path=Backbone.history.getFragment(Backbone.history.get_current_path());Nav.view.params=f;Nav.run("url_changed",[Nav.view]);"object"!==typeof Nav.current_transition&&Nav.go(Backbone.history.get_current_path(),null,{back:!0})})},init_resizing:function(){var c=function(){b.setTimeout(function(){a.os.ios&&(7>a.os.version.split(".")[0]&&0==a.scrollTop())&&b.scrollTo(0,1);Nav.run("resize",[Nav.view])},
Nav.options.ui_delay)};if(b.orientationchange!==h)a(b).on("orientationchange",function(){c()});else a(b).on("resize",function(){c()})},go:function(b,d,f){if(Nav.moves.current&&b==Nav.moves.current.path||"object"==typeof Nav.current_transition)return!1;Nav.current_transition=f||{};Nav.current_transition.url=b;Nav.current_transition.prev_view=this.view;var l=Nav.get_view_for(b),p=this.view,n=Nav.current_transition.view!==h?Nav.current_transition.view:this.get_freshest_view_for(b,l);if(!0===Nav.current_transition.back&&
(null==d||0==d.length)&&p.animation){var t=p.animation;d=Nav.opposite_animation(p.animation)}f&&f.data&&!n.data&&(n.data=f.data);var r=Nav.get_method(d,n);Nav.run("before_unload",[Nav.view]);var m=Nav.check_access_filter(n);if(!0!==m)return l=Nav.get_view_for(m),Nav.new_view(l,m),d=Nav.options.no_access_animation||d,Nav.current_transition=!1,Nav.go(m,d,f),!1;Nav.view=n;!0!==Nav.current_transition.back?(Nav.view.animation=d,Nav.view.history_index=Nav.moves.length):(Nav.view.animation=t,Nav.view.history_index=
Nav.moves.length-1);Nav.auto_links();!0!==Nav.current_transition.back&&Nav.router.navigate(b,{trigger:!0});n.$el.attr("style","");a.scrollTop(0);r.apply(Nav,[p,n,function(){!0==Nav.options.remove_views?(p.$el.remove(),p.inserted=!1):p.$el.hide();!0!==Nav.current_transition.back?(Nav.moves.push({path:b,view:l,animation:d,instance:n}),Nav.views.push({path:b,view:l,animation:d,instance:n})):Nav.cut_moves_at(Nav.view.history_index);Nav.moves.current=Nav.moves[Nav.moves.length-1];Nav.run("after_unload",
[Nav.current_transition.prev_view]);Nav.run("after_transition",[Nav.view]);(Nav.current_transition.after_transition||function(){}).apply(Nav.view,[Nav.view.first_time]);Nav.current_transition=h}])},check_access_filter:function(a){a=("function"==typeof a.access_filter?a.access_filter:Nav.options.access_filter).apply(a);return!0!==a&&"string"==typeof a?a:!0},get_method:function(b,d){var f=Animation[b]!==h?Animation[b]:Animation.standard;if(a.os.blackberry)if(7<=parseInt(a.os.version)){if("slide"==b||
"slide_back"==b)f=Animation.direct}else f=Animation.direct;d&&(d.use_transition&&Animation[d.use_transition])&&(f=Animation[d.use_transition]);return f},run:function(a,b,f){b=b||[];(Ui[a]||function(){}).apply(Ui,f);(App[a]||function(){}).apply(App,f);"object"==typeof Nav.current_transition&&(Nav.current_transition[a]||function(){}).apply(Nav,f);_.each(b,function(b){"function"==typeof b.run?b.run(a,f):(b[a]||function(){}).apply(b,f)})},load_page:function(b,d){b.remote==h?d.complete():"function"==typeof b.remote?
((d.loading||Nav.loading||function(){}).apply(b,[b]),b.remote.apply(b,[d])):((d.loading||Nav.loading||function(){})(),b.get_params!==h&&(b.remote.data=b.get_params()),a.ajax(a.extend({type:"get",success:function(b){a("#loader").remove();Nav.view.data=b;d.complete()}},b.remote)))},insert:function(b,d){Nav.run("before_insert",[b],[b.first_time]);d=a.extend({callbacks:!0},d||{});!0!==b.inserted?(b.render(),(d.before_append||function(){})(),(d.before_append_or_display||function(){})(),Nav.append_to.append(b.$el),
Nav.auto_links(b.$el),b.inserted=!0,b.first_time=!0):((d.before_display||function(){})(),(d.before_append_or_display||function(){})(),b.$el.show(),b.first_time=!1);!0==d.callbacks&&Nav.run("before_transition",[b],[b.first_time])},loading:function(){Nav.run("loading");if(0==a("#loader").length){var b=a('<div id="loader" class="live"><p>'+App.loading_text[App.locale]+"...</p><span></span></div>");a(document.body).append(b)}},set_browser_prefs:function(){a.os.android&&(Nav.options.ui_delay=300)},opposite_animation:function(a){switch(a){case "fall":return"sky";
case "sky":return"fall";case "from_the_ground":return"to_the_ground";case "to_the_ground":return"from_the_ground";case "slide":return"slide_back";case "slide_back":return"slide";case "cover":return"uncover";case "fadein":return"fadeout"}},hide_ios_bar:function(){b.setTimeout(function(){0==a.scrollTop()&&(b.scrollTo(0,1),Nav.hide_ios_bar())},3E3)},auto_links:function(a){a=a||Nav.view.$el;a.find("a[data-auto]").link({run:function(a,c){a.preventDefault();this.hasClass("back")?b.history.back():Nav.go(c,
this.attr("data-auto"))}})},new_view:function(a,d){var f=new b.Views[a];f.name=a;f.path=d;return f},get_view_for:function(a){a=Backbone.history.getFragment(a);var d=!1,f=0;matched=_.any(b.Routes.routes,function(b,h){if(Backbone.history.handlers[f].route.test(a))return d=b,!0;f++});return d},get_route_for:function(a){a=Backbone.history.getFragment(a);var b=!1,f=0;matched=_.any(Backbone.history.handlers,function(h){if(h.route.test(a))return b=h,!0;f++});return b},get_freshest_view_for:function(a,b){for(var f=
Nav.views.length-1;0<=f;f--)if(Nav.views[f].path==a&&!0==Nav.views[f].instance.inserted)return Nav.views[f].instance;return Nav.new_view(b,a)},get_last_view_for:function(a){for(var b=Nav.moves.length-1;0<=b;b--)if(Nav.views[b].path==a)return Nav.moves[b].instance;return!1},get_prev_view_for:function(a){for(var b=0,f=Nav.moves.length-1;0<=f;f--)if(Nav.views[f].path==a)if(0==b)b++;else return Nav.moves[f].instance;return!1},cut_moves_at:function(a){for(var b=[],f=0;f<Nav.moves.length;f++)if(f<a)b.push(Nav.moves[f]);
else break;Nav.moves=b;0==Nav.moves.length&&(Nav.moves.push({path:Nav.view.path,instance:Nav.view,view:Nav.view.name}),Nav.views.push({path:Nav.view.path,instance:Nav.view,view:Nav.view.name}))}}})(window,$);
(function(b,a,h){b.Ui={min_height:0,remove_before_transition:[],clones_to_show:[],before_transition:function(){Ui.set_nav();Ui.remove_fixed_elements();Ui.set_min_size()},after_transition:function(){Ui.fix_element_complete()},resize:function(){Nav.view.$el.css({width:a(b).width()});Ui.min_height=0;Ui.set_min_size()},fix_element:function(c){if(300>a(b).height())return c;var d=c.clone();c.css({position:"absolute",top:a(b).height()-c.height()-a("header").height()+2,left:0,right:0});d.css({visibility:"hidden"}).addClass("fixed").css({position:"fixed",
bottom:0,top:"auto"});Ui.clones_to_show.push({clone:d,elmt:c});Nav.auto_links(d);a(document.body).append(d);Ui.remove_before_transition.push({show:c,clone:d});return d},fix_element_complete:function(){for(var a=0;a<Ui.clones_to_show.length;a++)Ui.clones_to_show[a].clone.css({visibility:"visible"}),Ui.clones_to_show[a].elmt.css({visibility:"hidden"}).css({position:"static"});Ui.clones_to_show=[]},remove_fixed_elements:function(){_.each(Ui.remove_before_transition,function(c){var d=0==a.scrollTop()?
2:a.scrollTop()+4;c.show.css({position:"absolute",top:a(b).height()-c.show.height()-a("header").height()+d,left:0,right:0});c.show.css({visibility:"visible"});c.clone.remove()});Ui.remove_before_transition=[]},set_min_size:function(){a(b).height()>Ui.min_height&&(Ui.min_height=a(b).height())},set_nav:function(){if(Nav.current_transition&&!0!==Nav.current_transition.back)var a=Nav.moves&&Nav.moves.current?Nav.moves.current.instance:Nav.view,b=Nav.moves?Nav.moves.current.path:"/",a=a.next_prev_label==
h?"Back":a.next_prev_label(),f=Nav.view.prev_link==h?Nav.view.$el.find("nav.bar a.back"):Nav.view.prev_link();else if(Nav.moves.current){var l=Nav.get_prev_view_for(Nav.moves.current.path)||Nav.get_last_view_for(Nav.moves.current.path);Nav.moves[l.history_index-2]!==h&&(a=Nav.moves[l.history_index-2].instance,b=Nav.moves[l.history_index-2].path,a=a.next_prev_label==h?"Back":a.next_prev_label(),f=Nav.view.prev_link==h?Nav.view.$el.find("nav.bar a.back"):Nav.view.prev_link())}f&&(b&&a)&&(Ui.truncate_button(f,
a),f.attr("href",b).attr("data-href",b));b=Nav.view.$el.find("a.next");l=b.find("span").html();null!=b&&(0<b.length&&l)&&Ui.truncate_button(b,l)},truncate_button:function(c,d){c.attr("title",d);var f={small:12,medium:20,large:40}[c.attr("data-size")||"small"],h=a('<span style="display:inline; visibility:hidden">m</span>');c.after(h);var p=h.width();h.remove();h=a(b).width()-320;0<h&&(f+=Math.floor(h/p));d&&d.length>f&&(d=d.substr(0,f)+"...");c.find("span").html(d)},form_fixes_after_transition:function(b,
d){d=d||{};a.os.android&&!a.browser.chrome&&(b.find("select").each(function(b){var c=a(this),h=Ui.insert_cloned_input(c);h.addClass(d.select_class||"cloned").on("change",function(){c.val(h.val());c.trigger("change")});(d.after_append||function(){}).apply(h,[h])}),b.find("input[type=radio]").each(function(b){var c=a(this),h=Ui.insert_cloned_input(c);h.attr("name",c.attr("name")).addClass(d.select_class||"cloned").addClass("radio");h.on("change",function(){c[0].checked=h[0].checked;c.trigger("change")});
(d.after_append||function(){}).apply(h,[h])}),b.find("input[type=checkbox]").each(function(b){var c=a(this),h=Ui.insert_cloned_input(c);h.addClass(d.select_class||"cloned").addClass("checkbox").on("change",function(){c[0].checked=h[0].checked;c.trigger("change")});(d.after_append||function(){}).apply(h,[h])}))},form_fixes_before_unload:function(b,d){d=d||{};a.os.android&&!a.browser.chrome&&(b.find("select").css({visibility:"visible"}),b.find("input[type=radio]").css({visibility:"visible"}),b.find("input[type=checkbox]").css({visibility:"visible"}),
a(document.body).find("select."+(d.select_class||"cloned")).remove(),a(document.body).find("input.radio."+(d.select_class||"cloned")).remove(),a(document.body).find("input.checkbox."+(d.select_class||"cloned")).remove())},form_fixes_resize:function(b,d){a.os.android&&!a.browser.chrome&&(b.find("select").each(function(b){b=a(this);var c=a(b.attr("data-clone"));Ui.size_cloned_input(b,c)}),b.find("input[type=radio]").each(function(b){b=a(this);var c=a(b.attr("data-clone"));Ui.size_cloned_input(b,c)}),
b.find("input[type=checkbox]").each(function(b){b=a(this);var c=a(b.attr("data-clone"));Ui.size_cloned_input(b,c)}))},form_fixes_on_resize:function(c,d){d=d||{};a.os.android&&!a.browser.chrome&&b.setTimeout(function(){Ui.form_fixes_resize(c,d)},0)},insert_cloned_input:function(b){var d=b.clone();b.css({visibility:"hidden"});d.val(b.val());Ui.size_cloned_input(b,d);Ui.tag_cloned_input(b,d);a(document.body).append(d);return d},size_cloned_input:function(a,b){var f=a.offset();b.css({position:"absolute",
zIndex:20,top:f.top,left:f.left,width:a.width(),height:a.height()})},tag_cloned_input:function(a,b){var f="cloned_input_"+Math.floor(11*Math.random());a.attr("data-clone",f);b.attr("id",f)},protect_form:function(b){var d=a('<div style="position:absolute; top:0; left:0; right:0; bottom:0; background:transparent; padding:0; margin:0;" />');d.css({height:b.height()});b.append(d);return d}}})(window,$);var BackboneHistoryExt={get_current_path:function(){return"/"+window.location.href.split("#").reverse()[0]}};
Backbone.View.prototype.attach_behavior=function(b){this.behaviors=this.behaviors||{};this.behaviors[b]="function"==typeof Behaviors[b]?new Behaviors[b](this):$.extend({},Behaviors[b]);"function"==typeof this.behaviors[b].initialize&&this.behaviors[b].initialize.apply(this)};Backbone.View.prototype.run=function(b,a){a=a||[];(this[b]||function(){}).apply(this,a);for(var h in this.behaviors)(this.behaviors[h][b]||function(){}).apply(this,a)};
var Animation={fall:function(b,a,h){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({visibility:"hidden"})}});Animation.reset_slider();var c=Animation.get_offset(Nav.elmt),d=parseInt(a.$el.css("z-index"))||0,f=d+1;b.$el.css({"z-index":d});a.$el.css({position:"absolute",zIndex:f,top:-a.$el.height(),right:0,left:c.x,width:$(window).width()}).css({visibility:"visible"});Animation.move_element(a.$el,{y:a.$el.height(),duration:600,transition:"ease-out",
end:function(){b.$el.hide();h()}})}})},sky:function(b,a,h){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({visibility:"hidden"})}});Animation.reset_slider();var c=Animation.get_offset(b.$el),d=parseInt(b.$el.css("z-index"))||0,f=d+1;b.$el.css({"z-index":d});a.$el.css({"z-index":f});a.$el.show().css({visibility:"visible"});Animation.move_element(b.$el,{y:-b.$el.height()+c.y,x:-c.x,duration:1E3,transition:"ease-out",end:function(a){b.$el.hide();Animation.reset_slider();
h()}})}})},fall:function(b,a,h){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({visibility:"hidden"})}});Animation.reset_slider();var c=Animation.get_offset(Nav.elmt),d=parseInt(a.$el.css("z-index"))||0,f=d+1;b.$el.css({"z-index":d});a.$el.css({position:"absolute",zIndex:f,top:-a.$el.height(),right:0,left:c.x,width:$(window).width()}).css({visibility:"visible"});Animation.move_element(a.$el,{y:a.$el.height(),duration:600,transition:"ease-out",end:function(){b.$el.hide();
h()}})}})},from_the_ground:function(b,a,h){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({visibility:"hidden"})}});var c=(parseInt(a.$el.css("z-index"))||0)+1,d=Animation.get_offset(Nav.elmt);a.$el.css({position:"absolute",zIndex:c,top:$(window).height(),right:0,left:d.x,width:$(window).width()}).css({visibility:"visible"});Animation.move_element(a.$el,{y:-$(window).height(),duration:600,transition:"ease-out",end:function(){b.$el.hide();h()}})}})},
to_the_ground:function(b,a,h){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({visibility:"hidden"})}});var c=(parseInt(a.$el.css("z-index"))||0)-1,d=Animation.get_offset(Nav.elmt);a.$el.css({position:"absolute",zIndex:c,top:0,right:0,left:d.x,width:$(window).width()}).css({visibility:"visible"});Animation.move_element(b.$el,{y:$(window).height(),duration:600,transition:"ease-in",end:function(){b.$el.hide();h()}})}})},fadein:function(b,a,h){Nav.load_page(a,
{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({opacity:0})}});Animation.reset_slider();var c=Animation.get_offset(Nav.elmt),d=parseInt(a.$el.css("z-index"))||0,f=d+1;b.$el.css({"z-index":d});a.$el.css({position:"absolute",zIndex:f,top:0,right:0,left:c.x,width:$(window).width()});a.$el.animate({opacity:1},{complete:function(){h()}})}})},fadeout:function(b,a,h){Nav.load_page(a,{complete:function(){Nav.insert(a);Animation.reset_slider();var c=Animation.get_offset(Nav.elmt),
d=parseInt(a.$el.css("z-index"))||1,f=d-1;b.$el.css({"z-index":d});a.$el.css({position:"absolute",zIndex:f,top:0,right:0,left:c.x,width:$(window).width()});b.$el.animate({opacity:0},{complete:function(){h()}})}})},slide:function(b,a,h){Nav.load_page(a,{complete:function(){var c=$(window).width(),d=Animation.get_offset(Nav.elmt);b.$el.css({position:"absolute",top:0,left:d.x,width:c});Nav.insert(a,{before_append_or_display:function(){a.$el.css({position:"absolute",top:0,left:d.x+c,width:c})}});Nav.elmt.css({position:"relative"});
Animation.move_element(Nav.elmt,{x:-(d.x+c),duration:300,end:function(a){Animation.reset_slider();Nav.view.$el.css({left:0});h()}})}})},slide_back:function(b,a,h){Nav.load_page(a,{complete:function(){var c=$(window).width(),d=Animation.get_offset(Nav.elmt);b.$el.css({position:"absolute",top:0,left:d.x,width:c});Nav.insert(a,{before_append_or_display:function(){a.$el.css({position:"absolute",top:0,left:d.x-c,width:c})}});Nav.elmt.css({position:"relative"});Animation.move_element(Nav.elmt,{x:-(d.x-
c),duration:300,end:function(a){Animation.reset_slider();Nav.view.$el.css({left:0});h()}})}})},cover:function(b,a,h){Nav.load_page(a,{complete:function(){var c=$(window).width(),d=Animation.get_offset(Nav.elmt),f=parseInt(a.$el.css("z-index"))||0,l=f+1;b.$el.css({"z-index":f});Nav.insert(a,{before_append_or_display:function(){a.$el.css({position:"absolute",top:0,left:d.x+c,width:c,"z-index":l})}});Animation.move_element(a.$el,{x:-c,duration:350,transition:"ease-in",end:function(a){h()}})}})},uncover:function(b,
a,h){Nav.load_page(a,{complete:function(){var c=$(window).width(),d=Animation.get_offset(Nav.elmt),f=parseInt(a.$el.css("z-index"))||1,l=f-1;b.$el.css({"z-index":f});a.$el.css("z-index")||a.$el.css({"z-index":f});Nav.insert(a,{before_append_or_display:function(){a.$el.css({position:"absolute",top:0,left:d.x,width:c,"z-index":l})}});Animation.move_element(b.$el,{x:c,duration:450,transition:"ease-in",end:function(a){h()}})}})},direct:function(b,a,h){Nav.load_page(a,{complete:function(){b.$el.hide();
Animation.reset_slider();Nav.insert(a);a.$el.show();h()}})},standard:function(b,a,h){Nav.load_page(a,{complete:function(){Nav.insert(a,{before_append_or_display:function(){a.$el.css({opacity:0})}});b.$el.animate({opacity:0},{duration:300,complete:function(c){b.$el.hide();Animation.reset_slider();a.$el.animate({opacity:1},{complete:function(){h()}})}})}})},move_element:function(b,a){a=a||{};var h={"-webkit-transition":(a.duration||"400")+"ms "+(a.transition||"ease-in-out"),"-webkit-transform":Animation.get_webkit_translation(a.x,
a.y)};a["background-color"]&&(h["background-color"]=a["background-color"]);window.setTimeout(function(){b.css(h);if("function"==typeof a.end)b.on("webkitTransitionEnd",function(){b.off("webkitTransitionEnd");a.end()})},0)},unfold_element:function(b,a){a=a||{};var h=b.clone();h.css({visibility:"hidden",position:"absolute",height:"auto"}).show();b.after(h);var c=h.height();h.remove();b.css({height:0}).show();var d=(a.duration||"400")+"ms";window.setTimeout(function(){b.css({"-webkit-transition-timing-function":a.transition||
"ease-in-out","-webkit-transition":"height "+d});b.css({height:c});if("function"==typeof a.end)b.on("webkitTransitionEnd",function(){a.end();b.css({"-webkit-transition-timing-function":"","-webkit-transition":""});b.unbind("webkitTransitionEnd")})},0)},fold_element:function(b,a){a=a||{};var h=(a.duration||"400")+"ms";window.setTimeout(function(){b.css({"-webkit-transition-timing-function":a.transition||"ease-in-out","-webkit-transition":"height "+h});b.css({height:0});if("function"==typeof a.end)b.on("webkitTransitionEnd",
function(){a.end();b.hide().css({"-webkit-transition-timing-function":"","-webkit-transition":""});b.unbind("webkitTransitionEnd")})},0)},get_offset:function(b){var a=b.css("-webkit-transform");b={y:0,x:0};a&&0<a.length&&(a=a.split("(").reverse()[0].split(")")[0].split(","),1<a.length&&(b.x=-parseInt(a[0].replace(" ","").replace("px","")),b.y=-parseInt(a[1].replace(" ","").replace("px",""))));return b},get_webkit_translation:function(b,a){b=Math.ceil(b)||0;a=Math.ceil(a)||0;return $.support.webkit3d?
"translate3d("+b+"px, "+a+"px, 0)":"translate("+b+"px, "+a+"px)"},reset_slider:function(){Nav.elmt.css({"-webkit-transition-timing-function":"ease-in","-webkit-transition-duration":"0ms","-webkit-transform":"none"})}};
Views.invitation=Backbone.View.extend({className:"invitation",initialize:function(){this.attach_behavior("place_selector")},render:function(){this.$el.html($(Templates.invitation).html());return this},before_transition:function(){this.$el.find("p.start a").link({run:function(b,a){b.preventDefault();Nav.go(a,"slide")}})}});
Views.schedule=Backbone.View.extend({className:"schedule",render:function(){this.$el.html($(Templates.schedule).html());for(var b=["October 26th 2013","October 27th 2013"],a=0;a<b.length;a++){var h=this.build_day(b[a]);this.$el.find("div.days").append(h)}return this},before_transition:function(){this.$el.find("div.days a").link({run:function(b){b.preventDefault();this.toggleClass("on")}});this.$el.find("p.start a").link({run:function(b,a){b.preventDefault();Nav.go(a,"slide")}})},build_day:function(b){var a=
$('<div class="day" />');a.append("<h3>"+b+"</h3>");a.append('<ul class="availabilities" />');for(b=0;24>b;b+=2)a.find("ul.availabilities").append('<li><a href="#" data-slot="'+b+'">'+b+"-"+(b+2)+"h</a></li>");return a}});
Views.place=Backbone.View.extend({className:"schedule",initialize:function(){this.attach_behavior("place_selector")},render:function(){this.$el.html($(Templates.place).html());return this},before_transition:function(){var b=this;this.$el.find("p.start a").link({run:function(a,b){a.preventDefault();Nav.go(b,"slide")}});this.$el.find("a.add_place").link({run:function(a){a.preventDefault();b.run("select_place")}});this.$el.find("div.current_location a").link({run:function(a){a.preventDefault();b.current_location()}})},
after_transition:function(){var b=this.$el.find(".foursquare input"),a=this;b.on("keypress",function(h){13==h.keyCode&&a.run("refresh_places",[b.val()])})},unselect_all:function(){this.$el.find("div.current_location").removeClass("on").find("div.map").hide();this.$el.find("ul.places li").removeClass("selected")},current_location:function(){var b=this;App.get_position(function(a){a&&(a=new google.maps.LatLng(a.latitude,a.longitude),(new google.maps.Geocoder).geocode({latLng:a},function(h,c){c==google.maps.GeocoderStatus.OK&&
0<h.length&&b.use_current_location(h[1],a)}))})},use_current_location:function(b,a){this.unselect_all();this.$el.find("div.current_location a").text(b.formatted_address);var h=this.$el.find("div.map");if(0==h.length){h=$('<div class="map" />');this.$el.find("div.current_location").append(h);var c=new google.maps.Map(h.get(0),{zoom:14,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP}),d=new google.maps.Marker({position:a,map:c});google.maps.event.addListener(c,"center_changed",function(){d.setPosition(c.getCenter())})}else h.show();
this.$el.find("div.current_location").addClass("on");Nav.run("resize")},use_place:function(b,a){this.unselect_all();a.addClass("selected")}});
Behaviors.place_selector={initialize:function(){this.places={}},refresh_places:function(b){var a=this,h=$('<span class="bjr_loader"><span></span></span>');h.css({position:"absolute",top:160,left:"50%","margin-left":-14});this.$el.find("ul.places").empty().before(h);App.get_position(function(c){c={client_id:"ZNUYQTMM3XBUIERAHHVVDYAO3FR4C22C05RMYCHC3DHBMPK3",client_secret:"FI5GYAZ0S2XZOJLYZISOW5QPPW3RAMZHLKWEQMDQHY1BQNC0",ll:c.latitude+","+c.longitude,v:"20130823"};b&&0<b.length&&(c.query=b);a.requests.push($.ajax({url:"https://api.foursquare.com/v2/venues/search",
data:c,dataType:"json",success:function(b){b.response.venues&&0<b.response.venues.length&&a.run("display_places",[b.response.venues])}}))})},close_selector:function(b){var a=this.$el.find("form.status");a.css({position:"absolute",left:0,top:0,right:0}).show();b.css({position:"absolute"});Animation.move_element(b,{y:$(window).height(),end:function(){b.remove();a.css({position:"static"});Nav.run("resize");var h=$("#above p.foursquare_powered");h.animate({opacity:0},{complete:function(){h.remove()}})}})},
display_places:function(b){for(var a=this.$el.find("ul.places"),h=this,c=0;c<b.length;c++){var d=$('<li><a href="#" data-id="'+b[c].id+'"></a></li>');d.find("a").append("<strong>"+b[c].name+"</strong>").append("<span>"+this.behaviors.place_selector.foursquare_location(b[c])+"</span>");a.append(d);d.find("a").link({run:function(a){a.preventDefault();h.run("use_place",[b[c],d])}});this.places[b[c].id]=b[c]}Nav.run("resize")},foursquare_location:function(b){var a="";b.location.address&&(a+=b.location.address+
", ");b.location.postalCode&&(a+=b.location.postalCode+" ");b.location.city&&(a+=b.location.city);return a}};
var Templates={invitation:'<div class="invitation"><p class="title">Your friend<strong> Mourad De Cleck </strong>is visiting town and wants to meet you!</p><div class="info"><p class="location">Berlin</p><p class="time"><span class="from">October 26th 2013</span><br/> to <span class="to">October 27th 2013</span></p><p class="start"><a href="/schedule">Let\'s meet him</a></p></div></div>',place:'<div class="schedule"><div class="title"><p>Suggest a nice place to meet</p><nav class="steps"><span class="done"></span><span class="done"></span><span class="on"></span></nav></div><div class="place"><div class="current_location"><p><a href="#">At my current location</a></p></div><div class="foursquare"><p class="search"><input name="q" placeholder="In a public location" type="search"/></p><ul class="places"></ul><p class="powered">Powered by Foursquare</p></div></div><div class="info"><p class="start"><a href="/place">Finish</a></p></div></div>',place_selector:'<div class="place_selector"><h2>Select a place to meet</h2><form action="#" class="search" method="post"><p class="search"><input class="font-bold" name="q" placeholder="Search for a place" type="search"/></p><p class="submit"><input type="submit" value="Ok"/></p></form><ul class="places"></ul></div>',
schedule:'<div class="schedule"><div class="title"><p>When would you like to meet?</p><nav class="steps"><span class="done"></span><span class="on"></span><span></span></nav></div><div class="info"><div class="days"></div><p class="start"><a href="/place">Continue</a></p></div></div>'};
